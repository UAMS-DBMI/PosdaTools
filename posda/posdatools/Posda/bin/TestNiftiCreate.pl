#!/usr/bin/perl -w
use strict;
use Nifti::Create;
use Debug;
my $dbg = sub {print @_ };

my $spec = {
  aux_file => "",
  bitpix => "16",
  cal_max => 0,
  cal_min => 0,
  data_type => 0,
  datatype => "512",
  db_name => "",
  descrip => "",
  dim => [
      "3",
      "256",
      "256",
      "5",
      "1",
      "1",
      "1",
      "1"
  ],
  dim_info => 0,
  extents => 0,
  glmax => 0,
  glmin => 0,
  intent_code => 0,
  intent_name => "",
  intent_p1 => 0,
  intent_p2 => 0,
  intent_p3 => 0,
  magic => "n+1",
  pixdim => [
      "1",
      "1",
      "1",
      "0.999997854232788",
      0,
      0,
      0,
      0
  ],
  qform_code => "1",
  qoffset_x => "-74.1070175170898",
  qoffset_y => "150.444946289062",
  qoffset_z => "112.782424926758",
  quatern_b => "-0.497181832790375",
  quatern_c => "0.513952970504761",
  quatern_d => "-0.502428293228149",
  regular => 0,
  scl_inter => 0,
  scl_slope => "1",
  session_error => 0,
  sform_code => 0,
  sizeof_hdr => "348",
  slice_code => 0,
  slice_duration => 0,
  slice_end => 0,
  slice_start => 0,
  srow_x => [
      0,
      0,
      0,
      0
  ],
  srow_y => [
      0,
      0,
      0,
      0
  ],
  srow_z => [
      0,
      0,
      0,
      0
  ],
  toffset => 0,
  vox_offset => "352",
  xyzt_units => "2"
};
my $ct_file_ids = [
86903
,86904
,86905
,86906
,86907
,86908
,86909
,86910
,86911
,86912
,86913
,86914
,86915
,86916
,86917
,86918
,86919
,86920
,86921
,86922
,86923
,86924
,86925
,86926
,86927
,86928
,86929
,86930
,86931
,86932
,86933
,86934
,86935
,86936
,86937
,86938
,86939
,86940
,86941
,86942
,86943
,86944
,86945
,86946
,86947
,86948
,86949
,86950
,86951
,86952
,86953
,86954
,86955
,86956
,86957
,86958
,86959
,86960
,86961
,86962
,86963
,86964
,86965
,86966
,86967
,86968
,86969
,86970
,86971
,86972
,86973
,86974
,86975
,86976
,86977
,86978
,86979
,86980
,86981
,86982
,86983
,86984
,86985
,86986
,86987
,86988
,86989
,86990
,86991
,86992
,86993
,86994
,86995
,86996
,86997
,86998
,86999
,87000
,87001
,87002
,87003
,87004
,87005
,87006
,87007
,87008
,87009
,87010
,87011
,87012
,87013
,87014
,87015
,87016
,87017
,87018
,87019
,87020
,87021
,87022
,87023
,87024
,87025
,87026
,87027
,87028
,87029
,87030
,87031
,87032
,87033
,87034
,87035
,87036
,87037
,87038
,87039
,87040
,87041
,87042
,87043
,87044
,87045
,87046
,87047
,87048
,87049
,87050
,87051
,87052
,87053
,87054
,87055
,87056
,87057
,87058
,87059
,87060
,87061
,87062
,87063
,87064
,87065
,87066
,87067
,87068
,87069
,87070
,87071
,87072
,87073
,87074
,87075
,87076
,87077
,87078
,87079
,87080
,87081
,87082
,87083
,87084
,87085
,87086
,87087
,87088
,87089
,87090
,87091
,87092
,87093
,87094
,87095
,87096
,87097
,87098
,87099
,87100
,87101
,87102
,87103
,87104
,87105
,87106
,87107
,87108
,87109
,87110
,87111
,87112
,87113
,87114
,87115
,87116
,87117
,87118
,87119
,87120
,87121
,87122
,87123
,87124
,87125
,87126
,87127
,87128
,87129
,87130
,87131
,87132
,87133
,87134
,87135
,87136
,87137
,87138
,87139
,87140
,87141
,87142
,87143
,87144
,87145
,87146
,87147
,87148
,87149
,87150
,87151
,87152
,87153
,87154
,87155
,87156
,87157
,87158
,87159
,87160
,87161
,87162
,87163
,87164
,87165
,87166
,87167
,87168
,87169
,87170
,87171
,87172
,87173
,87174
,87175
,87176
,87177
,87178
,87179
,87180
,87181
,87182
,87183
,87184
,87185
,87186
,87187
,87188
,87189
,87190
,87191
,87192
,87193
,87194
,87195
,87196
,87197
,87198
,87199
,87200
,87201
,87202
,87203
,87204
,87205
,87206
,87207
,87208
,87209
,87210
,87211
,87212
,87213
,87214
,87215
,87216
,87217
,87218
,87219
,87220
,87221
,87222
,87223
,87224
,87225
,87226
,87227
,87228
,87229
,87230
,87231
,87232
,87233
,87234
,87235
,87236
,87237
,87238
,87239
,87240
,87241
,87242
,87243
,87244
,87245
,87246
,87247
,87248
,87249
,87250
,87251
,87252
,87253
,87254
,87255
,87256
,87257
,87258
,87259
,87260
,87261
,87262
,87263
,87264
,87265
,87266
,87267
,87268
,87269
,87270
,87271
,87272
,87273
,87274
,87275
,87276
,87277
,87278
,87279
,87280
,87281
,87282
,87283
,87284
,87285
,87286
,87287
,87288
,87289
,87290
,87291
,87292
,87293
,87294
,87295
,87296
,87297
,87298
,87299
,87300
,87301
,87302
,87303
,87304
,87305
,87306
,87307
,87308
,87309
,87310
,87311
,87312
,87313
,87314
,87315
,87316
,87317
,87318
,87319
,87320
,87321
,87322
,87323
,87324
,87325
,87326
,87327
,87328
,87329
,87330
,87331
,87332
,87333
,87334
,87335
,87336
,87337
,87338
,87339
,87340
,87341
,87342
,87343
,87344
,87345
,87346
,87347
,87348
,87349
,87350
,87351
,87352
,87353
,87354
,87355
,87356
,87357
,87358
,87359
,87360
,87361
,87362
,87363
,87364
,87365
,87366
,87367
,87368
,87369
,87370
,87371
,87372
,87373
,87374
,87375
,87376
,87377
,87378
,87379
,87380
,87381
,87382
,87383
,87384
,87385
,87386
,87387
,87388
,87389
,87390
,87391
,87392
,87393
,87394
,87395
,87396
,87397
,87398
,87399
,87400
,87401
,87402
,87403
,87404
,87405
,87406
,87407
,87408
,87409
,87410
,87411
,87412
,87413
,87414
,87415
,87416
,87417
,87418
,87419
,87420
,87421
,87422
,87423
,87424
,87425
,87426
,87427
,87428
,87429
,87430
,87431
,87432
,87433
,87434
,87435
,87436
,87437
,87438
,87439
,87440
,87441
,87442
,87443
,87444
,87445
,87446
,87447
,87448
,87449
,87450
,87451
,87452
,87453
,87454
,87455
,87456
,87457
,87458
,87459
,87460
,87461
,87462
,87463
,87464
,87465
,87466
,87467
,87468
,87469
,87470
,87471
,87472
,87473
,87474
,87475
,87476
,87477
,87478
,87479
,87480
,87481
,87482
,87483
,87484
,87485
,87486
,87487
,87488
,87489
,87490
,87491
,87492
,87493
,87494
,87495
,87496
,87497
,87498
,87499
,87500
,87501
,87502
,87503
,87504
,87505
,87506
,87507
,87508
,87509
,87510
,87511
,87512
,87513
,87514
,87515
,87516
,87517
,87518
,87519
,87520
,87521
,87522
,87523
,87524
,87525
,87526
,87527
,87528
,87529
,87530
,87531
,87532
,87533
,87534
,87535
,87536
,87537
,87538
,87539
,87540
,87541
,87542
,87543
,87544
,87545
,87546
,87547
,87548
,87549
,87550
,87551
,87552
,87553
,87554
,87555
,87556
,87557
,87558
,87559
,87560
,87561
,87562
,87563
,87564
,87565
,87566
,87567
,87568
,87569
,87570
,87571
,87572
,87573
,87574
,87575
,87576
,87577
,87578
,87579
,87580
,87581
,87582
,87583
,87584
,87585
,87586
,87587
,87588
,87589
,87590
,87591
,87592
,87593
,87594
,87595
,87596
,87597
,87598
,87599
,87600
,87601
,87602
,87603
,87604
,87605
,87606
,87607
,87608
,87609
,87610
,87611
,87612
,87613
,87614
,87615
,87616
,87617
,87618
,87619
,87620
,87621
,87622
,87623
,87624
,87625
,87626
,87627
,87628
,87629
,87630
,87631
,87632
,87633
,87634
,87635
,87636
,87637
,87638
,87639
,87640
,87641
,87642
,87643
,87644
,87645
,87646
,87647
,87648
,87649
,87650
,87651
,87652
,87653
,87654
,87655
,87656
,87657
,87658
,87659
,87660
,87661
,87662
,87663
,87664
,87665
,87666
,87667
,87668
,87669
,87670
,87671
,87672
,87673
,87674
,87675
,87676
,87677
,87678
,87679
,87680
,87681
,87682
,87683
,87684
,87685
,87686
,87687
,87688
,87689
,87690
,87691
,87692
,87693
,87694
,87695
,87696
,87697
,87698
,87699
,87700
,87701
,87702
,87703
,87704
,87705
,87706
,87707
,87708
,87709
,87710
,87711
,87712
,87713
,87714
,87715
,87716
,87717
,87718
,87719
,87720
,87721
,87722
,87723
,87724
,87725
,87726
,87727
,87728
,87729
,87730
,87731
,87732
,87733
,87734
,87735
,87736
,87737
,87738
,87739
];
my $slice = "\01\00" x (256 * 256);

unless($#ARGV == 0) { die "Wrong # args" }

my $num_slices = @$ct_file_ids;
print "Num slices: $num_slices\n";
$spec->{dim}->[3] = $num_slices;

{
  my $nifti = Nifti::Create->new($ARGV[0]);
  $nifti->PopulateHeader($spec);
#print "nifti: ";
#Debug::GenPrint($dbg, $nifti, 1);
#print "\n";
  for my $i (0 .. $spec->{dim}->[3] - 1){
    my $file_id = $ct_file_ids->[$i];
    print "Need to add slice from file $file_id\n";
    #$nifti->AddSlice($slice, $i);
  }
}
