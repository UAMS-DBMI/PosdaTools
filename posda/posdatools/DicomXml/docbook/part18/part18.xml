<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!-- $Source: /home/bbennett/pass/archive/DicomXml/docbook/part18/part18.xml,v $ -->
<!-- $Date: 2014/05/08 19:55:24 $ -->
<!-- $Revision: 1.1 $ -->
<book xmlns="http://docbook.org/ns/docbook" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:xl="http://www.w3.org/1999/xlink" label="PS3.18" version="5.0" xml:id="PS3.18">
  <title>PS3.18</title>
  <subtitle>DICOM PS3.18 2013 - Web Services</subtitle>
  <info>
    <author>
      <orgname>DICOM Standards Committee</orgname>
    </author>
    <copyright>
      <year>2013</year>
      <holder>NEMA</holder>
    </copyright>
  </info>
  <chapter label="" status="1" xml:id="chapter_Notice">
    <title>Notice and Disclaimer</title>
    <para>The information in this publication was considered technically sound by the consensus of
      persons engaged in the development and approval of the document at the time it was developed.
      Consensus does not necessarily mean that there is unanimous agreement among every person
      participating in the development of this document.</para>
    <para>NEMA standards and guideline publications, of which the document contained herein is one,
      are developed through a voluntary consensus standards development process. This process brings
      together volunteers and/or seeks out the views of persons who have an interest in the topic
      covered by this publication. While NEMA administers the process and establishes rules to
      promote fairness in the development of consensus, it does not write the document and it does
      not independently test, evaluate, or verify the accuracy or completeness of any information or
      the soundness of any judgments contained in its standards and guideline publications.</para>
    <para>NEMA disclaims liability for any personal injury, property, or other damages of any nature
      whatsoever, whether special, indirect, consequential, or compensatory, directly or indirectly
      resulting from the publication, use of, application, or reliance on this document. NEMA
      disclaims and makes no guaranty or warranty, expressed or implied, as to the accuracy or
      completeness of any information published herein, and disclaims and makes no warranty that the
      information in this document will fulfill any of your particular purposes or needs. NEMA does
      not undertake to guarantee the performance of any individual manufacturer or seller's products
      or services by virtue of this standard or guide.</para>
    <para>In publishing and making this document available, NEMA is not undertaking to render
      professional or other services for or on behalf of any person or entity, nor is NEMA
      undertaking to perform any duty owed by any person or entity to someone else. Anyone using
      this document should rely on his or her own independent judgment or, as appropriate, seek the
      advice of a competent professional in determining the exercise of reasonable care in any given
      circumstances. Information and other standards on the topic covered by this publication may be
      available from other sources, which the user may wish to consult for additional views or
      information not covered by this publication.</para>
    <para>NEMA has no power, nor does it undertake to police or enforce compliance with the contents
      of this document. NEMA does not certify, test, or inspect products, designs, or installations
      for safety or health purposes. Any certification or other statement of compliance with any
      health or safety-related information in this document shall not be attributable to NEMA and is
      solely the responsibility of the certifier or maker of the statement.</para>
  </chapter>
  <chapter label="" status="1" xml:id="chapter_Foreword">
    <title>Foreword</title>
    <para>This DICOM Standard was developed according to the procedures of the DICOM Standards Committee.</para>
    <para>The DICOM Standard is structured as a multi-part document using the guidelines established in <xref linkend="biblio_ISODirectives3"/>.</para>
    <para><olink targetdoc="PS3.1" targetptr="PS3.1" xrefstyle="select: labelnumber"/> should be used as the base reference for the current parts of this standard.</para>
  </chapter>
  <chapter xml:id="chapter_1" label="1" status="1">
    <title>Scope</title>
    <para>This standard specifies a web-based service for accessing and presenting DICOM (Digital Imaging and Communications in Medicine) persistent objects (e.g., images, medical imaging reports). This is intended for distribution of results and images to healthcare professionals. It provides a simple mechanism for accessing a DICOM persistent object, through HTTP/HTTPS protocol, using DICOM UIDs (Unique Identifiers). Data may be retrieved either in a presentation-ready form as specified by the requester (e.g., JPEG or GIF) or in a native DICOM format. It does not support facilities for web searching of DICOM images. This standard relates only to DICOM persistent objects (not to other DICOM objects or to non-DICOM objects). Access control beyond the security mechanisms generally available to web applications is outside the scope of this standard.</para>
  </chapter>
  <chapter xml:id="chapter_2" label="2" status="1">
    <title>Conformance</title>
    <para>Systems claiming conformance to this standard shall function in accordance with all its mandatory sections.</para>
  </chapter>
  <chapter xml:id="chapter_3" label="3" status="1">
    <title>Normative References</title>
    <para>The following normative documents contain provisions that, through reference in this text, constitute provisions of this part of DICOM. For dated references, subsequent amendments to, or revisions of, any of these publications do not apply. However, parties to agreements based on this part of DICOM are encouraged to investigate the possibility of applying the most recent editions of the normative documents indicated below. For undated references, the latest edition of the normative document referred to applies. Members of ISO and IEC maintain registers of currently valid International Standards.</para>
    <para>ebRS ebXML Registry Service</para>
    <para>HL7 CDA Health Level Seven, Clinical Document Architecture (CDA)</para>
    <para>IETF RFC822 Standard for ARPA Internet Text Messages</para>
    <para>IETF RFC2045 and followings MIME Multipurpose Internet Mail Extension</para>
    <para>IETF RFC2396 Uniform Resource Identifiers (URI): Generic Syntax</para>
    <para>IETF RFC2616 Hypertext Transfer Protocol - HTTP/1.1</para>
    <para>IETF RFC3240 Application/dicom MIME Sub-type Registration</para>
    <para>IETF 4627 The application/json Media Type for JavaScript Object Notation (JSON)</para>
    <para>ISO/IEC 10918 JPEG Standard for digital compression and encoding of continuous-tone still images</para>
    <para>IHE ITI TF-2x: Appendix V IHE IT Infrastructure Technical Framework, Volume 2x, Appendix V (Web Services for IHE Transactions)</para>
  </chapter>
  <chapter xml:id="chapter_4" label="4" status="1">
    <title>Terms and Definitions</title>
    <para>For the purposes of this part of DICOM, the following terms and definitions apply.</para>
    <section xml:id="sect_4.1" label="4.1" status="2">
      <title>DICOM Persistent Object</title>
      <para>An instance of a data object as defined by <olink targetdoc="PS3.3" targetptr="PS3.3" xrefstyle="select: labelnumber"/> that has been allocated an unique identifier in the format specified for SOP Instance UID in <olink targetdoc="PS3.3" targetptr="PS3.3" xrefstyle="select: labelnumber"/> and has been chosen as an object to be saved securely for some period of time. Within the DICOM Standard, a DICOM Persistent Object is referred to as a Composite Service Object Pair (SOP) Instance.</para>
    </section>
    <section xml:id="sect_4.2" label="4.2" status="2">
      <title>Web Client System</title>
      <para>A system using Internet technologies (web, e-mail…) interested in retrieving DICOM Persistent Objects from a Web Enabled DICOM Server, through HTTP/HTTPS protocol.</para>
    </section>
    <section xml:id="sect_4.3" label="4.3" status="2">
      <title>Web Enabled DICOM Server</title>
      <para>A system managing DICOM Persistent Objects and able to transmit them on request to the Web Client System.</para>
    </section>
    <section xml:id="sect_4.4" label="4.4" status="2">
      <title>Web Access to DICOM Persistent Objects</title>
      <para>A service enabling the Web Client System to retrieve DICOM Persistent Objects managed by a Web Enabled DICOM Server, through HTTP/HTTPS protocol.</para>
    </section>
  </chapter>
  <chapter xml:id="chapter_5" label="5" status="1">
    <title>Symbols and Abbreviated Terms</title>
    <variablelist>
      <varlistentry>
        <term>DICOM</term>
        <listitem>
          <para>Digital Imaging and Communications in Medicine</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>HL7</term>
        <listitem>
          <para>Health Level Seven</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>HTML</term>
        <listitem>
          <para>HyperText Markup Language</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>HTTP</term>
        <listitem>
          <para>HyperText Transfer Protocol</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>HTTPs</term>
        <listitem>
          <para>HyperText Transfer Protocol, secured</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>IHE</term>
        <listitem>
          <para>Integrating the Healthcare Enterprise</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>MIME</term>
        <listitem>
          <para>Multipurpose Internet Mail Extensions</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>MTOM</term>
        <listitem>
          <para>Message Transmission Optimization Mechanism</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>QIDO-RS</term>
        <listitem>
          <para>Query based on ID for DICOM Objects by RESTful Services</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>REST</term>
        <listitem>
          <para>Representational State Transfer</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>RESTful</term>
        <listitem>
          <para>A RESTful Web service is a Web service implemented using REST architecture and HTTP (see <link xl:href="http://www.ics.uci.edu/~fielding/pubs/dissertation/fielding_dissertation.pdf"/>)</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>SOAP</term>
        <listitem>
          <para>Simple Object Access Protocol (SOAP12 for SOAP version 1.2)</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>SOP</term>
        <listitem>
          <para>Service Object Pair</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>STOW-RS</term>
        <listitem>
          <para>STore Over the Web by RESTful Services</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>UID</term>
        <listitem>
          <para>Unique (DICOM) Identifier</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>URL/URI</term>
        <listitem>
          <para>Uniform Resource Locator / Identifier</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>WADO-RS</term>
        <listitem>
          <para>Web Access to DICOM Objects by RESTful Services</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>WADO-URI</term>
        <listitem>
          <para>Web Access to DICOM Objects by URI</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>WADO-WS</term>
        <listitem>
          <para>Web Access to DICOM Objects by Web Services (WS*)</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>WS</term>
        <listitem>
          <para>Web Services</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>WSDL</term>
        <listitem>
          <para>Web Services Description Language</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>XML</term>
        <listitem>
          <para>eXtensible Markup Language</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>XOP</term>
        <listitem>
          <para>XML-binary Optimized Packaging</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </chapter>
  <chapter xml:id="chapter_6" label="6" status="1">
    <title>Data Communication Requirements</title>
    <section xml:id="sect_6.1" label="6.1" status="2">
      <title>Interaction</title>
      <para>
        <figure xml:id="figure_6-1" label="6-1" pgwide="1">
          <title>Interaction Diagram</title>
          <mediaobject>
            <imageobject>
              <imagedata fileref="figures/PS3.18_6-1.svg"/>
              <!--<imagedata fileref="part18_fromword_files/image002.png"/>-->
            </imageobject>
          </mediaobject>
        </figure>
      </para>
      <para>The interaction shall be as shown in <xref linkend="figure_6-1" xrefstyle="select: label"/>.</para>
      <para>Multiple communications modes are possible:</para>
      <itemizedlist>
        <listitem>
          <para>URI based using HTTP Get: WADO-URI request</para>
        </listitem>
        <listitem>
          <para>Web Services (WS) using HTTP Post: WADO-WS, either:</para>
          <orderedlist numeration="loweralpha">
            <listitem>
              <para>DICOM Requester (Retrieve Imaging Document Set)</para>
            </listitem>
            <listitem>
              <para>Rendered Requester (Retrieve Rendered Imaging Document Set)</para>
            </listitem>
            <listitem>
              <para>Metadata Requester (Retrieve Imaging Document Set Metadata)</para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>RESTful Services (RS) using HTTP Get: WADO-RS, either:</para>
          <orderedlist numeration="loweralpha">
            <listitem>
              <para>DICOM Requester (Retrieve Study, Series, or Instance DICOM Objects)</para>
            </listitem>
            <listitem>
              <para>Frame Pixel Data Requester (Retrieve Instance Frame Pixel Data)</para>
            </listitem>
            <listitem>
              <para>Bulk Data Requester (Retrieve Study, Series, Instance Bulk Data)</para>
            </listitem>
            <listitem>
              <para>Metadata Requester (Retrieve Study Metadata)</para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>RESTful Services (RS) using HTTP Get: QIDO-RS:</para>
          <orderedlist numeration="loweralpha">
            <listitem>
              <para>Query Requester (Search for Study, Series or Instance DICOM Objects)</para>
            </listitem>
          </orderedlist>
        </listitem>
        <listitem>
          <para>RESTful Services (RS) using HTTP POST: STOW-RS, either:</para>
          <orderedlist numeration="loweralpha">
            <listitem>
              <para>DICOM Creator (Store Instances)</para>
            </listitem>
            <listitem>
              <para>Metadata and Bulk Data Creator (Store Instances)</para>
            </listitem>
          </orderedlist>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sect_6.2" label="6.2" status="2">
      <title>WADO-URI Request</title>
      <para>The HTTP Request used shall use the GET method as defined in IETF RFC2616.</para>
      <section xml:id="sect_6.2.1" label="6.2.1" status="3">
        <title>Parameters of the HTTP Request</title>
        <para>The parameters of the &lt;query&gt; component of the Request-URI to be sent to the web Server through the HTTP GET method request shall be represented as defined in IETF RFC2396.</para>
        <note>
          <orderedlist numeration="arabic">
            <listitem>
              <para>Other components of the Request-URI depend on the configuration, e.g., location and script language of the Web Enabled DICOM Server.</para>
            </listitem>
            <listitem>
              <para>The means by which the Web Client System obtains the value of the necessary parameters for web accessing of DICOM objects is out of the scope of the standard.</para>
            </listitem>
          </orderedlist>
        </note>
      </section>
      <section xml:id="sect_6.2.2" label="6.2.2" status="3">
        <title>List of Media Types Supported in the Response</title>
        <para>The "Accept" field of the GET method request shall specify the Media type(s) acceptable to the Web Client System. The(se) Media type(s) shall include at least the items of the list of MIME types specified in <xref linkend="chapter_7" xrefstyle="template: Section %n"/> of this standard devoted to the DICOM persistent object types.</para>
        <note>
          <para>Typically the Accept field will be sent by a Web Client as "*/*". An optional parameter specifies the MIME type(s) preferred by the Web Client, as a subset of those specified in the "Accept" field.</para>
        </note>
      </section>
      <section xml:id="sect_6.2.3" label="6.2.3" status="3">
        <title>List of Character Sets Supported in the Response</title>
        <para>The "Accept-charset" field of the GET method request shall specify the character set of the object to be retrieved. If the "Accept-charset" field of the GET method is not present, or the Web Enabled DICOM Server does not support the specified character set, the character set of the response will be at the discretion of the Web Enabled DICOM Server.</para>
        <para>Note Typically the user of a Web Client does not have control over the "Accept-charset" field. An optional parameter specifies the character set to be used in the returned object.</para>
      </section>
    </section>
    <section xml:id="sect_6.3" label="6.3" status="2">
      <title>WADO-URI Response</title>
      <para>The response shall be an HTTP Response Message as specified in IETF RFC2616.</para>
      <note>
        <para>The content of the message-body varies according to the Media type as defined below.</para>
      </note>
      <section xml:id="sect_6.3.1" label="6.3.1" status="3">
        <title>Body of Single DICOM MIME Sub-type Part Response</title>
        <section xml:id="sect_6.3.1.1" label="6.3.1.1" status="4">
          <title>MIME Type</title>
          <para>The MIME type shall be 'application/dicom', as specified in IETF RFC3240.</para>
        </section>
        <section xml:id="sect_6.3.1.2" label="6.3.1.2" status="4">
          <title>Content</title>
          <para>The body content shall be a "Part 10 File" that includes a meta-header as defined in <olink targetdoc="PS3.10" targetptr="PS3.10" xrefstyle="select: labelnumber"/>.</para>
        </section>
        <section xml:id="sect_6.3.1.3" label="6.3.1.3" status="4">
          <title>Transfer Syntax</title>
          <para>The returned DICOM object shall be encoded using one of the transfer syntaxes specified in the transfer syntax query parameter as defined in <xref linkend="sect_8.2.11" xrefstyle="select: label"/> below. By default, the transfer syntax shall be "Explicit VR Little Endian".</para>
          <note>
            <para>This implies that retrieved images are sent uncompressed by default.</para>
          </note>
        </section>
      </section>
      <section xml:id="sect_6.3.2" label="6.3.2" status="3">
        <title>Body of Non-DICOM MIME Type Response</title>
        <section xml:id="sect_6.3.2.1" label="6.3.2.1" status="4">
          <title>MIME Type</title>
          <para>The MIME type shall be one on the MIME types defined in the contentType parameter, preferably the most desired by the Web Client, and shall be in any case compatible with the 'Accept' field of the GET method.</para>
          <note>
            <para>The HTTP behavior is that an error (406 - Not Acceptable) is returned if the required content type cannot be served.</para>
          </note>
        </section>
        <section xml:id="sect_6.3.2.2" label="6.3.2.2" status="4">
          <title>Content</title>
          <para>The content shall be a single MIME part containing the object to be retrieved.</para>
          <para>Note: Multiple objects in a response are not supported by this standard. The parameters select only a single object to retrieve. Most current Web Clients are able to retrieve single objects, within a "non multipart" MIME body, and are not able to support multipart/related or multipart/mixed responses.</para>
        </section>
      </section>
    </section>
    <section xml:id="sect_6.4" label="6.4" status="2">
      <title>WADO-WS Request/Response</title>
      <para>The DICOM Web Service defines several action types. An implementation shall support at least one of these actions. The three action types are:</para>
      <orderedlist>
        <listitem>
          <para>RetrieveImagingDocumentSet</para>
          <para>This action retrieves a set of DICOM instances and other objects. This action corresponds to the IHE XDS-I.b transaction RAD-69. The DICOM instances are formatted in accordance with <olink targetdoc="PS3.10" targetptr="PS3.10" xrefstyle="select: labelnumber"/>, and encapsulated in a Web Services response.</para>
        </listitem>
        <listitem>
          <para>RetrieveRenderedImagingDocumentSet</para>
          <para>This action retrieves a set of DICOM instances that have been rendered into the requested format. For example, if rendering into JPEG was requested, these will be the JPEG renderings of the requested set of DICOM objects.</para>
        </listitem>
        <listitem>
          <para>RetrieveImagingDocumentSetMetadata</para>
          <para>This action retrieves a set of DICOM instances presented as an Infoset with the bulk data removed. This service can retrieve either the full metadata, or a subset selected by XPath arguments. The XML encoding for the DICOM attributes is defined in <olink targetdoc="PS3.19" targetptr="PS3.19" xrefstyle="select: labelnumber"/>.</para>
        </listitem>
      </orderedlist>
      <para>The Web Services actions shall be fully compliant with the Basic Profile of WS-I as defined in IHE IT Infrastructure Technical Framework Vol 2x Annex V. All &lt;wsa:Action&gt; elements shall have the mustUnderstand attribute set (mustUnderstand="1").</para>
      <section xml:id="sect_6.4.1" label="6.4.1" status="3">
        <title>WS - RetrieveImagingDocumentSet</title>
        <section xml:id="sect_6.4.1.1" label="6.4.1.1" status="4">
          <title>Request</title>
          <para>The specific Web Services parameters to be used for the Retrieve Imaging Document Set action shall be as follows, in the order that they would appear in the WSDL definition:</para>
          <itemizedlist>
            <listitem>
              <para>The following types shall be imported (xsd:import) in the /definitions/types section:</para>
              <itemizedlist>
                <listitem>
                  <para>namespace="urn:ihe:rad:xdsi-b:2009", schema="XDSI.b_ImagingDocumentSource.xsd"</para>
                </listitem>
                <listitem>
                  <para>The baseline XDS.b schema (namespace="urn:ihe:iti:xds-b:2007", schema="XDS.b_DocumentRepository.xsd")</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>The /definitions/message/part/@element attribute of the Retrieve Imaging Document Set Request message shall be an "iherad:RetrieveImagingDocumentSetRequest" as defined below.</para>
            </listitem>
            <listitem>
              <para>The /definitions/message/part/@element attribute of the Retrieve Imaging Document Set Response message shall be an "ihe:RetrieveDocumentSetResponse" as defined below.</para>
            </listitem>
            <listitem>
              <para>The /definitions/portType/operation/input/@wsaw:Action attribute for the Retrieve Imaging Document Set Request message shall be "urn:ihe:rad:2009:RetrieveImagingDocumentSet".</para>
            </listitem>
            <listitem>
              <para>The /definitions/portType/operation/output/@wsaw:Action attribute for the Retrieve Imaging Document Set Response message shall be "urn:ihe:iti:2007:RetrieveDocumentSetResponse".</para>
            </listitem>
            <listitem>
              <para>The /definitions/binding/operation/soap12:operation/@soapAction attribute shall be "urn:ihe:rad:2009:RetrieveImagingDocumentSet".</para>
            </listitem>
          </itemizedlist>
          <para>The &lt;iherad:RetrieveImagingDocumentSetRequest/&gt; element for use with the Retrieve Imaging Document Set Request Message is defined as:</para>
          <itemizedlist>
            <listitem>
              <para>One or more &lt;iherad:StudyRequest/&gt; elements each of which includes a "studyInstanceUID" attribute identifying the study associated with the DICOM images/ objects being retrieved. Each &lt;iherad:StudyRequest/&gt; element shall contain:</para>
              <itemizedlist>
                <listitem>
                  <para>One or more &lt;iherad:SeriesRequest/&gt; elements each of which includes a "seriesInstanceUID" attribute identifying the series associated with the DICOM images/ objects being retrieved. Each &lt;iherad:SeriesRequest/&gt; element shall contain:</para>
                  <itemizedlist>
                    <listitem>
                      <para>One or more &lt;ihe:DocumentRequest/&gt; elements, each one representing an individual document that the requestor wants to retrieve from the Web Server. Each &lt;ihe:DocumentRequest/&gt; element contains:</para>
                      <itemizedlist>
                        <listitem>
                          <para>An optional &lt;ihe:RepositoryUniqueId/&gt; element that identifies the Web Server from which the document is to be retrieved. This value corresponds to XDSDocumentEntry.repositoryUniqueId. The RepositoryUniqueID is similar to a DICOM AETitle, but is a uniqueID assigned to the WADO-WS Web Server rather than a locally assigned string identifier. There will be a separate RepositoryUniqueID for each web service end point.</para>
                        </listitem>
                        <listitem>
                          <para>A required &lt;ihe:DocumentUniqueId/&gt; element that identifies the document within the source. For example, this value could be a SOP Instance UID obtained from a Key Object Selection (KOS) instance.</para>
                        </listitem>
                        <listitem>
                          <para>An optional &lt;ihe:HomeCommunityId/&gt; element. See the IHE Profiles for the definition and possible uses of this element.</para>
                        </listitem>
                        <listitem>
                          <para>An optional &lt;wado:Anonymize/&gt; element.</para>
                        </listitem>
                        <listitem>
                          <para>An optional &lt;wado:FrameNumber/&gt; element.</para>
                        </listitem>
                        <listitem>
                          <para>A required &lt;iherad:TransferSyntaxUIDList/&gt; element that contains a list of one or more &lt;ihe:TransferSyntaxUID&gt; elements. Each of the &lt;iherad:TransferSyntaxUID&gt; elements represent one of the transfer syntax encodings that the Imaging Document Consumer is capable of processing.</para>
                        </listitem>
                      </itemizedlist>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
        </section>
        <section xml:id="sect_6.4.1.2" label="6.4.1.2" status="4">
          <title>Response</title>
          <para>A Web Server shall provide the document(s) indicated in the request. The Web Server shall return the document(s) or an error code when the document could not be returned. The pixel data shall be encoded using one of the DICOM transfer syntaxes included in the Retrieve Imaging Document Set Request Message. If the Imaging Document Source cannot encode the pixel data using any of the requested transfer syntaxes then an error status shall be returned.</para>
          <section xml:id="sect_6.4.1.2.1" label="6.4.1.2.1" status="5">
            <title>Form of the Response</title>
            <para>The &lt;ihe:RetrieveDocumentResponse/&gt; element for use with the Retrieve Imaging Document Set Response Message is defined as:</para>
            <itemizedlist>
              <listitem>
                <para>A required /ihe:RetrieveDocumentSetResponse/rs:RegistryResponse element</para>
              </listitem>
              <listitem>
                <para>An optional sequence of &lt;ihe:DocumentResponse/&gt; elements containing</para>
                <itemizedlist>
                  <listitem>
                    <para>An optional &lt;ihe:HomeCommunityId/&gt; element. The value of this element shall be the same as the value of the /RetrieveImagingDocumentSetRequest/StudyRequest/SeriesRequest/DocumentRequest/HomeCommunityId element in the Retrieve Document Set Request Message. If the &lt;ihe:HomeCommunityId/&gt; element is not present in the Retrieve Document Set Request Message, this value shall not be present.</para>
                  </listitem>
                  <listitem>
                    <para>An optional &lt;ihe:RepositoryUniqueId/&gt; that identifies the Imaging Document Source from which the document is to be retrieved. The value of this element shall be the same as the value of the /RetrieveImagingDocumentSetRequest/StudyRequest/SeriesRequest/DocumentRequest/RepositoryUniqueId element in the original Retrieve Imaging Document Set Request Message. This value corresponds to XDSDocumentEntry.repositoryUniqueId.</para>
                  </listitem>
                  <listitem>
                    <para>A required &lt;ihe:DocumentUniqueId/&gt; that identifies the document within the Imaging Document Source. The value of this element shall be the same as the value of the /RetrieveImagingDocumentSetRequest/StudyRequest/SeriesRequest/DocumentRequest/DocumentUniqueId element in the original Retrieve Imaging Document Set Request Message. This value corresponds to the SOP Instance UID in the Retrieve Document Request.</para>
                  </listitem>
                  <listitem>
                    <para>A conditional &lt;wado:FrameNumber/&gt; that identifies the frame within the source document. It shall be present if and only if &lt;wado:FrameNumber/&gt; was in the request</para>
                  </listitem>
                  <listitem>
                    <para>A required &lt;ihe:Document/&gt; element that contains the retrieved document as an XOP Infoset.</para>
                  </listitem>
                  <listitem>
                    <para>A required &lt;ihe:mimeType/&gt; element that indicates the MIME type of the retrieved document.</para>
                  </listitem>
                </itemizedlist>
              </listitem>
            </itemizedlist>
            <para>The /RetrieveDocumentSetResponse/rs:RegistryResponse/@status attributes provides the overall status of the request: It shall contain one of the following values:</para>
            <itemizedlist>
              <listitem>
                <para>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success</para>
              </listitem>
              <listitem>
                <para>urn:ihe:iti:2007:ResponseStatusType:PartialSuccess</para>
              </listitem>
              <listitem>
                <para>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Failure</para>
              </listitem>
            </itemizedlist>
            <para>See ITI TF-2a: 4.1.13 Error Reporting for the interpretation of these values.</para>
            <para>For each document requested in a /RetrieveImagingDocumentSetRequest/StudyRequest/SeriesRequest/DocumentRequest element:</para>
            <itemizedlist>
              <listitem>
                <para>If the document is successfully retrieved (without warning) then no /RetrieveDocumentSetResponse/rs:RegistryResponse/rs:RegistryErrorList/ rs:RegistryError element shall be present and a /RetrieveDocumentSetResponse/DocumentResponse/Document element shall be returned containing the document as base64binary encoded data.</para>
              </listitem>
              <listitem>
                <para>If a warning is reported when retrieving the document, then a /RetrieveDocumentSetResponse/rs:RegistryResponse/rs:RegistryErrorList/ rs:RegistryError element shall be returned with:</para>
                <itemizedlist>
                  <listitem>
                    <para>@severity is urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Warning</para>
                  </listitem>
                  <listitem>
                    <para>@errorCode is specified</para>
                  </listitem>
                  <listitem>
                    <para>@codeContext contains the warning message</para>
                  </listitem>
                  <listitem>
                    <para>@location contains the DocumentUniqueId of the document requested</para>
                  </listitem>
                  <listitem>
                    <para>The document shall be returned in an instance of /RetrieveDocumentSetResponse/DocumentResponse/Document as base64binary encoded data. The returned document and warning are correlated via the DocumentUniqueId.</para>
                  </listitem>
                </itemizedlist>
              </listitem>
              <listitem>
                <para>If an error is reported when retrieving a document, then a /RetrieveDocumentSetResponse/rs:RegistryResponse/rs:RegistryErrorList/ rs:RegistryError element shall be returned with:</para>
                <itemizedlist>
                  <listitem>
                    <para>@severity is urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Error</para>
                  </listitem>
                  <listitem>
                    <para>@errorCode is specified</para>
                  </listitem>
                  <listitem>
                    <para>@codeContext contains the error message</para>
                  </listitem>
                  <listitem>
                    <para>@location contains the DocumentUniqueId of the document requested</para>
                  </listitem>
                  <listitem>
                    <para>No corresponding RetrieveDocumentSetResponse/DocumentResponse element shall be returned</para>
                  </listitem>
                </itemizedlist>
              </listitem>
            </itemizedlist>
            <para>The error conditions for failures and associated error codes are given below in section 6.4.4. These errors shall be detected and the associated errorCode returned if that error occurs. Additional errors defined in the ebRS standard, in ITI TF-2: 4.1.13 "Error Reporting", and defined by the implementer may be returned.</para>
          </section>
          <section xml:id="sect_6.4.1.2.2" label="6.4.1.2.2" status="5">
            <title>JPIP</title>
            <para>If the Web Client specifies a transfer syntax field of 1.2.840.10008.1.2.4.94 (DICOM JPIP Referenced Transfer Syntax) or 1.2.840.10008.1.2.4.95 (DICOM JPIP Referenced Deflate Transfer Syntax), and the Web Server supports the requested transfer syntax the following behavior is expected:</para>
            <itemizedlist>
              <listitem>
                <para>If the DICOM Image Object(s) already have the same JPIP transfer syntax as the one indicated in the request, the Retrieve Imaging Document Set Response shall include the DICOM Image Objects unchanged.</para>
              </listitem>
              <listitem>
                <para>If the DICOM Image Object(s) have a transfer syntax that differs from that of the request, the Retrieve Imaging Document Set Response shall include the DICOM image with the transfer syntax changed to the requested transfer syntax. In addition, the pixel data Attribute (7FE0,0010 tag) will have been removed and replaced with a Pixel Data Provider URL (0028,7FE0 tag). The URL represents the JPIP request and will include the specific target information.</para>
              </listitem>
              <listitem>
                <para>Upon receipt of this Retrieve Imaging Document Set Response, the Imaging Document Consumer may request the pixel data from the pixel data provider using the supplied URL. Additional parameters required by the application may be appended to the URL when accessing the pixel data provider.</para>
              </listitem>
              <listitem>
                <para>For example, a JPIP request for a 200 by 200 pixel rendition of the entire image can be constructed from the Pixel Data Provider URL as follows:</para>
                <itemizedlist>
                  <listitem>
                    <para>Pixel Data Provider URL (0028,7FE0) = https://server.xxx/jpipserver.cgi?target=imgxyz.jp2,</para>
                  </listitem>
                  <listitem>
                    <para>URL Generated by the application = https://server.xxx/jpipserver.cgi?target=imgxyz.jp2&amp;fsiz=200,200</para>
                  </listitem>
                </itemizedlist>
              </listitem>
            </itemizedlist>
          </section>
        </section>
      </section>
      <section xml:id="sect_6.4.2" label="6.4.2" status="3">
        <title>WS - RetrieveRenderedImagingDocumentSet</title>
        <section xml:id="sect_6.4.2.1" label="6.4.2.1" status="4">
          <title>Request</title>
          <para>The specific Web Services parameters to be used for the Retrieve Rendered Imaging Document Set action shall be as follows, in the order that they would appear in the WSDL definition:</para>
          <itemizedlist>
            <listitem>
              <para>The following types shall be imported (xsd:import) in the /definitions/types section:</para>
              <itemizedlist>
                <listitem>
                  <para>namespace="urn:ihe:rad:xdsi-b:2009", schema="XDSI.b_ImagingDocumentSource.xsd"</para>
                </listitem>
                <listitem>
                  <para>The baseline XDS.b schema (namespace="urn:ihe:iti:xds-b:2007", schema="XDS.b_DocumentRepository.xsd")</para>
                </listitem>
                <listitem>
                  <para>The baseline DICOM WADO-WS schema (namespace="urn:dicom:wado:ws:2011", schema="dicom.wado.ws.2011.xsd")</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>The /definitions/message/part/@element attribute of the Retrieve Rendered Imaging Document Set Request message shall be a "wado:RetrieveRenderedImagingDocumentSetRequest" as defined below.</para>
            </listitem>
            <listitem>
              <para>The /definitions/message/part/@element attribute of the Retrieve Rendered Imaging Document Set Response message shall be a "wado:RetrieveRenderedImagingDocumentSetResponse" as defined below.</para>
            </listitem>
            <listitem>
              <para>The /definitions/portType/operation/input/@wsaw:Action attribute for the Retrieve Rendered Imaging Document Set Request message shall be "urn:dicom:ws:wado:2011:RetrieveRenderedImagingDocumentSet".</para>
            </listitem>
            <listitem>
              <para>The /definitions/portType/operation/output/@wsaw:Action attribute for the Retrieve Imaging Document Set Response message shall be "urn:dicom:ws:wado:2011:RetrieveRenderedImagingDocumentSetResponse".</para>
            </listitem>
            <listitem>
              <para>The /definitions/binding/operation/soap12:operation/@soapAction attribute shall be "urn:dicom:ws:wado:2011:RetrieveRenderedImagingDocumentSet".</para>
            </listitem>
          </itemizedlist>
          <para>The &lt;wado:RetrieveRenderedImagingDocumentSetRequest/&gt; element for use with the Retrieve Imaging Document Set Request Message is defined as:</para>
          <itemizedlist>
            <listitem>
              <para>One or more &lt;wado:StudyRequest/&gt; elements each of which includes a "studyInstanceUID" attribute identifying the study associated with the DICOM images/ objects being retrieved. Each &lt;iherad:StudyRequest/&gt; element shall contain:</para>
              <itemizedlist>
                <listitem>
                  <para>One or more &lt;wado:SeriesRequest/&gt; elements each of which includes a "seriesInstanceUID" attribute identifying the series associated with the DICOM images/ objects being retrieved. Each &lt;iherad:SeriesRequest/&gt; element shall contain:</para>
                  <itemizedlist>
                    <listitem>
                      <para>One or more &lt;wado:RenderedDocumentRequest/&gt; elements, each one representing an individual document that the requestor wants to retrieve from the Web Server. Each &lt;wado:DocumentRequest/&gt; element contains:</para>
                      <itemizedlist>
                        <listitem>
                          <para>An optional &lt;ihe:RepositoryUniqueId/&gt; element that identifies the Web Server from which the document is to be retrieved. This value corresponds to XDSDocumentEntry.repositoryUniqueId. The RepositoryUniqueID is similar to a DICOM AETitle, but is a uniqueID assigned to the WADO-WS Web Server rather than a locally assigned string identifier. There will be a separate RepositoryUniqueID for each web service end point.</para>
                        </listitem>
                        <listitem>
                          <para>A required &lt;ihe:DocumentUniqueId/&gt; element that identifies the document within the source. This value corresponds to the SOP Instance UID referenced within the DICOM manifest.</para>
                        </listitem>
                        <listitem>
                          <para>An optional &lt;ihe:HomeCommunityId/&gt; element that corresponds to the home attribute of the Identifiable class in ebRIM.</para>
                        </listitem>
                        <listitem>
                          <para>An optional &lt;wado:Annotation/&gt; element.</para>
                        </listitem>
                        <listitem>
                          <para>An optional &lt;wado:Rows/&gt; element.</para>
                        </listitem>
                        <listitem>
                          <para>An optional &lt;wado:Columns/&gt; element.</para>
                        </listitem>
                        <listitem>
                          <para>An optional &lt;wado:Region/&gt; element.</para>
                        </listitem>
                        <listitem>
                          <para>An optional &lt;wado:WindowCenter/&gt; element.</para>
                        </listitem>
                        <listitem>
                          <para>An optional &lt;wado:WindowWidth/&gt; element.</para>
                        </listitem>
                        <listitem>
                          <para>An optional &lt;wado:ImageQuality/&gt; element.</para>
                        </listitem>
                        <listitem>
                          <para>An optional &lt;wado:PresentationUID/&gt; element.</para>
                        </listitem>
                        <listitem>
                          <para>An optional &lt;wado:PresentationSeriesUID/&gt; element.</para>
                        </listitem>
                        <listitem>
                          <para>An optional &lt;wado:Anonymize/&gt; element</para>
                        </listitem>
                        <listitem>
                          <para>An optional &lt;wado:FrameNumber/&gt; element.</para>
                        </listitem>
                        <listitem>
                          <para>A required &lt;wado:ContentTypeList/&gt; element that contains a list of one or more &lt;wado:ContentType&gt; elements.</para>
                        </listitem>
                        <listitem>
                          <para>An optional &lt;wado:CharsetList/&gt; element that contains a list of one or more &lt;wado:Charset&gt; elements.</para>
                        </listitem>
                      </itemizedlist>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
        </section>
        <section xml:id="sect_6.4.2.2" label="6.4.2.2" status="4">
          <title>Response</title>
          <para>An Web Server shall render and then provide the document(s) indicated in the request. The Web Server shall return the rendered documents or an error code when the document could not be returned. The rendered forms shall be the subset specified, and in the format requested. If the Imaging Document Source cannot render the pixel data in that manner then an error status shall be returned.</para>
          <para>The &lt;wado:RetrieveRenderedImagingDocumentResponse/&gt; element for use with the Retrieve Imaging Document Set Response Message, Retrieve Rendered Imaging Document Set Response Message and Retrieve Imaging Document Set Metadata Response Message is defined as:</para>
          <itemizedlist>
            <listitem>
              <para>A required /ihe:RetrieveDocumentSetResponse/rs:RegistryResponse element</para>
            </listitem>
            <listitem>
              <para>An optional sequence of &lt;wado:RenderedDocumentResponse/&gt; elements containing:</para>
              <itemizedlist>
                <listitem>
                  <para>A &lt;ihe:HomeCommunityId/&gt; element. The value of this element shall be the same as the value of the StudyRequest/SeriesRequest/DocumentRequest/HomeCommunityId element in the Request Message. If the &lt;ihe:HomeCommunityId/&gt; element is not present in the Request Message, this value shall not be present.</para>
                </listitem>
                <listitem>
                  <para>A required &lt;ihe:RepositoryUniqueId/&gt; that identifies the Imaging Document Source from which the document was retrieved. The value of this element shall be the same as the value of the StudyRequest/SeriesRequest/DocumentRequest/RepositoryUniqueId element in the original Request Message.</para>
                </listitem>
                <listitem>
                  <para>A required &lt;wado:SourceDocumentUniqueId/&gt; that identifies the source document. The value of this element shall be the same as the value of the StudyRequest/SeriesRequest/DocumentRequest/DocumentUniqueId element in the original Request Message. This value identifies the source, and is not an ID for the resulting rendered document.</para>
                </listitem>
                <listitem>
                  <para>A conditional &lt;wado:FrameNumber/&gt; that identifies the frame within the source document. It shall be present if and only if &lt;wado:FrameNumber/&gt; was in the request.</para>
                </listitem>
                <listitem>
                  <para>A required &lt;wado:Annotation/&gt; element that contains the actual value used.</para>
                </listitem>
                <listitem>
                  <para>A required &lt;wado:Rows/&gt; element that contains the actual value used.</para>
                </listitem>
                <listitem>
                  <para>A required &lt;wado:Columns/&gt; element that contains the actual value used.</para>
                </listitem>
                <listitem>
                  <para>A required &lt;wado:Region/&gt; element that contains the actual value used.</para>
                </listitem>
                <listitem>
                  <para>A required &lt;wado:WindowCenter/&gt; element that contains the actual value used.</para>
                </listitem>
                <listitem>
                  <para>A required &lt;wado:WindowWidth/&gt; element that contains the actual value used.</para>
                </listitem>
                <listitem>
                  <para>A required &lt;wado:ImageQuality/&gt; element that contains the actual value used.</para>
                </listitem>
                <listitem>
                  <para>A required &lt;wado:PresentationUID/&gt; element that contains the actual value used if a PresentationUID was used.</para>
                </listitem>
                <listitem>
                  <para>A required &lt;wado:PresentationSeriesUID/&gt; element that contains the actual value used if a PresentationSeriesUID was used.</para>
                </listitem>
                <listitem>
                  <para>An optional &lt;wado:Anonymize/&gt; element that shall be present if the rendered instance was anonymized.</para>
                </listitem>
                <listitem>
                  <para>A required &lt;ihe:Document/&gt; element that contains the rendered document encoded as an XOP Infoset.</para>
                </listitem>
                <listitem>
                  <para>A required &lt;ihe:mimeType/&gt; element that indicates the MIME type of the retrieved document.</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
          <para>The /RetrieveDocumentSetResponse/rs:RegistryResponse/@status attributes provides the overall status of the request: It shall contain one of the following values:</para>
          <itemizedlist>
            <listitem>
              <para>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success</para>
            </listitem>
            <listitem>
              <para>urn:ihe:iti:2007:ResponseStatusType:PartialSuccess</para>
            </listitem>
            <listitem>
              <para>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Failure</para>
            </listitem>
          </itemizedlist>
          <para>For each document requested in a /RetrieveRenderedImagingDocumentSetRequest/StudyRequest/SeriesRequest/DocumentRequest element:</para>
          <itemizedlist>
            <listitem>
              <para>If the document is successfully rendered (without warning) then no /RetrieveRenderedImagingDocumentSetResponse/rs:RegistryResponse/rs:RegistryErrorList/ rs:RegistryError element shall be present and a /RetrieveRenderedImagingDocumentSetResponse/DocumentResponse/Document element shall be returned containing the rendered document as base64binary encoded data.</para>
            </listitem>
            <listitem>
              <para>If a warning is reported when retrieving the document, then a /RetrieveRenderedImagingDocumentSetResponse/rs:RegistryResponse/rs:RegistryErrorList/ rs:RegistryError element shall be returned with:</para>
              <itemizedlist>
                <listitem>
                  <para>@severity is urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Warning</para>
                </listitem>
                <listitem>
                  <para>@errorCode is specified</para>
                </listitem>
                <listitem>
                  <para>@codeContext contains the warning message</para>
                </listitem>
                <listitem>
                  <para>@location contains the DocumentUniqueId of the document requested</para>
                </listitem>
                <listitem>
                  <para>The rendered document shall be returned in an instance of /RetrieveRenderedImagingDocumentSetResponse/DocumentResponse/Document as base64binary encoded data. The returned document and warning are correlated via the DocumentUniqueId.</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>If an error is reported when retrieving a document, then a /RetrieveRenderedImagingDocumentSetResponse/rs:RegistryResponse/rs:RegistryErrorList/ rs:RegistryError element shall be returned with:</para>
              <itemizedlist>
                <listitem>
                  <para>@severity is urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Error</para>
                </listitem>
                <listitem>
                  <para>@errorCode is specified</para>
                </listitem>
                <listitem>
                  <para>@codeContext contains the error message</para>
                </listitem>
                <listitem>
                  <para>@location contains the DocumentUniqueId of the document requested</para>
                </listitem>
                <listitem>
                  <para>No corresponding RetrieveRenderedImagingDocumentSetResponse/DocumentResponse element shall be returned</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
          <para>The error conditions for failures and associated error codes are given below in section 6.4.4. These errors shall be detected and the associated errorCode returned if that error occurs. Additional errors defined in the ebRS standard, in ITI TF-2: 4.1.13 "Error Reporting", and defined by the implementer may be returned.</para>
        </section>
      </section>
      <section xml:id="sect_6.4.3" label="6.4.3" status="3">
        <title>WS - RetrieveImagingDocumentSetMetadataRequest</title>
        <section xml:id="sect_6.4.3.1" label="6.4.3.1" status="4">
          <title>Request</title>
          <para>The specific Web Services parameters to be used for the Retrieve Imaging Document Set Metadata action shall be as follows, in the order that they would appear in the WSDL definition:</para>
          <itemizedlist>
            <listitem>
              <para>The following types shall be imported (xsd:import) in the /definitions/types section:</para>
              <itemizedlist>
                <listitem>
                  <para>namespace="urn:ihe:rad:xdsi-b:2009", schema="XDSI.b_ImagingDocumentSource.xsd"</para>
                </listitem>
                <listitem>
                  <para>The baseline XDS.b schema (namespace="urn:ihe:iti:xds-b:2007", schema="XDS.b_DocumentRepository.xsd")</para>
                </listitem>
                <listitem>
                  <para>The baseline DICOM WADO-WS schema (namespace="urn:dicom:wado:ws:2011", schema="dicom.wado.ws.2011.xsd")</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>The /definitions/message/part/@element attribute of the Retrieve Imaging Document Information Set Request message shall be defined an "wado:RetrieveImagingDocumentSetInformationRequest" as defined below.</para>
            </listitem>
            <listitem>
              <para>The /definitions/message/part/@element attribute of the Retrieve Imaging Document Set Information Response message shall be defined an "wado:RetrieveImagingDocumentSetInformationResponse" as defined below.</para>
            </listitem>
            <listitem>
              <para>The /definitions/portType/operation/input/@wsaw:Action attribute for the Retrieve Imaging Document Set Information Request message shall be "urn:wado:2011:RetrieveImagingDocumentSetInformation".</para>
            </listitem>
            <listitem>
              <para>The /definitions/portType/operation/output/@wsaw:Action attribute for the Retrieve Imaging Document Set Information Response message shall be "urn:wado:2011:RetrieveImagingDocumentSetInformationResponse".</para>
            </listitem>
            <listitem>
              <para>The /definitions/binding/operation/soap12:operation/@soapAction attribute shall be "urn:wado:2011:RetrieveImagingDocumentSetInformation".</para>
            </listitem>
          </itemizedlist>
          <para>The &lt;wado:RetrieveImagingDocumentSetInformationRequest/&gt; element for use with the Retrieve Imaging Document Set Request Message is defined as:</para>
          <itemizedlist>
            <listitem>
              <para>One or more &lt;wado:StudyRequest/&gt; elements each of which includes a "studyInstanceUID" attribute identifying the study associated with the DICOM images/objects being retrieved. Each &lt;iherad:StudyRequest/&gt; element shall contain:</para>
              <itemizedlist>
                <listitem>
                  <para>One or more &lt;wado:SeriesRequest/&gt; elements each of which includes a "seriesInstanceUID" attribute identifying the series associated with the DICOM images/objects being retrieved. Each &lt;iherad:SeriesRequest/&gt; element shall contain:</para>
                  <itemizedlist>
                    <listitem>
                      <para>One or more &lt;wado:DocumentInformationRequest/&gt; elements, each one representing an individual document that the requestor wants to retrieve from the Web Server. Each &lt; wado:DocumentInformationRequest /&gt; element contains:</para>
                      <itemizedlist>
                        <listitem>
                          <para>· An required &lt;ihe:RepositoryUniqueId/&gt; element that identifies the Web Server from which the document is to be retrieved. This value corresponds to XDSDocumentEntry.repositoryUniqueId. The RepositoryUniqueID is similar to a DICOM AE Title, but is a uniqueID assigned to the WADO-WS Web Server rather than a locally assigned string identifier. There will be a separate RepositoryUniqueID for each web service end point.</para>
                        </listitem>
                        <listitem>
                          <para>A required &lt;ihe:DocumentUniqueId/&gt; element that identifies the document within the source. For example, this value could be a SOP Instance UID obtained from a Key Object Selection (KOS) instance.</para>
                        </listitem>
                        <listitem>
                          <para>An optional &lt;ihe:HomeCommunityId/&gt; element. See the IHE Profiles for the definition and possible uses of this element.</para>
                        </listitem>
                        <listitem>
                          <para>An optional &lt;wado:Anonymize/&gt; element</para>
                        </listitem>
                        <listitem>
                          <para>A required &lt;wado:XPath/&gt; that contains the text corresponding to the XPath "filter" applied to the Native DICOM Model transposition of the object, as defined in <olink targetdoc="PS3.19" targetptr="PS3.19" xrefstyle="select: labelnumber"/>.</para>
                          <note>
                            <para>If the requested filter is "/", then all of the metadata is requested.</para>
                          </note>
                        </listitem>
                      </itemizedlist>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
        </section>
        <section xml:id="sect_6.4.3.2" label="6.4.3.2" status="4">
          <title>Response</title>
          <para>A Web Server shall extract information from each document specified in a Document Set Information Request. This shall be done by the logical equivalent of:</para>
          <orderedlist numeration="arabic">
            <listitem>
              <para>convert the non-pixel data for each of the requested data into an XML encoded form</para>
            </listitem>
            <listitem>
              <para>apply each of the wado:XPath elements to this XML encoded form</para>
            </listitem>
            <listitem>
              <para>provide the XPath response as part of the Document Set Information Response.</para>
            </listitem>
          </orderedlist>
          <para>See <olink targetdoc="PS3.19" targetptr="PS3.19" xrefstyle="select: labelnumber"/> for details on conversion to XML encoded form.</para>
          <para>The Web Server shall return the XPath results or an error code when the document could not be processed.</para>
          <para>The &lt;wado:RetrieveImagingDocumentSetInformationResponse/&gt; element for use with the Retrieve Imaging Document Set Response Message is additionally defined as:</para>
          <itemizedlist>
            <listitem>
              <para>A required /wado:RetrieveImagingDocumentSetInformationResponse/rs:RegistryResponse element</para>
            </listitem>
            <listitem>
              <para>An optional sequence of &lt;wado:DocumentInformationResponse/&gt; elements containing:</para>
              <itemizedlist>
                <listitem>
                  <para>A &lt;ihe:HomeCommunityId/&gt; element. The value of this element shall be the same as the value of the StudyRequest/SeriesRequest/DocumentRequest/HomeCommunityId element in the Request Message. If the &lt;ihe:HomeCommunityId/&gt; element is not present in the Request Message, this value shall not be present.</para>
                </listitem>
                <listitem>
                  <para>A required &lt;ihe:DocumentUniqueId/&gt; that identifies the document within the Web Server. The value of this element shall be the same as the value of the StudyRequest/SeriesRequest/DocumentRequest/DocumentUniqueId element in the original Request Message. This value corresponds to the SOP Instance UID.</para>
                </listitem>
                <listitem>
                  <para>A conditional &lt;wado:FrameNumber/&gt; that identifies the frame within the source document. It shall be present if and only if &lt;wado:FrameNumber/&gt; was in the request.</para>
                </listitem>
                <listitem>
                  <para>One &lt;wado:XPathResponseList/&gt; containing:</para>
                  <itemizedlist>
                    <listitem>
                      <para>A required &lt;wado:XPathResponse&gt; that contains the XPath results for each &lt;wado:XPath/&gt; elements, in the same order as in the request encoded as an XOP Infoset. The response element shall be empty if there was no XPath match.</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
          <para>The /RetrieveImagingDocumentSetInformationResponse/rs:RegistryResponse/@status attributes provides the overall status of the request: It shall contain one of the following values:</para>
          <itemizedlist>
            <listitem>
              <para>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success</para>
            </listitem>
            <listitem>
              <para>urn:ihe:iti:2007:ResponseStatusType:PartialSuccess</para>
            </listitem>
            <listitem>
              <para>urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Failure</para>
            </listitem>
          </itemizedlist>
          <para>For each document requested in a /RetrieveImagingDocumentSetInformationRequest/StudyRequest/SeriesRequest/DocumentRequest element:</para>
          <itemizedlist>
            <listitem>
              <para>If the document is successfully retrieved (without warning) then no /RetrieveImagingDocumentSetInformationResponse/rs:RegistryResponse/rs:RegistryErrorList/ rs:RegistryError element shall be present and a /RetrieveImagingDocumentSetInformationResponse/DocumentResponse/Document element shall be returned containing the document as base64binary encoded data.</para>
            </listitem>
            <listitem>
              <para>If a warning is reported when retrieving the document, then a /RetrieveImagingDocumentSetInformationResponse/rs:RegistryResponse/rs:RegistryErrorList/ rs:RegistryError element shall be returned with:</para>
              <itemizedlist>
                <listitem>
                  <para>@severity is urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Warning</para>
                </listitem>
                <listitem>
                  <para>@errorCode is specified</para>
                </listitem>
                <listitem>
                  <para>@codeContext contains the warning message</para>
                </listitem>
                <listitem>
                  <para>@location contains the DocumentUniqueId of the document requested</para>
                </listitem>
                <listitem>
                  <para>The document shall be returned in an instance of /RetrieveDocumentSetResponse/DocumentResponse/Document as base64binary encoded data. The returned document and warning are correlated via the DocumentUniqueId.</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>If an error is reported when retrieving a document, then a /RetrieveImagingDocumentSetInformationResponse/rs:RegistryResponse/rs:RegistryErrorList/ rs:RegistryError element shall be returned with:</para>
              <itemizedlist>
                <listitem>
                  <para>@severity is urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Error</para>
                </listitem>
                <listitem>
                  <para>@errorCode is specified</para>
                </listitem>
                <listitem>
                  <para>@codeContext contains the error message</para>
                </listitem>
                <listitem>
                  <para>@location contains the DocumentUniqueId of the document requested</para>
                </listitem>
                <listitem>
                  <para>No corresponding RetrieveDocumentSetResponse/DocumentResponse element shall be returned</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
          <para>The error conditions for failures and associated error codes are given below in section 6.4.4. These errors shall be detected and the associated errorCode returned if that error occurs. Additional errors defined in the ebRS standard, in ITI TF-2: 4.1.13 "Error Reporting", and defined by the implementer may be returned.</para>
        </section>
      </section>
      <section xml:id="sect_6.4.4" label="6.4.4" status="3">
        <title>Error Codes</title>
        <para>The following errorCodes are defined and shall be used to report any of the associated error and warning situations. Other errorCodes may be present for other error and warning situations.</para>
        <table frame="box" rules="all" xml:id="table_6.4-1" label="6.4-1">
          <caption>Error Codes</caption>
          <thead>
            <tr valign="top">
              <th align="center" colspan="1" rowspan="1">
                <para>Error Code</para>
              </th>
              <th align="center" colspan="1" rowspan="1">
                <para>Error Situation</para>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>urn:dicom:wado:XXX1</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Unable to anonymize the requested instance(s).</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>urn:dicom:wado:XXX2</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Web Server does not support anonymization.</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>urn:dicom:wado:XXX3</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>The requested instance(s) are not immediately available, but can be made available by manual request.</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>urn:dicom:wado:XXX4</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Instance is no longer available, e.g., document retention rules have caused it to be removed or relocated.</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>urn:dicom:wado:XXX5</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>The requested instance(s) cannot be returned because the size or count exceeds resource limits.</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>urn:dicom:wado:XXX6</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Web Server does not support the requested format or transfer syntax.</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>urn:dicom:wado:XXX7</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>The requested instance(s) cannot be provided in the requested format or transfer syntax.</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>urn:dicom:wado:XXX8</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Single image format is not available for multi-frame images.</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>urn:dicom:wado:XXX9</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Identifier does not match SOP Class (see <olink targetdoc="PS3.7" targetptr="PS3.7" xrefstyle="select: labelnumber"/> C-MOVE)</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>urn:dicom:wado:XX10</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Inconsistent identifiers, e.g., Study and Series are correct but Series is in a different Study (see <olink targetdoc="PS3.7" targetptr="PS3.7" xrefstyle="select: labelnumber"/> C-MOVE)</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>urn:dicom:wado:XX11</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>SOP Class not supported (see <olink targetdoc="PS3.7" targetptr="PS3.7" xrefstyle="select: labelnumber"/> C-MOVE)</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>urn:dicom:wado:XX12</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Invalid parameter value in request (see <olink targetdoc="PS3.7" targetptr="PS3.7" xrefstyle="select: labelnumber"/> C-MOVE)</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>urn:dicom:wado:XX13</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Unsupported parameter in request (see <olink targetdoc="PS3.7" targetptr="PS3.7" xrefstyle="select: labelnumber"/> C-MOVE)</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>urn:dicom:wado:XX14</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Processing Failure (see <olink targetdoc="PS3.7" targetptr="PS3.7" xrefstyle="select: labelnumber"/> C-MOVE)</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>urn:dicom:wado:XX15</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Study Instance UID not known</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>urn:dicom:wado:XX16</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Series Instance UID not known</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>urn:dicom:wado:XX17</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Document UID not known</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>urn:dicom:wado:XX18</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Out of range Frame number</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>urn:dicom:wado:XX19</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Presentation UID not known</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>urn:dicom:wado:XX20</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Presentation Series UID not known</para>
              </td>
            </tr>
          </tbody>
        </table>
      </section>
    </section>
    <section xml:id="sect_6.5" label="6.5" status="2">
      <title>WADO-RS Request/Response</title>
      <para>The DICOM RESTful Service defines several action types. An implementation shall support all the following six action types:</para>
      <orderedlist numeration="arabic">
        <listitem>
          <para>RetrieveStudy</para>
          <para>This action retrieves the set of DICOM instances associated with a given study unique identifier (UID). The response can be DICOM or bulk data depending on the "Accept" type, and is encapsulated in a multipart MIME response.</para>
        </listitem>
        <listitem>
          <para>RetrieveSeries</para>
          <para>This action retrieves the set of DICOM instances associated with a given study and series UID. The response can be DICOM or bulk data depending on the "Accept" type, and is encapsulated in a multipart MIME response.</para>
        </listitem>
        <listitem>
          <para>RetrieveInstance</para>
          <para>This action retrieves the DICOM instance associated with the given study, series, and SOP Instance UID. The response can be DICOM or bulk data depending on the "Accept" type, and is encapsulated in a multipart MIME response.</para>
        </listitem>
        <listitem>
          <para>RetrieveFrames</para>
          <para>This action retrieves the DICOM frames for a given study, series, SOP Instance UID, and frame numbers. The response is pixel data, and encapsulated in a multipart MIME response.</para>
        </listitem>
        <listitem>
          <para>RetrieveBulkdata</para>
          <para>This action retrieves the bulk data for a given bulk data URL. The response is a single bulk data item.</para>
        </listitem>
        <listitem>
          <para>RetrieveMetadata</para>
          <para>This action retrieves the DICOM instances presented as the full study metadata with the bulk data removed. The response is XML encoded metadata for the DICOM attributes as defined in <olink targetdoc="PS3.19" targetptr="PS3.19" xrefstyle="select: labelnumber"/>.</para>
        </listitem>
      </orderedlist>
      <para>All responses will be HTTP multipart messages.</para>
      <para>DICOM objects returned shall be <olink targetdoc="PS3.10" targetptr="PS3.10" xrefstyle="select: labelnumber"/> binary objects encoded in a requested Transfer Syntax (Explicit VR Little Endian by default) with one message part per DICOM Instance.</para>
      <para>
        <figure xml:id="figure_6.5-1" label="6.5-1" pgwide="1">
          <title>Mapping between IOD and HTTP message parts</title>
          <mediaobject>
            <imageobject>
              <imagedata fileref="part18_fromword_files/image004.png"/>
            </imageobject>
          </mediaobject>
        </figure>
      </para>
      <para>Other types of responses will be encoded in the following manner: (see <xref linkend="figure_6.5-1" xrefstyle="select: label"/>).</para>
      <itemizedlist>
        <listitem>
          <para>All XML responses shall be encoded as described in the Native DICOM Model defined in <olink targetdoc="PS3.19" targetptr="PS3.19" xrefstyle="select: labelnumber"/> with one message part per XML object.</para>
        </listitem>
        <listitem>
          <para>Uncompressed bulk and pixel data shall be encoded in a Little Endian format using the application/octet-stream media type with one message part per bulk data item.</para>
        </listitem>
        <listitem>
          <para>Compressed pixel data may be encoded in one of three ways:</para>
          <itemizedlist>
            <listitem>
              <para>Single-frame pixel data encoded using a single-frame media type (one message part)</para>
            </listitem>
            <listitem>
              <para>Multi-frame pixel data encoded using a single-frame media type (one frame per message part)</para>
            </listitem>
            <listitem>
              <para>Multi-frame or video pixel data encoded using a multi-frame media type (multiple frames in one message part)</para>
            </listitem>
          </itemizedlist>
        </listitem>
      </itemizedlist>
      <para>Compressed pixel data shall be encoded using the following Media Types. Media Types corresponding to several DICOM Transfer Syntax UIDs require a transfer-syntax parameter, as shown in <xref linkend="table_6.5-1" xrefstyle="select: label"/>, to disambiguate the request.</para>
      <note>
        <para>If the Transfer Syntax is not specified, then a reversible (lossless) encoding is used.</para>
      </note>
      <table frame="box" rules="all" xml:id="table_6.5-1" label="6.5-1">
        <caption>Media Type Mapping to Transfer Syntax</caption>
        <thead>
          <tr valign="top">
            <th align="center" colspan="1" rowspan="1">
              <para>
                <emphasis role="bold">DICOM Transfer Syntax UID</emphasis>
              </para>
            </th>
            <th align="center" colspan="1" rowspan="1">
              <para>
                <emphasis role="bold">Media Type and Parameters</emphasis>
              </para>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr valign="top">
            <td align="left" colspan="2" rowspan="1">
              <para>
                <emphasis role="bold">Single-frame media types</emphasis>
              </para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.50</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>image/dicom+jpeg; transfer-syntax=1.2.840.10008.1.2.4.50</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.51</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>image/dicom+jpeg; transfer-syntax=1.2.840.10008.1.2.4.51</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.57</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>image/dicom+jpeg; transfer-syntax=1.2.840.10008.1.2.4.57</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.70</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>image/dicom+jpeg</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.70</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>image/dicom+jpeg; transfer-syntax=1.2.840.10008.1.2.4.70</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.5</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>image/dicom+rle</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.5</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>image/dicom+rle; transfer-syntax=1.2.840.10008.1.2.5</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.80</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>image/dicom+jpeg-ls</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.80</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>image/dicom+jpeg-ls; transfer-syntax=1.2.840.10008.1.2.4.80</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.81</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>image/dicom+jpeg-ls; transfer-syntax=1.2.840.10008.1.2.4.81</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.90</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>image/dicom+jp2</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.90</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>image/dicom+jp2; transfer-syntax=1.2.840.10008.1.2.4.90</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.91</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>image/dicom+jp2; transfer-syntax=1.2.840.10008.1.2.4.91</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.92</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>image/dicom+jpx</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.92</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>image/dicom+jpx; transfer-syntax=1.2.840.10008.1.2.4.92</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.93</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>image/dicom+jpx; transfer-syntax=1.2.840.10008.1.2.4.93</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="2" rowspan="1">
              <para>
                <emphasis role="bold">Multi-frame media types</emphasis>
              </para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.92</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>image/dicom+jpx</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.92</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>image/dicom+jpx; transfer-syntax=1.2.840.10008.1.2.4.92</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.93</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>image/dicom+jpx; transfer-syntax=1.2.840.10008.1.2.4.93</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.100</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>video/mpeg; transfer-syntax=1.2.840.10008.1.2.4.100</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.101</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>video/mpeg; transfer-syntax=1.2.840.10008.1.2.4.101</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.102</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>video/mp4; transfer-syntax=1.2.840.10008.1.2.4.102</para>
            </td>
          </tr>
          <tr valign="top">
            <td align="left" colspan="1" rowspan="1">
              <para>1.2.840.10008.1.2.4.103</para>
            </td>
            <td align="left" colspan="1" rowspan="1">
              <para>video/mp4; transfer-syntax=1.2.840.10008.1.2.4.103</para>
            </td>
          </tr>
        </tbody>
      </table>
      <note>
        <para>For the media type image/dicom+jp2 Transfer Syntaxes, 1.2.840.10008.1.2.4.90 and 1.2.840.10008.1.2.4.91, the image does not include the jp2 wrapper.</para>
      </note>
      <para>HTTP Request field Accept is used in the header lines by the client in a HTTP protocol transaction to indicate the data responses that are acceptable from the server. HTTP Response fields Content-Type and parameters are used in the header lines by the server in a HTTP protocol transaction to indicate the type and encoding of data returning to the client. All lines are RFC822 format headers. All HTTP header fields whose use is not defined by WADO-RS are presumed to have the meaning defined by the HTTP standard.</para>
      <para>The server is required to support uncompressed bulk and pixel data (application/octet-stream) and must be able to deliver all bulk data in that form unless it is available only in a lossy-compressed format.</para>
      <section xml:id="sect_6.5.1" label="6.5.1" status="3">
        <title>WADO-RS - RetrieveStudy</title>
        <para>This action retrieves the set of DICOM instances associated with a given study unique identifier (UID). The response can be DICOM or bulk data depending on the "Accept" type, and is encapsulated in a multipart MIME response.</para>
        <section xml:id="sect_6.5.1.1" label="6.5.1.1" status="4">
          <title>Request</title>
          <para>The specific Services resource to be used for the RetrieveStudy action shall be as follows:</para>
          <itemizedlist>
            <listitem>
              <para>Resource</para>
              <itemizedlist>
                <listitem>
                  <para>{SERVICE}/studies/{StudyInstanceUID}, where</para>
                  <itemizedlist>
                    <listitem>
                      <para>{SERVICE} is the base URL for the service. This may be a combination of protocol (either http or https), host, port, and application.</para>
                    </listitem>
                    <listitem>
                      <para>{StudyInstanceUID} is the study instance UID for a single study.</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Method</para>
              <itemizedlist>
                <listitem>
                  <para>GET</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Headers</para>
              <itemizedlist>
                <listitem>
                  <para>Accept - A comma-separated list of representation schemes, in preference order, which will be accepted by the service in the response to this request. The types allowed for this request header are as follows:</para>
                  <itemizedlist>
                    <listitem>
                      <para>multipart/related; type=application/dicom; [transfer-syntax={TransferSyntaxUID}]</para>
                      <para>Specifies that the response can be DICOM Instances encoded in <olink targetdoc="PS3.10" targetptr="PS3.10" xrefstyle="select: labelnumber"/> format. If <emphasis role="italic">transfer-syntax</emphasis> is not specified the server can freely choose which Transfer Syntax to use for each Instance.</para>
                    </listitem>
                    <listitem>
                      <para>multipart/related; type=application/octet-stream</para>
                      <para>Specifies that the response can be Little Endian uncompressed bulk data.</para>
                    </listitem>
                    <listitem>
                      <para>multipart/related; type={MediaType}</para>
                      <para>Specifies that the response can be pixel data encoded using a {MediaType} listed in <xref linkend="table_6.5-1" xrefstyle="select: label"/> (including parameters).</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
          <note>
            <para>An example of a more complicated accept header with multiple transfer syntaxes:</para>
            <itemizedlist mark="none">
              <listitem>
                <para>User is interested in receiving JPEG2000 pixel data in lossless or compressed format but is willing to accept JPEG as well.</para>
                <itemizedlist mark="none">
                  <listitem>
                    <para>The Accept request would contain the following comma-separated parameters:</para>
                    <itemizedlist mark="none">
                      <listitem>
                        <para>Accept: multipart/related=image/dicom+jpx; transfer-syntax=1.2.840.10008.1.2.4.92,, multipart/related=image/dicom+jpx; transfer-syntax=1.2.840.10008.1.2.4.93, multipart/related=image/dicom+jpeg</para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                  <listitem>
                    <para>or alternatively, multiple Accept headers:</para>
                    <itemizedlist mark="none">
                      <listitem>
                        <para>Accept: multipart/related=image/dicom+jpx; transfer-syntax=1.2.840.10008.1.2.4.92,</para>
                      </listitem>
                      <listitem>
                        <para>Accept: multipart/related=image/dicom+jpx; transfer-syntax=1.2.840.10008.1.2.4.93</para>
                      </listitem>
                      <listitem>
                        <para>Accept: multipart/related=application/dicom+jpeg</para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                </itemizedlist>
              </listitem>
            </itemizedlist>
          </note>
        </section>
        <section xml:id="sect_6.5.1.2" label="6.5.1.2" status="4">
          <title>Response</title>
          <para>The Server shall provide the document(s) indicated in the request. In order to parse the bulk data items it is necessary to also retrieve the XML metadata for the Study.</para>
          <para>The Server shall return the document(s), or an error code when the document(s) cannot be returned. If the server cannot convert all of the data to any of the requested media types/Transfer Syntaxes, then an error code shall be returned, either a "Not Acceptable" response if no data is returned or a "Partial Content" response if only some data is returned.</para>
          <para>The client can compare the SOP Instance UIDs or bulk data URLs in the metadata and the message response to determine which bulk data elements have been returned.</para>
          <para>All response formats have a content type of multipart/related with a message boundary separator. The response format depends on the Accept header specified in the request.</para>
          <section xml:id="sect_6.5.1.2.1" label="6.5.1.2.1" status="5">
            <title>DICOM Response</title>
            <itemizedlist>
              <listitem>
                <para>Content-Type:</para>
                <itemizedlist>
                  <listitem>
                    <para>multipart/related; type=application/dicom; boundary={MessageBoundary}</para>
                  </listitem>
                </itemizedlist>
              </listitem>
              <listitem>
                <para>The entire multipart response contains every instance for the specified Study that can be converted to one of the requested Transfer Syntaxes.</para>
              </listitem>
              <listitem>
                <para>Each item in the multipart response represents a DICOM SOP Instance with the following http headers:</para>
                <itemizedlist>
                  <listitem>
                    <para>Content-Type: application/dicom</para>
                  </listitem>
                </itemizedlist>
              </listitem>
            </itemizedlist>
          </section>
          <section xml:id="sect_6.5.1.2.2" label="6.5.1.2.2" status="5">
            <title>Bulk Data Response</title>
            <itemizedlist>
              <listitem>
                <para>Content-Type:</para>
                <itemizedlist>
                  <listitem>
                    <para>multipart/related; type=application/octet-stream; boundary={MessageBoundary}</para>
                  </listitem>
                  <listitem>
                    <para>multipart/related; type={MediaType}; boundary={MessageBoundary}</para>
                  </listitem>
                </itemizedlist>
              </listitem>
              <listitem>
                <para>The entire multipart response contains all bulk data for the specified Study that can be converted to one of the requested media types.</para>
              </listitem>
              <listitem>
                <para>Each item in the response is one of:</para>
                <itemizedlist>
                  <listitem>
                    <para>an uncompressed bulk data element encoded in Little Endian binary format with the following headers:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Content-Type: application/octet-stream</para>
                      </listitem>
                      <listitem>
                        <para>Content-Location: {BulkDataURL}</para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                  <listitem>
                    <para>a compressed bulk data element from a SOP Instance in the Study encoded in a single-frame compression {MediaType} with the following headers:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Content-Type: {MediaType}</para>
                      </listitem>
                      <listitem>
                        <para>Content-Location: {BulkDataURL}</para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                  <listitem>
                    <para>a compressed frame from a multi-frame SOP Instance in the Study encoded in a single-frame media type with the following headers:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Content-Type: {MediaType}</para>
                      </listitem>
                      <listitem>
                        <para>Content-Location: {BulkDataURL}/frames/{FrameNumber}</para>
                        <note>
                          <para>Each frame will come in a separate part.</para>
                        </note>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                  <listitem>
                    <para>a set of compressed frames from a SOP Instance in the Study encoded in a multi-frame media type with the following headers:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Content-Type: {MediaType}</para>
                      </listitem>
                      <listitem>
                        <para>Content-Location: {BulkDataURL}[/frames/{FrameList}]</para>
                        <itemizedlist>
                          <listitem>
                            <para>{FrameList} is a list of frames separated by %2C (comma). It may be omitted if the message part includes all frames for the specified bulk pixel data object.</para>
                          </listitem>
                        </itemizedlist>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                </itemizedlist>
              </listitem>
            </itemizedlist>
          </section>
        </section>
      </section>
      <section xml:id="sect_6.5.2" label="6.5.2" status="3">
        <title>WADO-RS - RetrieveSeries</title>
        <para>This action retrieves the set of DICOM instances associated with a given study and series UID. The response can be DICOM or bulk data depending on the "Accept" type, and is encapsulated in a multipart MIME response.</para>
        <section xml:id="sect_6.5.2.1" label="6.5.2.1" status="4">
          <title>Request</title>
          <para>The specific resource to be used for the RetrieveSeries action shall be as follows:</para>
          <itemizedlist>
            <listitem>
              <para>Resource</para>
              <itemizedlist>
                <listitem>
                  <para>{SERVICE}/studies/{StudyInstanceUID}/series/{SeriesInstanceUID}, where</para>
                  <itemizedlist>
                    <listitem>
                      <para>{SERVICE} is the base URL for the service. This may be a combination of protocol (either http or https), host, port, and application.</para>
                    </listitem>
                    <listitem>
                      <para>{StudyInstanceUID} is the study instance UID for a single study.</para>
                    </listitem>
                    <listitem>
                      <para>{SeriesInstanceUID} is the series instance UID for a single series.</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Method</para>
              <itemizedlist>
                <listitem>
                  <para>GET</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Headers</para>
              <itemizedlist>
                <listitem>
                  <para>Accept - A comma-separated list of representation schemes, in preference order, which will be accepted by the service in the response to this request. The types allowed for this request header are as follows:</para>
                  <itemizedlist>
                    <listitem>
                      <para>multipart/related; type=application/dicom; [transfer-syntax={TransferSyntaxUID}]</para>
                      <para>Specifies that the response can be DICOM Instances encoded in <olink targetdoc="PS3.10" targetptr="PS3.10" xrefstyle="select: labelnumber"/> format. If <emphasis role="italic">transfer-syntax</emphasis> is not specified the server can freely choose which Transfer Syntax to use for each Instance.</para>
                    </listitem>
                    <listitem>
                      <para>multipart/related; type=application/octet-stream;</para>
                      <para>Specifies that the response can be Little Endian uncompressed bulk data.</para>
                    </listitem>
                    <listitem>
                      <para>multipart/related; type={MediaType}</para>
                      <para>Specifies that the response can be pixel data encoded using a {MediaType} listed in <xref linkend="table_6.5-1" xrefstyle="select: label"/> (including parameters).</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
        </section>
        <section xml:id="sect_6.5.2.2" label="6.5.2.2" status="4">
          <title>Response</title>
          <para>The Server shall provide the document(s) indicated in the request. In order to parse the bulk data items it is necessary to also retrieve the XML metadata for the Study.</para>
          <para>The Server shall return the document(s), or an error code when the document(s) cannot be returned. If the server cannot convert all of the data to any of the requested media types/Transfer Syntaxes, then an error code shall be returned, either a "Not Acceptable" response if no data is returned or a "Partial Content" response if only some data is returned.</para>
          <para>The client can compare the SOP Instance UIDs or bulk data URLs in the metadata and the message response to determine which bulk data elements have been returned.</para>
          <para>All response formats have a content type of multipart/related with a message boundary separator. The response format depends on the Accept header specified in the request.</para>
          <section xml:id="sect_6.5.2.2.1" label="6.5.2.2.1" status="5">
            <title>DICOM Response</title>
            <itemizedlist>
              <listitem>
                <para>Content-Type:</para>
                <itemizedlist>
                  <listitem>
                    <para>multipart/related; type=application/dicom; boundary={MessageBoundary}</para>
                  </listitem>
                </itemizedlist>
              </listitem>
              <listitem>
                <para>The entire multipart response contains every instance for the specified Series that can be converted to one of the requested Transfer Syntaxes.</para>
              </listitem>
              <listitem>
                <para>Each item in the multipart response represents a DICOM SOP Instance with the following http headers:</para>
                <itemizedlist>
                  <listitem>
                    <para>Content-Type: application/dicom</para>
                  </listitem>
                </itemizedlist>
              </listitem>
            </itemizedlist>
          </section>
          <section xml:id="sect_6.5.2.2.2" label="6.5.2.2.2" status="5">
            <title>Bulk Data Response</title>
            <itemizedlist>
              <listitem>
                <para>Content-Type:</para>
                <itemizedlist>
                  <listitem>
                    <para>multipart/related; type= application/octet-stream; boundary={MessageBoundary}</para>
                  </listitem>
                  <listitem>
                    <para>multipart/related; type={MediaType}; boundary={MessageBoundary}</para>
                  </listitem>
                </itemizedlist>
              </listitem>
              <listitem>
                <para>The entire multipart response contains all bulk data for the specified Series that can be converted to one of the requested media types.</para>
              </listitem>
              <listitem>
                <para>Each item in the response is one of:</para>
                <itemizedlist>
                  <listitem>
                    <para>an uncompressed bulk data element encoded in Little Endian binary format with the following headers:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Content-Type: application/octet-stream</para>
                      </listitem>
                      <listitem>
                        <para>Content-Location: {BulkDataURL}</para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                  <listitem>
                    <para>a compressed bulk data element from a SOP Instance in the Series encoded in a single-frame media type with the following headers:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Content-Type: {MediaType}</para>
                      </listitem>
                      <listitem>
                        <para>Content-Location: {BulkDataURL}</para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                  <listitem>
                    <para>a compressed frame from a multi-frame SOP Instance in the Series encoded in a single-frame media type with the following headers:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Content-Type: {MediaType}</para>
                      </listitem>
                      <listitem>
                        <para>Content-Location: {BulkDataURL}/frames/{FrameNumber}</para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                  <listitem>
                    <para>a set of compressed frames from a multi-frame SOP Instance in the Series encoded in a multi-frame media type with the following headers:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Content-Type: {MediaType}</para>
                      </listitem>
                      <listitem>
                        <para>Content-Location: {BulkDataURL}[/frames/{FrameList}]</para>
                        <itemizedlist>
                          <listitem>
                            <para>{FrameList} is a list of frames separated by %2C (comma). It may be omitted if the message part includes all frames for the specified bulk pixel data object.</para>
                          </listitem>
                        </itemizedlist>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                </itemizedlist>
              </listitem>
            </itemizedlist>
          </section>
        </section>
      </section>
      <section xml:id="sect_6.5.3" label="6.5.3" status="3">
        <title>WADO-RS - RetrieveInstance</title>
        <para>This action retrieves the DICOM instance associated with the given study, series, and SOP Instance UID. The response can be DICOM or bulk data depending on the "Accept" type, and is encapsulated in a multipart MIME response.</para>
        <section xml:id="sect_6.5.3.1" label="6.5.3.1" status="4">
          <title>Request</title>
          <para>The specific resource to be used for the RetrieveInstance action shall be as follows:</para>
          <itemizedlist>
            <listitem>
              <para>Resource</para>
              <itemizedlist>
                <listitem>
                  <para>{SERVICE}/studies/{StudyInstanceUID}/series/{SeriesInstanceUID}/instances/{SOPInstanceUID}, where</para>
                  <itemizedlist>
                    <listitem>
                      <para>{SERVICE} is the base URL for the service. This may be a combination of protocol (either http or https), host, port, and application.</para>
                    </listitem>
                    <listitem>
                      <para>{StudyInstanceUID} is the study instance UID for a single study.</para>
                    </listitem>
                    <listitem>
                      <para>{SeriesInstanceUID} is the series instance UID for a single series.</para>
                    </listitem>
                    <listitem>
                      <para>{SOPInstanceUID} is the SOP Instance UID for a single SOP Instance.</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Method</para>
              <itemizedlist>
                <listitem>
                  <para>GET</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Headers</para>
              <itemizedlist>
                <listitem>
                  <para>Accept - A comma-separated list of representation schemes, in preference order, which will be accepted by the service in the response to this request. The types allowed for this request header are as follows:</para>
                  <itemizedlist>
                    <listitem>
                      <para>multipart/related; type=application/dicom; [transfer-syntax={TransferSyntaxUID}]</para>
                      <para>Specifies that the response can be DICOM Instances encoded in <olink targetdoc="PS3.10" targetptr="PS3.10" xrefstyle="select: labelnumber"/> format. If <emphasis role="italic">transfer-syntax</emphasis> is not specified the server can freely choose which Transfer Syntax to use for each Instance.</para>
                    </listitem>
                    <listitem>
                      <para>multipart/related; type=application/octet-stream;</para>
                      <para>Specifies that the response can be Little Endian uncompressed bulk data.</para>
                    </listitem>
                    <listitem>
                      <para>multipart/related; type={MediaType}</para>
                      <para>Specifies that the response can be pixel data encoded using a {MediaType} listed in <xref linkend="table_6.5-1" xrefstyle="select: label"/> (including parameters).</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
        </section>
        <section xml:id="sect_6.5.3.2" label="6.5.3.2" status="4">
          <title>Response</title>
          <para>The Server shall provide either a single DICOM <olink targetdoc="PS3.10" targetptr="PS3.10" xrefstyle="select: labelnumber"/> object for the SOP Instance or one or more bulk data items. In order to parse the bulk data items it is necessary to also retrieve the XML metadata for the Study.</para>
          <para>The Server shall return the document(s), or an error code when the document(s) cannot be returned. If the server cannot convert all of the bulk data to any of the requested media types, then an error code shall be returned, either a "Not Acceptable" response if no data is returned or a "Partial Content" response if only some data is returned.</para>
          <para>The client can compare the bulk data URLs in the metadata and the message response to determine which bulk data elements have been returned.</para>
          <para>All response formats have a content type of multipart/related with a message boundary separator. The response format depends on the Accept header specified in the request.</para>
          <section xml:id="sect_6.5.3.2.1" label="6.5.3.2.1" status="5">
            <title>DICOM Response</title>
            <itemizedlist>
              <listitem>
                <para>Content-Type:</para>
                <itemizedlist>
                  <listitem>
                    <para>multipart/related; type=application/dicom; boundary={MessageBoundary}</para>
                  </listitem>
                </itemizedlist>
              </listitem>
              <listitem>
                <para>The multipart response contains a single item representing the specified DICOM SOP Instance with the following http headers:</para>
                <itemizedlist>
                  <listitem>
                    <para>Content-Type: application/dicom</para>
                  </listitem>
                </itemizedlist>
              </listitem>
            </itemizedlist>
          </section>
          <section xml:id="sect_6.5.3.2.2" label="6.5.3.2.2" status="5">
            <title>Bulk Data Response</title>
            <itemizedlist>
              <listitem>
                <para>Content-Type:</para>
                <itemizedlist>
                  <listitem>
                    <para>multipart/related; type=application/octet-stream; boundary={MessageBoundary}</para>
                  </listitem>
                  <listitem>
                    <para>multipart/related; type={MediaType}; boundary={MessageBoundary}</para>
                  </listitem>
                </itemizedlist>
              </listitem>
              <listitem>
                <para>The entire multipart response contains all bulk data for the specified Instance that can be converted to one of the requested media types.</para>
              </listitem>
              <listitem>
                <para>Each item in the response is one of:</para>
                <itemizedlist>
                  <listitem>
                    <para>an uncompressed bulk data element encoded in Little Endian binary format with the following headers:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Content-Type: application/octet-stream</para>
                      </listitem>
                      <listitem>
                        <para>Content-Location: {BulkDataURL}</para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                  <listitem>
                    <para>a compressed bulk data element from a SOP Instance encoded in a single-frame media type with the following headers:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Content-Type: {MediaType}</para>
                      </listitem>
                      <listitem>
                        <para>Content-Location: {BulkDataURL}</para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                  <listitem>
                    <para>a compressed frame from a multi-frame SOP Instance encoded in a single-frame media type with the following headers:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Content-Type: {MediaType}</para>
                      </listitem>
                      <listitem>
                        <para>Content-Location: {BulkDataURL}/frames/{FrameNumber}</para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                  <listitem>
                    <para>a set of compressed frames from a multi-frame SOP Instance encoded in a multi-frame media type with the following headers:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Content-Type: {MediaType}</para>
                      </listitem>
                      <listitem>
                        <para>Content-Location: {BulkDataURL}[/frames/{FrameList}]</para>
                        <itemizedlist>
                          <listitem>
                            <para>{FrameList} is a list of frames separated by %2C (comma). It may be omitted if the message part includes all frames for the specified bulk pixel data object.</para>
                          </listitem>
                        </itemizedlist>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                </itemizedlist>
              </listitem>
            </itemizedlist>
          </section>
        </section>
      </section>
      <section xml:id="sect_6.5.4" label="6.5.4" status="3">
        <title>WADO-RS - RetrieveFrames</title>
        <para>This action retrieves the DICOM frames for a given study, series, SOP Instance UID, and frame numbers. The response is pixel data, and is encapsulated in a multipart MIME response.</para>
        <section xml:id="sect_6.5.4.1" label="6.5.4.1" status="4">
          <title>Request</title>
          <para>The specific Services resources to be used for the RetrieveFrames action shall be as follows:</para>
          <itemizedlist>
            <listitem>
              <para>Resource</para>
              <itemizedlist>
                <listitem>
                  <para>{SERVICE}/studies/{StudyInstanceUID}/series/{SeriesInstanceUID}/instances/{SOPInstanceUID}/frames/{FrameList}, where</para>
                  <itemizedlist>
                    <listitem>
                      <para>{SERVICE} is the base URL for the service. This may be a combination of protocol (either http or https), host, port, and application.</para>
                    </listitem>
                    <listitem>
                      <para>{StudyInstanceUID} is the study instance UID for a single study.</para>
                    </listitem>
                    <listitem>
                      <para>{SeriesInstanceUID} is the series instance UID for a single series.</para>
                    </listitem>
                    <listitem>
                      <para>{SOPInstanceUID} is the SOP Instance UID for a single SOP Instance.</para>
                    </listitem>
                    <listitem>
                      <para>{FrameList} is a comma or %2C separated list of one or more non duplicate frame numbers. These may be in any order (e.g., ../frames/1,2,4,3).</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Method</para>
              <itemizedlist>
                <listitem>
                  <para>GET</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Headers</para>
              <itemizedlist>
                <listitem>
                  <para>Accept</para>
                  <itemizedlist>
                    <listitem>
                      <para>multipart/related; type=application/octet-stream</para>
                      <para>Specifies that the response can be Little Endian uncompressed pixel data</para>
                    </listitem>
                    <listitem>
                      <para>multipart/related; type={MediaType}</para>
                      <para>Specifies that the response can be pixel data encoded using a {MediaType} and {TransferSyntaxUID} listed in <xref linkend="table_6.5-1" xrefstyle="select: label"/> (including parameters).</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
        </section>
        <section xml:id="sect_6.5.4.2" label="6.5.4.2" status="4">
          <title>Response</title>
          <para>The Server shall provide the document(s) indicated in the request. In order to parse the bulk data items it is necessary to also retrieve the XML metadata for the Study.</para>
          <para>The Server shall return the document(s) or an error code when the document(s) cannot be returned. If the server cannot encode the pixel data using any of the requested media types, then an error status shall be returned.</para>
          <para>All response formats has a content type of multipart/related with a message boundary separator.</para>
          <section xml:id="sect_6.5.4.2.1" label="6.5.4.2.1" status="5">
            <title>Pixel Data Response</title>
            <itemizedlist>
              <listitem>
                <para>Content-Type:</para>
                <itemizedlist>
                  <listitem>
                    <para>multipart/related; type=application/octet-stream; boundary={MessageBoundary}</para>
                  </listitem>
                  <listitem>
                    <para>multipart/related; type={MediaType}; boundary={MessageBoundary}</para>
                  </listitem>
                </itemizedlist>
              </listitem>
              <listitem>
                <para>The entire multipart response contains all requested Frames for the specified Instance.</para>
              </listitem>
              <listitem>
                <para>Each item in the response is one of:</para>
                <itemizedlist>
                  <listitem>
                    <para>an uncompressed frame encoded in Little Endian binary format with the following headers:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Content-Type: application/octet-stream</para>
                      </listitem>
                      <listitem>
                        <para>Content-Location: {BulkDataURL}[/frames/{FrameNumber}]</para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                  <listitem>
                    <para>a compressed frame encoded in a single-frame media type with the following headers:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Content-Type: {MediaType}</para>
                      </listitem>
                      <listitem>
                        <para>Content-Location: {BulkDataURL}/frames/{FrameNumber}</para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                  <listitem>
                    <para>a set of compressed frames encoded in a multi-frame media type with the following headers:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Content-Type: {MediaType}</para>
                      </listitem>
                      <listitem>
                        <para>Content-Location: {BulkDataURL}[/frames/{FrameList}]</para>
                        <itemizedlist>
                          <listitem>
                            <para>{FrameList} is a list of frames separated by %2C (comma). It may be omitted if the message part includes all frames for the specified bulk pixel data object.</para>
                          </listitem>
                        </itemizedlist>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                </itemizedlist>
              </listitem>
              <listitem>
                <para>The frames will be returned in the order specified by the Frame List.</para>
              </listitem>
            </itemizedlist>
          </section>
        </section>
      </section>
      <section xml:id="sect_6.5.5" label="6.5.5" status="3">
        <title>WADO-RS - RetrieveBulkdata</title>
        <para>This action retrieves the bulk data for a given bulk data URL. The response is a single bulk data item.</para>
        <section xml:id="sect_6.5.5.1" label="6.5.5.1" status="4">
          <title>Request</title>
          <para>The specific Services resource to be used for the RetrieveBulkdata action shall be as follows:</para>
          <itemizedlist>
            <listitem>
              <para>Resource</para>
              <itemizedlist>
                <listitem>
                  <para>{BulkDataURL}, where</para>
                  <itemizedlist>
                    <listitem>
                      <para>{BulkDataURL} is the URL of a bulk data element. This may be the URL attribute of a BulkData element from a DICOM <olink targetdoc="PS3.19" targetptr="PS3.19" xrefstyle="select: labelnumber"/> XML file received in response to a WADO-RS RetrieveMetadataRequest.</para>
                    </listitem>
                    <listitem>
                      <para>The server shall always return the same bulk data for a specified BulkData URL if the data is available.</para>
                    </listitem>
                    <listitem>
                      <para>If the resource specified by the BulkData URL is not available, the server shall return:</para>
                      <itemizedlist>
                        <listitem>
                          <para>404 - Not Found, if the server expects to be able to return the resource again in the future</para>
                        </listitem>
                        <listitem>
                          <para>410 - Gone, if the server does not expect the resource to be valid in the future</para>
                        </listitem>
                      </itemizedlist>
                    </listitem>
                    <listitem>
                      <para>The server determines the period of time a BulkData URL resource is available.</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Method</para>
              <itemizedlist>
                <listitem>
                  <para>GET</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Headers</para>
              <itemizedlist>
                <listitem>
                  <para>Accept</para>
                  <itemizedlist>
                    <listitem>
                      <para>multipart/related; type=application/octet-stream</para>
                      <para>Specifies that the response can be Little Endian uncompressed bulk data.</para>
                    </listitem>
                    <listitem>
                      <para>multipart/related; type={MediaType}</para>
                      <para>Specifies that the response can be pixel data encoded using a {MediaType} listed in <xref linkend="table_6.5-1" xrefstyle="select: label"/> (including parameters).</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
                <listitem>
                  <para>Range</para>
                  <itemizedlist>
                    <listitem>
                      <para>See RFC 2616 Section 14.35. If omitted in the request the server shall return the entire bulk data object.</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
        </section>
        <section xml:id="sect_6.5.5.2" label="6.5.5.2" status="4">
          <title>Response</title>
          <para>The Server shall provide the document(s) indicated in the request. In order to parse the bulk data items it is necessary to also retrieve the XML metadata for the Study.</para>
          <para>The Server shall return the document(s) or an error code when the document(s) cannot be returned. If the server cannot encode the pixel data using any of the requested media types, then an error status shall be returned.</para>
          <para>All response formats have a content type of multipart/related with a message boundary separator. The response format depends on the Accept header specified in the request.</para>
          <section xml:id="sect_6.5.5.2.1" label="6.5.5.2.1" status="5">
            <title>Bulk Data Response</title>
            <itemizedlist>
              <listitem>
                <para>Content-Type:</para>
                <itemizedlist>
                  <listitem>
                    <para>multipart/related; type=application/octet-stream; boundary={MessageBoundary}</para>
                  </listitem>
                </itemizedlist>
              </listitem>
              <listitem>
                <para>The single item in the response is one of:</para>
                <itemizedlist>
                  <listitem>
                    <para>an uncompressed bulk data element encoded in Little Endian binary format with the following headers:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Content-Type: application/octet-stream</para>
                      </listitem>
                      <listitem>
                        <para>Content-Location: {BulkDataURL}</para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                  <listitem>
                    <para>a compressed bulk data element from a SOP Instance encoded in a single-frame media type with the following headers:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Content-Type: {MediaType}</para>
                      </listitem>
                      <listitem>
                        <para>Content-Location: {BulkDataURL}</para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                </itemizedlist>
              </listitem>
              <listitem>
                <para>If the Range header is specified in the request, the server shall return only the specified bytes of the bulk data object. See RFC 2616 Section 14.35.</para>
              </listitem>
            </itemizedlist>
          </section>
        </section>
      </section>
      <section xml:id="sect_6.5.6" label="6.5.6" status="3">
        <title>WADO-RS - RetrieveMetadata</title>
        <para>This action retrieves the DICOM instances presented as the full study metadata with the bulk data removed. The response is XML encoded metadata for the DICOM attributes as defined in <olink targetdoc="PS3.19" targetptr="PS3.19" xrefstyle="select: labelnumber"/>.</para>
        <para>The full study metadata includes all attributes of the study; however, a RESTful Service is permitted to replace the Value Field of an attribute with a BulkDataURL for attributes with Value Representations (VR) of FL, FD, IS, LT, OB, OD, OF, OW, SL, SS, ST, UL, UN, US, and UT. The client can use the BulkDataURL with the RetrieveBulkData action to retrieve the original Value Field of that attribute.</para>
        <note>
          <orderedlist numeration="arabic">
            <listitem>
              <para>The server is not required to replace any attribute with a BulkDataURL; this is intended to allow the server to provide clients with metadata of a reasonably small size by leaving out large data Value Fields.</para>
            </listitem>
            <listitem>
              <para>Attributes with binary Value Fields are encoded as XML Base64 binary values.</para>
            </listitem>
            <listitem>
              <para>Some DICOM instances, such as SR documents, may be entirely described in the metadata.</para>
            </listitem>
          </orderedlist>
        </note>
        <section xml:id="sect_6.5.6.1" label="6.5.6.1" status="4">
          <title>Request</title>
          <para>The specific Services resource to be used for the RetrieveMetadata action shall be as follows:</para>
          <itemizedlist>
            <listitem>
              <para>Resource</para>
              <itemizedlist>
                <listitem>
                  <para>{SERVICE}/studies/{StudyInstanceUID}/metadata, where</para>
                  <itemizedlist>
                    <listitem>
                      <para>{SERVICE} is the base URL for the service. This may be a combination of protocol (either http or https), host, port, and application.</para>
                    </listitem>
                    <listitem>
                      <para>{StudyInstanceUID} is the study instance UID for a single study.</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Method</para>
              <itemizedlist>
                <listitem>
                  <para>GET</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Headers</para>
              <itemizedlist>
                <listitem>
                  <para>Accept</para>
                  <itemizedlist>
                    <listitem>
                      <para>multipart/related; type=application/dicom+xml</para>
                      <para>Specifies that the response should be WADO XML.</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
        </section>
        <section xml:id="sect_6.5.6.2" label="6.5.6.2" status="4">
          <title>Response</title>
          <para>The Server shall provide the document(s) indicated in the request. The Server shall return the document(s) or an error code when the document(s) could not be returned.</para>
          <para>The response format has a content type of application/dicom+xml as described in the Native DICOM Model defined in <olink targetdoc="PS3.19" targetptr="PS3.19" xrefstyle="select: labelnumber"/> and must include the URL attribute for each BulkData element.</para>
          <section xml:id="sect_6.5.6.2.1" label="6.5.6.2.1" status="5">
            <title>Metadata Response</title>
            <itemizedlist>
              <listitem>
                <para>Content-Type:</para>
                <itemizedlist>
                  <listitem>
                    <para>multipart/related; type=application/dicom+xml</para>
                  </listitem>
                </itemizedlist>
              </listitem>
              <listitem>
                <para>The entire multipart response contains all XML metadata for the specified Study.</para>
              </listitem>
              <listitem>
                <para>Each item in the response is the XML encoded metadata for an Instance with the following http headers:</para>
                <itemizedlist>
                  <listitem>
                    <para>Content-Type: application/dicom+xml; transfer-syntax={TransferSyntaxUID}</para>
                    <para>Where {TransferSyntaxUID} is the UID of the DICOM Transfer Syntax used to encode the inline binary data in the XML metadata.</para>
                  </listitem>
                </itemizedlist>
              </listitem>
            </itemizedlist>
            <note>
              <para>The metadata is consistent with the characteristics of the bulk data on the server. If bulk data is requested using specified Transfer Syntaxes or media types, it is possible that the bulk data retrieved may be inconsistent with the metadata. For example, for a Study whose DICOM Tag (0028,2110) "LossyImageCompression" is set to "00", indicating no lossy compression, calling RetrieveStudy and requesting a lossy compression media type will provide pixel data that is inconsistent with the metadata. It is the responsibility of the client to deal with these inconsistencies appropriately.</para>
            </note>
          </section>
        </section>
      </section>
      <section xml:id="sect_6.5.7" label="6.5.7" status="3">
        <title>Error Codes</title>
        <para>The following error codes are defined and shall be used to report any of the associated error and warning situations. Other error codes may be present for other error and warning situations.</para>
        <table frame="box" rules="all" xml:id="table_6.5-2" label="6.5-2">
          <caption>Error Codes</caption>
          <thead>
            <tr valign="top">
              <th align="center" colspan="1" rowspan="1">
                <para>
                  <emphasis role="bold">Client Error Code</emphasis>
                </para>
              </th>
              <th align="center" colspan="1" rowspan="1">
                <para>
                  <emphasis role="bold">Client Error Name</emphasis>
                </para>
              </th>
              <th align="center" colspan="1" rowspan="1">
                <para>
                  <emphasis role="bold">Error Situation</emphasis>
                </para>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>206</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Partial Content</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Accept type, Transfer Syntax or decompression method supported for some but not all requested content.</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>400</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Bad Request</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Malformed resource</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>404</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Not Found</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Specified resource does not exist</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>406</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Not Acceptable</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Accept type, Transfer Syntax or decompression method not supported</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>410</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Gone</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Specified resource was deleted</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>503</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Busy</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Service is unavailable</para>
              </td>
            </tr>
          </tbody>
        </table>
      </section>
    </section>
    <section xml:id="sect_6.6" label="6.6" status="2">
      <title>STOW-RS Request/Response</title>
      <para>The STOW-RS Service defines one action type. An implementation shall support the following action type:</para>
      <orderedlist numeration="arabic">
        <listitem>
          <para>Store Instances</para>
          <para>This action creates new resources for the given SOP Instances on the Server or appends to existing resources on the Server.</para>
        </listitem>
      </orderedlist>
      <para>All request messages are HTTP/1.1 multipart messages. The organization of SOP Instances into message parts depends on whether the SOP Instances are structured as <olink targetdoc="PS3.10" targetptr="PS3.10" xrefstyle="select: labelnumber"/> binary instances, or metadata and bulk data.</para>
      <para><olink targetdoc="PS3.10" targetptr="PS3.10" xrefstyle="select: labelnumber"/> binary instances shall be encoded with one message part per DICOM Instance.</para>
      <para>Metadata and bulk data requests will be encoded in the following manner:(see <xref linkend="figure_6.5-1" xrefstyle="select: label"/> WADO-RS Mapping Between IOD and HTTP message body parts):</para>
      <itemizedlist>
        <listitem>
          <para>All XML request messages shall be encoded as described in the Native DICOM Model defined in <olink targetdoc="PS3.19" targetptr="PS3.19" xrefstyle="select: labelnumber"/> with one message part per XML object.</para>
        </listitem>
        <listitem>
          <para>Uncompressed bulk and pixel data shall be encoded in a Little Endian format using the application/octet-stream media type with one message part per bulk data item.</para>
        </listitem>
        <listitem>
          <para>Compressed pixel data shall be encoded in one of two ways:</para>
          <itemizedlist>
            <listitem>
              <para>Single-frame pixel data encoded using a single-frame media type (one message part)</para>
            </listitem>
            <listitem>
              <para>Multi-frame or video pixel data encoded using a multi-frame media type (multiple frames in one message part)</para>
            </listitem>
          </itemizedlist>
        </listitem>
      </itemizedlist>
      <para>Compressed pixel data shall be encoded using the Media Types as described in <xref linkend="table_6.5-1" xrefstyle="select: label"/> WADO-RS Media Type Mapping to Transfer Syntax UID. Media Types corresponding to several DICOM Transfer Syntax UIDs may require a transfer-syntax parameter to disambiguate the request.</para>
      <para>HTTP Request field Content-Type is used in the header lines by the client in an HTTP/1.1 transaction to indicate the type of data being sent to the Service. All lines are RFC822 or RFC2616 format headers. All HTTP header fields whose use is not defined by STOW-RS shall have the meaning defined by the HTTP standard.</para>
      <para>The Service is required to support uncompressed bulk and pixel data (multipart/related; type= application/octet-stream).</para>
      <section xml:id="sect_6.6.1" label="6.6.1" status="3">
        <title>STOW-RS - Store Instances</title>
        <para>This action stores one or more DICOM instances associated with one or more study instance unique identifiers (SUID). The request message can be DICOM or metadata and bulk data depending on the"Content-Type", and is encapsulated in a multipart request body.</para>
        <section xml:id="sect_6.6.1.1" label="6.6.1.1" status="4">
          <title>Request</title>
          <para>The specific Service resource to be used for the Store Instances action shall be as follows:</para>
          <itemizedlist>
            <listitem>
              <para>Resource</para>
              <itemizedlist>
                <listitem>
                  <para>{SERVICE}/studies[/{StudyInstanceUID}], where</para>
                  <itemizedlist>
                    <listitem>
                      <para>{SERVICE} is the base URL for the service. This may be a combination of scheme (either HTTP or HTTPS), host, port, and application.</para>
                    </listitem>
                    <listitem>
                      <para>{StudyInstanceUID} (optional) is the study instance UID for a single study. If not specified, instances can be from multiple studies. If specified, all instances shall be from that study; instances not matching the StudyInstanceUID shall be rejected.</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Method</para>
              <itemizedlist>
                <listitem>
                  <para>POST</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Headers</para>
              <itemizedlist>
                <listitem>
                  <para>Content-Type - The representation scheme being posted to the RESTful service. The types allowed for this request header are as follows:</para>
                  <itemizedlist>
                    <listitem>
                      <para>multipart/related; type=application/dicom; boundary={messageBoundary}</para>
                      <para>Specifies that the post is <olink targetdoc="PS3.10" targetptr="PS3.10" xrefstyle="select: labelnumber"/> binary instances.</para>
                    </listitem>
                    <listitem>
                      <para>multipart/related; type=application/dicom+xml; boundary={messageBoundary}</para>
                      <para>Specifies that the post is <olink targetdoc="PS3.19" targetptr="PS3.19" xrefstyle="select: labelnumber"/> XML metadata and bulk data.</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
          <note>
            <para>It is not necessary that the study referenced by the StudyInstanceUID in the resource (and in the provided instances) exists on the server, however it is necessary that it be a valid UID. The client may have obtained an appropriate UID from elsewhere or generated it as described in <olink targetdoc="PS3.5" targetptr="chapter_9" xrefstyle="select: docname labelnumber"/> and <olink targetdoc="PS3.5" targetptr="chapter_B" xrefstyle="select: docname labelnumber"/>.</para>
          </note>
          <section xml:id="sect_6.6.1.1.1" label="6.6.1.1.1" status="5">
            <title>DICOM Request Message Body</title>
            <para>The DICOM Request Message has a multipart body.</para>
            <itemizedlist>
              <listitem>
                <para>Content-Type:</para>
                <itemizedlist>
                  <listitem>
                    <para>multipart/related; type=application/dicom; boundary={MessageBoundary}</para>
                  </listitem>
                </itemizedlist>
              </listitem>
              <listitem>
                <para>The multipart request body contains every instance to be stored. Each instance is in a separate part of the multipart body.</para>
              </listitem>
              <listitem>
                <para>Each part in the multipart body represents a DICOM SOP Instance with the following HTTP headers:</para>
                <itemizedlist>
                  <listitem>
                    <para>Content-Type: application/dicom</para>
                  </listitem>
                </itemizedlist>
              </listitem>
            </itemizedlist>
          </section>
          <section xml:id="sect_6.6.1.1.2" label="6.6.1.1.2" status="5">
            <title>Metadata and Bulk Data Request Message Body</title>
            <para>The Metadata and Bulk Data Request Message has a multipart body.</para>
            <itemizedlist>
              <listitem>
                <para>Content-Type:</para>
                <itemizedlist>
                  <listitem>
                    <para>multipart/related; type=application/dicom+xml; boundary={MessageBoundary}</para>
                  </listitem>
                </itemizedlist>
              </listitem>
              <listitem>
                <para>The multipart request body contains all the metadata and bulk data to be stored. If the number of bulk data parts does not correspond to the number of unique BulkDataURIs in the metadata then the entire message is invalid and will generate an error status line.</para>
              </listitem>
              <listitem>
                <para>Each body part is either DICOM <olink targetdoc="PS3.19" targetptr="PS3.19" xrefstyle="select: labelnumber"/> XML metadata or a bulk data item from a SOP Instance sent as part of the Store operation. The first part of the multipart message must be XML metadata.</para>
              </listitem>
              <listitem>
                <para>The first part in the multipart request will contain the following HTTP headers:</para>
                <itemizedlist>
                  <listitem>
                    <para>Content-Type: application/dicom+xml; transfer-syntax={TransferSyntaxUID}</para>
                  </listitem>
                </itemizedlist>
              </listitem>
              <listitem>
                <para>Subsequent items will contain the following HTTP headers (order is not guaranteed):</para>
                <itemizedlist>
                  <listitem>
                    <para>additional metadata with the following headers:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Content-Type: application/dicom+xml; transfer-syntax={TransferSyntaxUID}</para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                  <listitem>
                    <para>an uncompressed bulk data element encoded in Little Endian binary format with the following headers:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Content-Type: application/octet-stream</para>
                      </listitem>
                      <listitem>
                        <para>Content-Location: {BulkDataURI}</para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                  <listitem>
                    <para>a compressed pixel data object from a SOP Instance in the Study with the following headers:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Content-Type: {MediaType}</para>
                      </listitem>
                      <listitem>
                        <para>Content-Location: {BulkDataURI}</para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                </itemizedlist>
              </listitem>
              <listitem>
                <para>Metadata and its associated bulk data shall always be sent in the same POST request.</para>
              </listitem>
            </itemizedlist>
            <note>
              <para>It is not intended that metadata and bulk data be stored separately in multiple POST requests since the service always requires the metadata for context.</para>
            </note>
          </section>
        </section>
        <section xml:id="sect_6.6.1.2" label="6.6.1.2" status="4">
          <title>Action</title>
          <para>The Service may coerce or replace values of attributes such as Patient Name, ID, Accession Number, for example, during import of media from an external institution, reconciliation against a master patient index, or reconciliation against an imaging procedure order. The Service may correct, or replace incorrect values, such as Patient Name or ID, for example, when incorrect worklist item was chosen or operator input error occurs.</para>
          <para>If any element is coerced or corrected, the Original Attribute Sequence (0400,0561) shall be included in the DICOM Object that is stored and may be included in the PS3.18 XML Store Instances Response Module in the response.</para>
          <note>
            <para>For more information on populating the Original Attribute Sequence, see <olink targetdoc="PS3.3" targetptr="sect_C.12.1" xrefstyle="select: docname label quotedtitle"/>.</para>
          </note>
        </section>
        <section xml:id="sect_6.6.1.3" label="6.6.1.3" status="4">
          <title>Response</title>
          <para>The RESTful Service shall return an HTTP status line, including a status code and associated textual phrase for the entire set of stored SOP Instances, followed by an XML message body containing a <olink targetdoc="PS3.19" targetptr="PS3.19" xrefstyle="select: labelnumber"/> XML representation of the Store Instances Response Module as defined in <xref linkend="table_6.6.1-2" xrefstyle="select: label"/>.</para>
          <section xml:id="sect_6.6.1.3.1" label="6.6.1.3.1" status="5">
            <title>Response Status Line</title>
            <para>If the status for all instances included in the POST request is Success, the RESTful Service shall return an "HTTP 200 - Success" response code.</para>
            <para>If the status for all instances included in the POST request is Failure, the RESTful Service shall return an appropriate failure status line with a response code from <xref linkend="table_6.6.1-1" xrefstyle="select: label"/>. If there are instance specific errors, the response code shall be a 409 and will be followed by the PS3.18 XML Store Instances Response Module as the message body, which contains additional information regarding instance errors.</para>
            <para>In all other conditions, the RESTful Service shall return an "HTTP 202 - Accepted" response code. Additional information regarding the instance warnings or failures will be found in the PS3.18 XML Store Instances Response Module in the response message body.</para>
            <table rules="all" frame="box" xml:id="table_6.6.1-1" label="6.6.1-1">
              <caption>HTTP/1.1 Standard Response Code</caption>
              <thead>
                <tr valign="top">
                  <th align="center" colspan="1" rowspan="1">
                    <para>Service Status</para>
                  </th>
                  <th align="center" colspan="1" rowspan="1">
                    <para>HTTP/1.1 Status Codes</para>
                  </th>
                  <th align="center" colspan="1" rowspan="1">
                    <para>STOW-RS Description</para>
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr valign="top">
                  <td align="left" colspan="1" rowspan="1">
                    <para>Failure</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>400 - Bad Request</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>This indicates that the STOW-RS Service was unable to store any instances due to bad syntax.</para>
                  </td>
                </tr>
                <tr valign="top">
                  <td align="left" colspan="1" rowspan="1"/>
                  <td align="left" colspan="1" rowspan="1">
                    <para>401 - Unauthorized</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>This indicates that the STOW-RS Service refused to create or append any instances because the client is not authorized.</para>
                  </td>
                </tr>
                <tr valign="top">
                  <td align="left" colspan="1" rowspan="1"/>
                  <td align="left" colspan="1" rowspan="1">
                    <para>403 - Forbidden</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>This indicates that the STOW-RS Service understood the request, but is refusing to fulfill it (e.g., an authorized user with insufficient privileges).</para>
                  </td>
                </tr>
                <tr valign="top">
                  <td align="left" colspan="1" rowspan="1"/>
                  <td align="left" colspan="1" rowspan="1">
                    <para>409 - Conflict</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>This indicates that the STOW-RS Service request was formed correctly but the service was unable to store any instances due to a conflict in the request (e.g., unsupported SOP Class or StudyInstanceUID mismatch).</para>
                    <para>This may also be used to indicate that a STOW-RS Service was unable to store any instances for a mixture of reasons.</para>
                    <para>Additional information regarding the instance errors can be found in the XML response message body.</para>
                  </td>
                </tr>
                <tr valign="top">
                  <td align="left" colspan="1" rowspan="1"/>
                  <td align="left" colspan="1" rowspan="1">
                    <para>503 - Busy</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>This indicates that the STOW-RS Service was unable to store any instances because it was out of resources.</para>
                  </td>
                </tr>
                <tr valign="top">
                  <td align="left" colspan="1" rowspan="1">
                    <para>Warning</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>202 - Accepted</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>This indicates that the STOW-RS Service stored some of the instances but warnings or failures exist for others.</para>
                    <para>Additional information regarding this error can be found in the XML response message body.</para>
                  </td>
                </tr>
                <tr valign="top">
                  <td align="left" colspan="1" rowspan="1">
                    <para>Success</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>200 - OK</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>This indicates that the STOW-RS Service successfully stored all the instances.</para>
                  </td>
                </tr>
              </tbody>
            </table>
            <note>
              <para>HTTP Status Codes for Failures and Warnings are returned in HTTP response headers. It is recommended that the text returned in the HTTP Response Warning contain a DICOM Status Code and descriptive reason as defined in <xref linkend="sect_6.6.1.3.2.1" xrefstyle="select: label"/>. For example,</para>
              <para>
                <computeroutput>Warning: "A700: Out of memory"</computeroutput>
              </para>
            </note>
          </section>
          <section xml:id="sect_6.6.1.3.2" label="6.6.1.3.2" status="5">
            <title>Response Message Body</title>
            <para>The XML message body shall provide appropriate status codes for individual SOP Instances indicating success, warning, or failure as defined below.</para>
            <para>The XML message body may also include details about the processing of attributes by the service.</para>
            <para><xref linkend="table_6.6.1-2" xrefstyle="select: label"/> defines the Attributes for referencing SOP Instances that are contained in a PS3.18 XML Store Instances Response Module in the response message body.</para>
            <table rules="all" frame="box" xml:id="table_6.6.1-2" label="6.6.1-2">
              <caption>Store Instances Response Module Attributes</caption>
              <thead>
                <tr valign="top">
                  <th align="center" colspan="1" rowspan="1">
                    <para>
                      <emphasis role="bold">Attribute Name</emphasis>
                    </para>
                  </th>
                  <th align="center" colspan="1" rowspan="1">
                    <para>
                      <emphasis role="bold">Tag</emphasis>
                    </para>
                  </th>
                  <th align="center" colspan="1" rowspan="1">
                    <para>
                      <emphasis role="bold">Type</emphasis>
                    </para>
                  </th>
                  <th align="center" colspan="1" rowspan="1">
                    <para>
                      <emphasis role="bold">Attribute Description</emphasis>
                    </para>
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr valign="top">
                  <td align="left" colspan="1" rowspan="1">
                    <para>Retrieve URL</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>(0008,1190)</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>2</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>The URL where the Study is available for retrieval via a WADO-RS Retrieve Study service.</para>
                  </td>
                </tr>
                <tr valign="top">
                  <td align="left" colspan="1" rowspan="1">
                    <para>Failed SOP Sequence</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>(0008,1198)</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>1C</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>A sequence of Items where each Item references a single SOP Instance for which storage could not be provided.</para>
                    <para>Required if one or more SOP Instances failed to store.</para>
                  </td>
                </tr>
                <tr valign="top">
                  <td align="left" colspan="4" rowspan="1">
                    <para>
                      <emphasis role="italic">&gt;<olink targetdoc="PS3.3" targetptr="table_10-11" xrefstyle="select: docname label quotedtitle"/></emphasis>
                    </para>
                  </td>
                </tr>
                <tr valign="top">
                  <td align="left" colspan="1" rowspan="1">
                    <para>&gt;Failure Reason</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>(0008,1197)</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>1</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>The reason that storage could not be provided for this SOP Instance.</para>
                    <para>See <xref linkend="sect_6.6.1.3.2.1.2" xrefstyle="select: label"/>.</para>
                  </td>
                </tr>
                <tr valign="top">
                  <td align="left" colspan="1" rowspan="1">
                    <para>Referenced SOP Sequence</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>(0008,1199)</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>1C</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>A sequence of Items where each Item references a single SOP Instance that was successfully stored.</para>
                    <para>Required if one or more SOP Instances were successfully stored.</para>
                  </td>
                </tr>
                <tr valign="top">
                  <td align="left" colspan="4" rowspan="1">
                    <para>
                      <emphasis role="italic">&gt;<olink targetdoc="PS3.3" targetptr="table_10-11" xrefstyle="select: docname label quotedtitle"/></emphasis>
                    </para>
                  </td>
                </tr>
                <tr valign="top">
                  <td align="left" colspan="1" rowspan="1">
                    <para>&gt;Retrieve URL</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>(0008,1190)</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>2</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>The URL where the SOP Instance is available for retrieval via a WADO-URI or WADO-RS service.</para>
                    <para>If the study Retrieve URI is specified above, this URI can be constructed if the client knows the series and instance UIDs.</para>
                  </td>
                </tr>
                <tr valign="top">
                  <td align="left" colspan="1" rowspan="1">
                    <para>&gt;Warning Reason</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>(0008,1196)</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>1C</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>The reason that this SOP Instance was accepted with warnings.</para>
                    <para>Required if there was a warning for this SOP Instance.</para>
                    <para>See <xref linkend="sect_6.6.1.3.2.1.1" xrefstyle="select: label"/>.</para>
                  </td>
                </tr>
                <tr valign="top">
                  <td align="left" colspan="1" rowspan="1">
                    <para>&gt;Original Attributes Sequence</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>(0400,0561)</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>3</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>Sequence of Items containing all attributes that were removed or replaced by other values.</para>
                    <para>One or more Items are permitted in this sequence.</para>
                  </td>
                </tr>
                <tr valign="top">
                  <td align="left" colspan="1" rowspan="1">
                    <para>&gt;&gt;Attribute Modification DateTime</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>(0400,0562)</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>1</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>Date and time the attributes were removed and/or replaced.</para>
                  </td>
                </tr>
                <tr valign="top">
                  <td align="left" colspan="1" rowspan="1">
                    <para>&gt;&gt;Modifying System</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>(0400,0563)</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>1</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>Identification of the system that removed and/or replaced the attributes.</para>
                  </td>
                </tr>
                <tr valign="top">
                  <td align="left" colspan="1" rowspan="1">
                    <para>&gt;&gt;Reason for the Attribute Modification</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>(0400,0565)</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>1</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>Reason for the attribute modification. Defined terms are:</para>
                    <para>COERCE = Replace values of attributes such as Patient Name, ID, Accession Number, for example, during import of media from an external institution, or reconciliation against a master patient index.</para>
                    <para>CORRECT = Replace incorrect values, such as Patient Name or ID, for example, when incorrect worklist item was chosen or operator input error.</para>
                  </td>
                </tr>
                <tr valign="top">
                  <td align="left" colspan="1" rowspan="1">
                    <para>&gt;&gt;Modified Attributes Sequence</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>(0400,0550)</para>
                  </td>
                  <td align="center" colspan="1" rowspan="1">
                    <para>1</para>
                  </td>
                  <td align="left" colspan="1" rowspan="1">
                    <para>Sequence that contains all the Attributes, with their previous values, that were modified or removed from the main data set.</para>
                    <para>Only a single Item shall be included in this sequence.</para>
                  </td>
                </tr>
                <tr valign="top">
                  <td align="left" colspan="4" rowspan="1">
                    <para>
                      <emphasis role="italic">&gt;&gt;Any Attribute from the main data set that was modified or removed; may include Sequence Attributes and their Items.</emphasis>
                    </para>
                  </td>
                </tr>
              </tbody>
            </table>
            <section xml:id="sect_6.6.1.3.2.1" label="6.6.1.3.2.1" status="6">
              <title>Store Instances Response Attribute Description</title>
              <section xml:id="sect_6.6.1.3.2.1.1" label="6.6.1.3.2.1.1" status="7">
                <title> Warning Reason</title>
                <para>For the following semantics the associated value shall be used for the Warning Reason (0008,1196):</para>
                <variablelist>
                  <varlistentry>
                    <term>B000 - Coercion of Data Elements</term>
                    <listitem>
                      <para>The STOW-RS Service modified one or more data elements during storage of the instance. See <xref linkend="sect_6.6.1.3" xrefstyle="select: label"/>.</para>
                    </listitem>
                  </varlistentry>
                  <varlistentry>
                    <term>B006 - Elements Discarded</term>
                    <listitem>
                      <para>The STOW-RS Service discarded some data elements during storage of the instance. See <xref linkend="sect_6.6.1.3" xrefstyle="select: label"/>.</para>
                    </listitem>
                  </varlistentry>
                  <varlistentry>
                    <term>B007 - Data Set does not match SOP Class</term>
                    <listitem>
                      <para>The STOW-RS Service observed that the Data Set did not match the constraints of the SOP Class during storage of the instance.</para>
                    </listitem>
                  </varlistentry>
                </variablelist>
                <para>Additional codes may be used for the Warning Reason (0008,1196) to address the semantics of other issues.</para>
                <para>In the event that multiple codes may apply, the single most appropriate code shall be used.</para>
              </section>
              <section xml:id="sect_6.6.1.3.2.1.2" label="6.6.1.3.2.1.2" status="7">
                <title>Failure Reason</title>
                <para>For the following semantics the associated value shall be used for the Failure Reason (0008,1197). Implementation specific warning and error codes shall be defined in the conformance statement:</para>
                <variablelist>
                  <varlistentry>
                    <term>A7xx - Refused out of Resources</term>
                    <listitem>
                      <para>The STOW-RS Service did not store the instance because it was out of resources.</para>
                    </listitem>
                  </varlistentry>
                  <varlistentry>
                    <term>A9xx - Error: Data Set does not match SOP Class</term>
                    <listitem>
                      <para>The STOW-RS Service did not store the instance because the instance does not conform to its specified SOP Class.</para>
                    </listitem>
                  </varlistentry>
                  <varlistentry>
                    <term>Cxxx - Error: Cannot understand</term>
                    <listitem>
                      <para>The STOW-RS Service did not store the instance because it cannot understand certain Data Elements.</para>
                    </listitem>
                  </varlistentry>
                  <varlistentry>
                    <term>C122 - Referenced Transfer Syntax not supported</term>
                    <listitem>
                      <para>The STOW-RS Service did not store the instance because it does not support the requested Transfer Syntax for the instance.</para>
                    </listitem>
                  </varlistentry>
                  <varlistentry>
                    <term>0110 - Processing failure</term>
                    <listitem>
                      <para>The STOW-RS Service did not store the instance because of a general failure in processing the operation.</para>
                    </listitem>
                  </varlistentry>
                  <varlistentry>
                    <term>0122 - Referenced SOP Class not supported</term>
                    <listitem>
                      <para>The STOW-RS Service did not store the instance because it does not support the requested SOP Class.</para>
                    </listitem>
                  </varlistentry>
                </variablelist>
                <para>Additional codes may be used for the Failure Reason (0008,1197) to address the semantics of other issues.</para>
                <para>In the event that multiple codes may apply, the single most appropriate code shall be used.</para>
              </section>
            </section>
            <section xml:id="sect_6.6.1.3.2.2" label="6.6.1.3.2.2" status="6">
              <title>Response Message Body Example</title>
              <para>The following is an example of a PS3.18 XML Store Instances Response Module in the response message body containing 2 failed SOP Instances, 1 successful SOP Instance, and 1 accepted SOP Instance with a warning:</para>
              <programlisting><![CDATA[
<?xml version="1.0" encoding="utf-8"?>
<NativeDicomModel xmlns="http://dicom.nema.org/PS3.19/models/NativeDICOM"
xsi:schemaLocation="http://dicom.nema.org/PS3.19/models/NativeDICOM"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <DicomAttribute tag="00081198" vr="SQ" keyword="FailedSOPSequence">
    <Item number="1">
      <DicomAttribute tag="00081150" vr="UI" keyword="ReferencedSOPClassUID">
        <Value number="1">1.2.840.10008.3.1.2.3.1</Value>
      </DicomAttribute>
      <DicomAttribute tag="00081155" vr="UI"
      keyword="ReferencedSOPInstanceUID">
        <Value number="1">
        2.16.124.113543.6003.1011758472.49886.19426.2085542308</Value>
      </DicomAttribute>
      <DicomAttribute tag="00081197" vr="US" keyword="FailureReason">
        <Value number="1">290</Value>
      </DicomAttribute>
    </Item>
    <Item number="2">
      <DicomAttribute tag="00081150" vr="UI" keyword="ReferencedSOPClassUID">
        <Value number="1">1.2.840.10008.3.1.2.3.1</Value>
      </DicomAttribute>
      <DicomAttribute tag="00081155" vr="UI"
      keyword="ReferencedSOPInstanceUID">
        <Value number="1">
        2.16.124.113543.6003.1011758472.49886.19426.2085542309</Value>
      </DicomAttribute>
      <DicomAttribute tag="00081197" vr="US" keyword="FailureReason">
        <Value number="1">290</Value>
      </DicomAttribute>
    </Item>
  </DicomAttribute>
  <DicomAttribute tag="00081199" vr="SQ" keyword="ReferencedSOPSequence">
    <Item number="1">
      <DicomAttribute tag="00081150" vr="UI" keyword="ReferencedSOPClassUID">
        <Value number="1">1.2.840.10008.5.1.4.1.1.2</Value>
      </DicomAttribute>
      <DicomAttribute tag="00081155" vr="UI"
      keyword="ReferencedSOPInstanceUID">
        <Value number="1">
        2.16.124.113543.6003.189642796.63084.16748.2599092903</Value>
      </DicomAttribute>
      <DicomAttribute tag="00081190" vr="UT" keyword="RetrieveURL">
        <Value number="1">
        https://wadors.hospital.com/studies/2.16.124.113543.6003.1154777499.30246.19789.3503430045/
        series/2.16.124.113543.6003.2588828330.45298.17418.2723805630/
        instances/2.16.124.113543.6003.189642796.63084.16748.2599092903</Value>
      </DicomAttribute>
    </Item>
    <Item number="2">
      <DicomAttribute tag="00081150" vr="UI" keyword="ReferencedSOPClassUID">
        <Value number="1">1.2.840.10008.5.1.4.1.1.2</Value>
      </DicomAttribute>
      <DicomAttribute tag="00081155" vr="UI"
      keyword="ReferencedSOPInstanceUID">
        <Value number="1">
        2.16.124.113543.6003.189642796.63084.16748.2599092905</Value>
      </DicomAttribute>
      <DicomAttribute tag="00081196" vr="US" keyword="WarningReason">
        <Value number="1">45056</Value>
      </DicomAttribute>
      <DicomAttribute tag="00081190" vr="UT" keyword="RetrieveURL">
        <Value number="1">
        https://wadors.hospital.com/studies/2.16.124.113543.6003.1154777499.30246.19789.3503430045/
        series/2.16.124.113543.6003.2588828330.45298.17418.2723805630/
        instances/2.16.124.113543.6003.189642796.63084.16748.2599092905</Value>
      </DicomAttribute>
    </Item>
  </DicomAttribute>
  <DicomAttribute tag="00081190" vr="UT" keyword="RetrieveURL">
    <Value number="1">
    https://wadors.hospital.com/studies/2.16.124.113543.6003.1154777499.30246.19789.3503430045</Value>
  </DicomAttribute>
</NativeDicomModel>
]]></programlisting>
            </section>
          </section>
        </section>
      </section>
    </section>
    <section xml:id="sect_6.7" label="6.7" status="2">
      <title>QIDO-RS Request/Response</title>
      <para>DICOM QIDO-RS defines several action types. An implementation shall support the following action types:</para>
      <orderedlist numeration="loweralpha">
        <listitem>
          <para>SearchForStudies</para>
          <para>This action searches for DICOM Studies that match specified search parameters and returns a list of matching studies and the requested attributes for each study.</para>
        </listitem>
        <listitem>
          <para>SearchForSeries</para>
          <para>This action searches for DICOM Series that match specified search parameters and returns a list of matching series and the requested attributes for each series.</para>
        </listitem>
        <listitem>
          <para>SearchForInstances</para>
          <para>This action searches for DICOM Instances that match specified search parameters and returns a list of matching instances and the requested attributes for each instance.</para>
        </listitem>
      </orderedlist>
      <section xml:id="sect_6.7.1" label="6.7.1" status="3">
        <title>QIDO-RS - Search</title>
        <section xml:id="sect_6.7.1.1" label="6.7.1.1" status="4">
          <title>Request</title>
          <para>The specific resources to be used for the search actions shall be as follows:</para>
          <itemizedlist>
            <listitem>
              <para>Resource</para>
              <itemizedlist>
                <listitem>
                  <para>SearchForStudies</para>
                  <itemizedlist>
                    <listitem>
                      <para>{SERVICE}/studies[?query]</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
                <listitem>
                  <para>SearchForSeries</para>
                  <itemizedlist>
                    <listitem>
                      <para>{SERVICE}/studies/{StudyInstanceUID}/series[?query]</para>
                    </listitem>
                    <listitem>
                      <para>{SERVICE}/series[?query]</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
                <listitem>
                  <para>SearchForInstances</para>
                  <itemizedlist>
                    <listitem>
                      <para>{SERVICE}/studies/{StudyInstanceUID}/series/{SeriesInstanceUID}/instances[?query]</para>
                    </listitem>
                    <listitem>
                      <para>{SERVICE}/studies/{StudyInstanceUID}/instances[?query]</para>
                    </listitem>
                    <listitem>
                      <para>{SERVICE}/instances[?query]</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
              <para>where</para>
              <itemizedlist>
                <listitem>
                  <para>{SERVICE} is the base URL for the QIDO RESTful service. This may be a combination of scheme (http or https), host, port, and application.</para>
                </listitem>
                <listitem>
                  <para>{StudyInstanceUID} is the unique Study Instance UID for a single study.</para>
                </listitem>
                <listitem>
                  <para>{SeriesInstanceUID} is the unique Series Instance UID for a single series.</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Method</para>
              <itemizedlist>
                <listitem>
                  <para>GET</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Headers</para>
              <itemizedlist>
                <listitem>
                  <para>Accept - The Media Type of the query results. The types allowed for this request header are:</para>
                  <itemizedlist>
                    <listitem>
                      <para>multipart/related; type=application/dicom+xml (default)</para>
                      <para>Specifies that the results should be DICOM <olink targetdoc="PS3.19" targetptr="PS3.19" xrefstyle="select: labelnumber"/> XML (one part per result)</para>
                    </listitem>
                    <listitem>
                      <para>application/json</para>
                      <para>Specifies that the results should be DICOM JSON</para>
                    </listitem>
                  </itemizedlist>
                  <para>A QIDO-RS provider shall support both Accept header values</para>
                </listitem>
                <listitem>
                  <para>Cache-control: no-cache (recommended)</para>
                  <para>If included, specifies that search results returned should be current and not cached.</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Query key=value pairs</para>
              <itemizedlist>
                <listitem>
                  <para>{attributeID}={value}</para>
                  <para>0-n / {attributeID}={value} pairs allowed</para>
                </listitem>
                <listitem>
                  <para>includefield={attributeID} | all</para>
                  <para>0-n includefield / {attributeID} pairs allowed, where "all" indicates that all available attributes should be included for each response.</para>
                </listitem>
              </itemizedlist>
              <para>Each {attributeID} must refer to one of:</para>
              <itemizedlist>
                <listitem>
                  <para>Patient IE attributes</para>
                </listitem>
                <listitem>
                  <para>Study IE attributes</para>
                </listitem>
                <listitem>
                  <para>Series IE attributes (SearchForSeries or SearchForInstances requests only)</para>
                </listitem>
                <listitem>
                  <para>Composite Instance IE attributes (SearchForInstances requests only)</para>
                </listitem>
                <listitem>
                  <para>Additional Query / Retrieve Attributes (<olink targetdoc="PS3.4" targetptr="sect_C.3.4" xrefstyle="select: docname label"/>)</para>
                </listitem>
                <listitem>
                  <para>Timezone Offset From UTC (0008,0201)</para>
                </listitem>
              </itemizedlist>
              <para>Each {attributeID} query value must be unique unless the associated DICOM Attribute allows UID List matching (see <olink targetdoc="PS3.4" targetptr="sect_C.2.2.2.2" xrefstyle="select: docname label"/>), in which case each {value} will be interpreted to be an element of the UID List.</para>
              <para>The acceptable values for {value} are determined by the types of matching allowed by C-FIND for its associated {attributeID} (see <olink targetdoc="PS3.4" targetptr="sect_C.2.2.2" xrefstyle="select: docname label"/>). All characters in {value} that are disallowed for URLs must be URL encoded. See IETF RFC 1738 for details.</para>
              <para>If an {attributeID} is passed as the value of an "includefield" query key this is equivalent to C-FIND Universal matching for the specified attribute (see <olink targetdoc="PS3.4" targetptr="sect_C.2.2.2.3" xrefstyle="select: docname label"/>).</para>
              <itemizedlist>
                <listitem>
                  <para>fuzzymatching=true | false</para>
                </listitem>
                <listitem>
                  <para>limit={maximumResults}</para>
                </listitem>
                <listitem>
                  <para>offset={skippedResults}</para>
                </listitem>
              </itemizedlist>
              <para>{attributeID} can be one of the following:</para>
              <itemizedlist>
                <listitem>
                  <para>{dicomTag}</para>
                </listitem>
                <listitem>
                  <para>{dicomKeyword}</para>
                </listitem>
                <listitem>
                  <para>{dicomTag}.{attributeID}, where {attributeID} is an element of the sequence specified by {dicomTag}</para>
                </listitem>
                <listitem>
                  <para>{dicomKeyword}.{attributeID}, where {attributeID} is an element of the sequence specified by {dicomKeyword}</para>
                </listitem>
              </itemizedlist>
              <para>{dicomTag} is the eight character hexadecimal string corresponding to the Tag of a DICOM Attribute (see <olink targetdoc="PS3.6" targetptr="chapter_6" xrefstyle="select: docname labelnumber"/>).</para>
              <para>{dicomKeyword} is the Keyword of a DICOM Attribute (see <olink targetdoc="PS3.6" targetptr="chapter_6" xrefstyle="select: docname labelnumber"/>).</para>
              <note>
                <para>Examples of valid values for {attributeID}:</para>
                <itemizedlist>
                  <listitem>
                    <para>0020000D</para>
                  </listitem>
                  <listitem>
                    <para>StudyInstanceUID</para>
                  </listitem>
                  <listitem>
                    <para>00101002.00100020</para>
                  </listitem>
                  <listitem>
                    <para>OtherPatientIDsSequence.PatientID</para>
                  </listitem>
                  <listitem>
                    <para>00101002.00100024.00400032</para>
                  </listitem>
                  <listitem>
                    <para>OtherPatientIDsSequence.IssuerOfPatientIDQualifiersSequence.UniversalEntityID</para>
                  </listitem>
                </itemizedlist>
              </note>
            </listitem>
          </itemizedlist>
          <note>
            <para>Examples of valid QIDO-RS URLs:</para>
            <itemizedlist>
              <listitem>
                <para>http://dicomrs/studies&#x200B;?PatientID=11235813</para>
              </listitem>
              <listitem>
                <para>http://dicomrs/studies&#x200B;?PatientID=11235813&#x200B;&amp;StudyDate=20130509</para>
              </listitem>
              <listitem>
                <para>http://dicomrs/studies&#x200B;?00100010=SMITH*&#x200B;&amp;00101002.00100020=11235813&#x200B;&amp;limit=25</para>
              </listitem>
              <listitem>
                <para>http://dicomrs/studies&#x200B;?00100010=SMITH*&#x200B;&amp;OtherPatientIDsSequence.00100020=11235813</para>
              </listitem>
              <listitem>
                <para>http://dicomrs/studies&#x200B;?PatientID=11235813&#x200B;&amp;includefield=00081048&#x200B;&amp;includefield=00081049&#x200B;&amp;includefield=00081060</para>
              </listitem>
              <listitem>
                <para>http://dicomrs/studies&#x200B;?PatientID=11235813&#x200B;&amp;StudyDate=20130509-20130510</para>
              </listitem>
              <listitem>
                <para>http://dicomrs/studies&#x200B;?StudyInstanceUID=1.2.392.200036.9116.2.2.2.2162893313.1029997326.94587&#x200B;%2c1.2.392.200036.9116.2.2.2.2162893313.1029997326.94583</para>
              </listitem>
            </itemizedlist>
          </note>
        </section>
        <section xml:id="sect_6.7.1.2" label="6.7.1.2" status="4">
          <title>Response</title>
          <para>The Server shall perform the query indicated in the request. The Server shall return the query results or, when the query cannot be performed, an error code.</para>
          <para>If the limit query key is not specified or its value exceeds the total number of matching results then {maximumResults} is the lesser of the number of matching results and the maximum number of results supported by the Server.</para>
          <para>If the offset query key is not specified or its value is less than zero then {skippedResults} is zero.</para>
          <para>The first result returned shall be result number ({skippedResults} + 1). The last result returned shall be result number ({skippedResults} + {maximumResults}). If ({skippedResults} + 1) exceeds {maximumResults} then no results are returned.</para>
          <para>If the number of results exceeds the maximum supported by the server, the server shall return the maximum supported results and the response shall include the following HTTP/1.1 Warning header (see RFC 2616 Section 14.46):</para>
          <para>
            <computeroutput>Warning: 299 {SERVICE}: "The number of results exceeded the maximum supported by the server. Additional results can be requested.</computeroutput>
          </para>
          <note>
            <para>The client can request additional results by specifying a value for the "offset" query key.</para>
          </note>
          <para>The server shall be idempotent so that if the list of results is the same, the response to a request with a specific set of parameters shall always be the same, including order. If the complete list of results is different for subsequent transactions the responses may be different. In a situation where results are changing due to changes in the server contents, queries using the limit and offset may be inconsistent.</para>
          <para>The response format depends on the Accept header specified in the request.</para>
          <section xml:id="sect_6.7.1.2.1" label="6.7.1.2.1" status="5">
            <title>Matching</title>
            <para>The matching semantics for each attribute are determined by the types of matching allowed by C-FIND (see <olink targetdoc="PS3.4" targetptr="sect_C.2.2.2" xrefstyle="select: docname label"/>).</para>
            <para>Matching results shall be generated according to the Hierarchical Search Method described in <olink targetdoc="PS3.4" targetptr="sect_C.4.1.3.1.1" xrefstyle="select: docname label"/>.</para>
            <para>Combined Datetime matching shall be performed (see <olink targetdoc="PS3.4" targetptr="sect_C.2.2.2.5" xrefstyle="select: docname label"/>).</para>
            <note>
              <para>If a QIDO-RS provider is acting as a proxy for a C-FIND SCP that does not support combined Datetime matching the QIDO-RS provider will need to perform a C-FIND request using Date only and filter results outside the time range before returning a QIDO-RS response</para>
            </note>
            <para>If the TimezoneOffsetFromUTC / 00080201 query key is included in the request, dates and times in the request are to be interpreted in the specified time zone.</para>
            <para>If the "fuzzymatching=true" query key/value is included in the request and it is supported then additional fuzzy semantic matching of person names shall be performed in the manner specified in the DICOM Conformance Statement for the service provider.</para>
            <para>If the "fuzzymatching=true" query key/value is included in the request and it is not supported, the response shall include the following HTTP/1.1 Warning header (see RFC 2616 Section 14.46):</para>
            <para>Warning: 299 {SERVICE}: "The fuzzymatching parameter is not supported. Only literal matching has been performed."</para>
            <para>where {SERVICE} is the base URL for the QIDO-RS provider. This may be a combination of scheme (http or https), host, port, and application.</para>
            <note>
              <para>The Warning header is separate from the Status Line and does not affect the returned Status Code.</para>
            </note>
            <section xml:id="sect_6.7.1.2.1.1" label="6.7.1.2.1.1" status="6">
              <title>Study Matching</title>
              <para>Providers of the SearchForStudies service shall support the search query keys described in <xref linkend="table_6.7.1-1" xrefstyle="select: label"/>:</para>
              <table rules="all" frame="box" xml:id="table_6.7.1-1" label="6.7.1-1">
                <caption>QIDO-RS STUDY Search Query Keys</caption>
                <thead>
                  <tr valign="top">
                    <th align="center" colspan="1" rowspan="1">
                      <para>Key Word</para>
                    </th>
                    <th align="center" colspan="1" rowspan="1">
                      <para>Tag</para>
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>StudyDate</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>00080020</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>StudyTime</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>00080030</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>AccessionNumber</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>00080050</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>ModalitiesInStudy</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>00080061</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>ReferringPhysicianName</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>00080090</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>PatientName</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>00100010</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>PatientID</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>00100020</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>StudyInstanceUID</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>0020000D</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>StudyID</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>00200010</para>
                    </td>
                  </tr>
                </tbody>
              </table>
            </section>
            <section xml:id="sect_6.7.1.2.1.2" label="6.7.1.2.1.2" status="6">
              <title>Series Matching</title>
              <para>Providers of the SearchForSeries service shall support the search query keys described in <xref linkend="table_6.7.1-1a" xrefstyle="select: label"/>:</para>
              <table rules="all" frame="box" xml:id="table_6.7.1-1a" label="6.7.1-1a">
                <caption>QIDO-RS SERIES Search Query Keys</caption>
                <thead>
                  <tr valign="top">
                    <th align="center" colspan="1" rowspan="1">
                      <para>Key Word</para>
                    </th>
                    <th align="center" colspan="1" rowspan="1">
                      <para>Tag</para>
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Modality</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>00080060</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>SeriesInstanceUID</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>0020000E</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>SeriesNumber</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>00200011</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>PerformedProcedureStepStartDate</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>00400244</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>PerformedProcedureStepStartTime</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>00400245</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>RequestAttributeSequence</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>00400275</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>&gt;ScheduledProcedureStepID</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>00400009</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>&gt;RequestedProcedureID</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>00401001</para>
                    </td>
                  </tr>
                </tbody>
              </table>
              <para>If {StudyInstanceUID} is not specified in the URL and this form of Relational Query is supported, all Study-level attributes specified in <xref linkend="table_6.7.1-1" xrefstyle="select: label"/> shall also be supported.</para>
            </section>
            <section xml:id="sect_6.7.1.2.1.3" label="6.7.1.2.1.3" status="6">
              <title>Instance Matching</title>
              <para>Providers of the SearchForInstances service shall support the search query keys described in <xref linkend="table_6.7.1-1b" xrefstyle="select: label"/>:</para>
              <table rules="all" frame="box" xml:id="table_6.7.1-1b" label="6.7.1-1b">
                <caption>QIDO-RS INSTANCE Search Query Keys</caption>
                <thead>
                  <tr valign="top">
                    <th align="center" colspan="1" rowspan="1">
                      <para>Key Word</para>
                    </th>
                    <th align="center" colspan="1" rowspan="1">
                      <para>Tag</para>
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>SOPClassUID</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>00080016</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>SOPInstanceUID</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>00080018</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>InstanceNumber</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>00200013</para>
                    </td>
                  </tr>
                </tbody>
              </table>
              <para>If {StudyInstanceUID} is not specified in the URL and this form of Relational Query is supported, all Study-level attributes specified in <xref linkend="table_6.7.1-1" xrefstyle="select: label"/> shall also be supported.</para>
              <para>If {SeriesInstanceUID} is not specified in the URL and this form of Relational Query is supported, all Series-level attributes specified in <xref linkend="table_6.7.1-1a" xrefstyle="select: label"/> shall also be supported.</para>
            </section>
          </section>
          <section xml:id="sect_6.7.1.2.2" label="6.7.1.2.2" status="5">
            <title>Query Result Attributes</title>
            <section xml:id="sect_6.7.1.2.2.1" label="6.7.1.2.2.1" status="6">
              <title>Study Result Attributes</title>
              <para>For each matching Study, the QIDO-RS provider shall return all attributes in accordance with <xref linkend="table_6.7.1-2" xrefstyle="select: label"/>:</para>
              <table rules="all" frame="box" xml:id="table_6.7.1-2" label="6.7.1-2">
                <caption>QIDO-RS STUDY Returned Attributes</caption>
                <thead>
                  <tr valign="top">
                    <th align="center" colspan="1" rowspan="1">
                      <para>Attribute Name</para>
                    </th>
                    <th align="center" colspan="1" rowspan="1">
                      <para>Tag</para>
                    </th>
                    <th align="center" colspan="1" rowspan="1">
                      <para>Notes</para>
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Specific Character Set</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0008,0005)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>If necessary for encoding any returned attributes</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Study Date</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0008,0020)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Study Time</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0008,0030)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Accession Number</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0008,0050)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Instance Availability</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0008,0056)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Modalities in Study</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0008,0061)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Referring Physician's Name</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0008,0090)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Timezone Offset From UTC</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0008,0201)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>May be absent if no value is available</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Retrieve URL</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0008,1190)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>Shall be empty if the resource cannot be retrieved via WADO-RS</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Patient's Name</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0010,0010)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Patient ID</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0010,0020)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Patient's Birth Date</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0010,0030)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Patient's Sex</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0010,0040)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Study Instance UID</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0020,000D)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Study ID</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0020,0010)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Number of Study Related Series</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0020,1206)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Number of Study Related Instances</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0020,1208)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="3" rowspan="1">
                      <para>All other Study Level DICOM Attributes passed as {attributeID} query keys that are supported by the service provider as matching or return attributes</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="3" rowspan="1">
                      <para>All other Study Level DICOM Attributes passed as "includefield" query values that are supported by the service provider as return attributes</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="3" rowspan="1">
                      <para>All available Study Level DICOM Attributes if the "includefield" query key is included with a value of "all"</para>
                    </td>
                  </tr>
                </tbody>
              </table>
              <para>Series Level and Instance Level attributes passed as "includefield" query values shall not be returned.</para>
              <note>
                <para>The above list is consistent with those required for IHE RAD-14 (see <link xl:href="http://www.ihe.net/Technical_Framework/upload/IHE_RAD_TF_Vol2.pdf"/> Table 4.14-1).</para>
              </note>
            </section>
            <section xml:id="sect_6.7.1.2.2.2" label="6.7.1.2.2.2" status="6">
              <title>Series Result Attributes</title>
              <para>For each matching Series, the QIDO-RS provider shall return all attributes listed in <xref linkend="table_6.7.1-2a" xrefstyle="select: label"/>:</para>
              <table rules="all" frame="box" xml:id="table_6.7.1-2a" label="6.7.1-2a">
                <caption>QIDO-RS SERIES Returned Attributes</caption>
                <thead>
                  <tr valign="top">
                    <th align="center" colspan="1" rowspan="1">
                      <para>Attribute Name</para>
                    </th>
                    <th align="center" colspan="1" rowspan="1">
                      <para>Tag</para>
                    </th>
                    <th align="center" colspan="1" rowspan="1">
                      <para>Notes</para>
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Specific Character Set</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0008,0005)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>If necessary for encoding any returned attributes</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Modality</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0008,0056)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Timezone Offset From UTC</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0008,0201)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>May be absent if no value is available</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Series Description</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0008,103E)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>May be absent if no value is available</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Retrieve URL</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0008,1190)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>Shall be empty if the resource cannot be retrieved via WADO-RS</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Series Instance UID</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0020,000E)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Series Number</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0020,0011)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Number of Series Related Instances</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0020,1209)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Performed Procedure Step Start Date</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0040,0244)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>May be absent if no value is available</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Performed Procedure Step Start Time</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0040,0245)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>May be absent if no value is available</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Request Attribute Sequence</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0040,0275)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>May be absent if no value is available</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>&gt;Scheduled Procedure Step ID</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0040,0009)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>&gt;Requested Procedure ID</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0040,1001)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="3" rowspan="1">
                      <para>All other Series Level DICOM Attributes passed as {attributeID} query keys that are supported by the service provider as matching or return attributes</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="3" rowspan="1">
                      <para>All other Study or Series Level DICOM Attributes passed as "includefield" query values that are supported by the service provider as return attributes</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="3" rowspan="1">
                      <para>All available Instance Level DICOM Attributes if the "includefield" query key is included with a value of "all"</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="3" rowspan="1">
                      <para>If {StudyInstanceUID} is not specified, all Study-level attributes specified in <xref linkend="table_6.7.1-2" xrefstyle="select: label"/></para>
                    </td>
                  </tr>
                </tbody>
              </table>
              <para>Instance Level attributes passed as "includefield" query values shall not be returned.</para>
              <note>
                <para>The above list is consistent with the attributes required for IHE RAD-14 (see <link xl:href="http://www.ihe.net/Technical_Framework/upload/IHE_RAD_TF_Vol2.pdf"/> Table 4.14-1).</para>
              </note>
            </section>
            <section xml:id="sect_6.7.1.2.2.3" label="6.7.1.2.2.3" status="6">
              <title>Instance Result Attributes</title>
              <para>For each matching instance, the QIDO-RS provider shall return all attributes listed in <xref linkend="table_6.7.1-2b" xrefstyle="select: label"/>:</para>
              <table rules="all" frame="box" xml:id="table_6.7.1-2b" label="6.7.1-2b">
                <caption>QIDO-RS INSTANCE Returned Attributes</caption>
                <thead>
                  <tr valign="top">
                    <th align="center" colspan="1" rowspan="1">
                      <para>Attribute Name</para>
                    </th>
                    <th align="center" colspan="1" rowspan="1">
                      <para>Tag</para>
                    </th>
                    <th align="center" colspan="1" rowspan="1">
                      <para>Notes</para>
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Specific Character Set</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0008,0005)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>If necessary for encoding any returned attributes</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>SOP Class UID</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0008,0016)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>SOP Instance UID</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0008,0018)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Instance Availability</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0008,0056)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Timezone Offset From UTC</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0008,0201)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>May be absent if no value is available</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Retrieve URL</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0008,1190)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>Shall be empty if the resource cannot be retrieved via WADO-RS</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Instance Number</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0020,0013)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1"/>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Rows</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0028,0010)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>Only present for Image Instances</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Columns</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0028,0011)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>Only present for Image Instances</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Bits Allocated</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0028,0100)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>Only present for Image Instances</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="1" rowspan="1">
                      <para>Number of Frames</para>
                    </td>
                    <td align="center" colspan="1" rowspan="1">
                      <para>(0028,0008)</para>
                    </td>
                    <td align="left" colspan="1" rowspan="1">
                      <para>Only present for Multi-frame image instances</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="3" rowspan="1">
                      <para>All other Instance Level DICOM Attributes passed as {attributeID} query keys that are supported by the service provider as matching or return attributes</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="3" rowspan="1">
                      <para>All other Study, Series or Instance Level DICOM Attributes passed as "includefield" query values that are supported by the service provider as return attributes</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="3" rowspan="1">
                      <para>All available Instance Level DICOM Attributes if the "includefield" query key is included with a value of "all"</para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="3" rowspan="1">
                      <para>If {StudyInstanceUID} is not specified, all Study-level attributes specified in <xref linkend="table_6.7.1-2" xrefstyle="select: label"/></para>
                    </td>
                  </tr>
                  <tr valign="top">
                    <td align="left" colspan="3" rowspan="1">
                      <para>If {SeriesInstanceUID} is not specified, all Series-level attributes specified in <xref linkend="table_6.7.1-2a" xrefstyle="select: label"/></para>
                    </td>
                  </tr>
                </tbody>
              </table>
              <note>
                <para>The above list is consistent with the attributes required for IHE RAD-14 (see <link xl:href="http://www.ihe.net/Technical_Framework/upload/IHE_RAD_TF_Vol2.pdf"/> Table 4.14-1 and Table 4.14-2).</para>
              </note>
            </section>
          </section>
          <section xml:id="sect_6.7.1.2.3" label="6.7.1.2.3" status="5">
            <title>Query Result Messages</title>
            <para>The server shall support returning query results as:</para>
            <itemizedlist>
              <listitem>
                <para>XML Results</para>
              </listitem>
              <listitem>
                <para>JSON Results</para>
              </listitem>
            </itemizedlist>
            <para>The result format used shall depend on the Accept header of the request.</para>
            <section xml:id="sect_6.7.1.2.3.1" label="6.7.1.2.3.1" status="6">
              <title>XML Results</title>
              <itemizedlist>
                <listitem>
                  <para>Content-Type: multipart/related; type=application/dicom+xml</para>
                  <itemizedlist>
                    <listitem>
                      <para>The response is a multipart message body where each part is a DICOM <olink targetdoc="PS3.19" targetptr="PS3.19" xrefstyle="select: labelnumber"/> XML NativeDicomModel element containing the attributes for one matching Study, Series or Instance (see <olink targetdoc="PS3.19" targetptr="sect_A.1" xrefstyle="select: docname label"/>).</para>
                    </listitem>
                    <listitem>
                      <para>The provider of the QIDO service may use a BulkData reference at its discretion (see <olink targetdoc="PS3.19" targetptr="table_A.1.5-2" xrefstyle="select: docname label"/> and <xref linkend="sect_6.5.6" xrefstyle="select: label"/>). For example, this might be done to avoid encoding a large DICOM Value Field, such as an image thumbnail.</para>
                    </listitem>
                    <listitem>
                      <para>If there are no matching results, the message body will be empty.</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
                <listitem>
                  <para>Each item in the multipart response will contain the following HTTP/1.1 headers:</para>
                  <itemizedlist>
                    <listitem>
                      <para>Content-Type: application/dicom+xml</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
            </section>
            <section xml:id="sect_6.7.1.2.3.2" label="6.7.1.2.3.2" status="6">
              <title>JSON Results</title>
              <itemizedlist>
                <listitem>
                  <para>Content-Type: application/json</para>
                  <itemizedlist>
                    <listitem>
                      <para>The response is a DICOM JSON message containing a DICOM JSON property for each matching study, series or instance containing sub-properties describing the matching attributes for each study, series or instance (see <xref linkend="sect_F.2" xrefstyle="select: label"/>).</para>
                    </listitem>
                    <listitem>
                      <para>The provider of the QIDO service may use a BulkDataURI reference at its discretion (see <xref linkend="sect_F.2.6" xrefstyle="select: label"/>). For example, this might be done to avoid encoding a large DICOM Value Field, such as an image thumbnail.</para>
                    </listitem>
                    <listitem>
                      <para>If there are no matching results, the JSON message is empty.</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </itemizedlist>
            </section>
          </section>
        </section>
        <section xml:id="sect_6.7.1.3" label="6.7.1.3" status="4">
          <title>Status Codes</title>
          <para><xref linkend="table_6.7-1" xrefstyle="select: label"/> lists the HTTP/1.1 status codes that shall be used to report any of the associated error and warning situations. Other error codes may be present for other error and warning situations.</para>
          <table rules="all" frame="box" xml:id="table_6.7-1" label="6.7-1">
            <caption>QIDO-RS HTTP/1.1 Status Codes</caption>
            <thead>
              <tr valign="top">
                <th align="center" colspan="1" rowspan="1">
                  <para>
                    <emphasis role="bold">Code</emphasis>
                  </para>
                </th>
                <th align="center" colspan="1" rowspan="1">
                  <para>
                    <emphasis role="bold">Name</emphasis>
                  </para>
                </th>
                <th align="center" colspan="1" rowspan="1">
                  <para>
                    <emphasis role="bold">Description</emphasis>
                  </para>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr valign="top">
                <td align="left" colspan="3" rowspan="1">
                  <para>Success</para>
                </td>
              </tr>
              <tr valign="top">
                <td align="left" colspan="1" rowspan="1">
                  <para>200</para>
                </td>
                <td align="center" colspan="1" rowspan="1">
                  <para>OK</para>
                </td>
                <td align="left" colspan="1" rowspan="1">
                  <para>The query completed and any matching results are returned in the message body.</para>
                </td>
              </tr>
              <tr valign="top">
                <td align="left" colspan="3" rowspan="1">
                  <para>Failure</para>
                </td>
              </tr>
              <tr valign="top">
                <td align="left" colspan="1" rowspan="1">
                  <para>400</para>
                </td>
                <td align="left" colspan="1" rowspan="1">
                  <para>Bad Request</para>
                </td>
                <td align="left" colspan="1" rowspan="1">
                  <para>The QIDO-RS Provider was unable to perform the query because the Service Provider cannot understand the query component.</para>
                </td>
              </tr>
              <tr valign="top">
                <td align="left" colspan="1" rowspan="1">
                  <para>401</para>
                </td>
                <td align="left" colspan="1" rowspan="1">
                  <para>Unauthorized</para>
                </td>
                <td align="left" colspan="1" rowspan="1">
                  <para>The QIDO-RS Provider refused to perform the query because the client is not authenticated.</para>
                </td>
              </tr>
              <tr valign="top">
                <td align="left" colspan="1" rowspan="1">
                  <para>403</para>
                </td>
                <td align="left" colspan="1" rowspan="1">
                  <para>Forbidden</para>
                </td>
                <td align="left" colspan="1" rowspan="1">
                  <para>The QIDO-RS Provider understood the request, but is refusing to perform the query (e.g., an authenticated user with insufficient privileges).</para>
                </td>
              </tr>
              <tr valign="top">
                <td align="left" colspan="1" rowspan="1">
                  <para>413</para>
                </td>
                <td align="left" colspan="1" rowspan="1">
                  <para>Request entity too large</para>
                </td>
                <td align="left" colspan="1" rowspan="1">
                  <para>The query was too broad and a narrower query or paging should be requested. The use of this status code should be documented in the conformance statement.</para>
                </td>
              </tr>
              <tr valign="top">
                <td align="left" colspan="1" rowspan="1">
                  <para>503</para>
                </td>
                <td align="left" colspan="1" rowspan="1">
                  <para>Busy</para>
                </td>
                <td align="left" colspan="1" rowspan="1">
                  <para>Service is unavailable.</para>
                </td>
              </tr>
            </tbody>
          </table>
        </section>
      </section>
    </section>
  </chapter>
  <chapter xml:id="chapter_7" label="7" status="1">
    <title>Persistent Object Types</title>
    <para>The provisions for some specific object types shall be as defined in this section.</para>
    <note>
      <para>In all cases the categorization depends on the SOP Class of the objects, enabling a client, or application building an HTML page for the client, to determine in advance of the request what the requirements will be.</para>
    </note>
    <section xml:id="sect_7.1" label="7.1" status="2">
      <title>Single Frame Image Objects</title>
      <section xml:id="sect_7.1.1" label="7.1.1" status="3">
        <title>Objects Accessed</title>
        <para>In this category are all object instances of SOP classes defined in <olink targetdoc="PS3.3" targetptr="PS3.3" xrefstyle="select: labelnumber"/> that consist of a single image frame, instances of multi-frame SOP Classes that contain only one frame, or object instances that consist of single frame accessed from instances of multi-frame SOP Classes using the "frameNumber" parameter.</para>
      </section>
      <section xml:id="sect_7.1.2" label="7.1.2" status="3">
        <title>MIME Type Constraints</title>
        <para>The Server shall be able to send a response for each of the following MIME types:</para>
        <itemizedlist>
          <listitem>
            <para>WADO-URI and WADO-WS</para>
            <itemizedlist>
              <listitem>
                <para>application/dicom</para>
              </listitem>
              <listitem>
                <para>image/jpeg</para>
              </listitem>
            </itemizedlist>
          </listitem>
          <listitem>
            <para>WADO-RS</para>
            <itemizedlist>
              <listitem>
                <para>application/dicom</para>
              </listitem>
              <listitem>
                <para>application/octet-stream</para>
              </listitem>
              <listitem>
                <para>application/dicom+xml</para>
              </listitem>
            </itemizedlist>
          </listitem>
        </itemizedlist>
        <para>If the contentType parameter is not present in the URI or WADO-WS request, the response shall contain an image/jpeg MIME type, if compatible with the 'Accept' field of the GET method. If the contentType parameter is not present in the WADO-RS request, the response is dependent on the 'Accept' field and the requested resource.</para>
        <para>When an image/jpeg MIME type is returned, the image shall be encoded using the JPEG baseline lossy 8 bit Huffman encoded non-hierarchical non-sequential process ISO/IEC 10918.</para>
        <note>
          <para>The choice of image/jpeg as the default for continuous tone images is a consequence of the universal support by Web Clients.</para>
        </note>
        <para>The Server should also support the following MIME types for WADO-URI or WADO-WS:</para>
        <itemizedlist>
          <listitem>
            <para>image/gif</para>
          </listitem>
          <listitem>
            <para>image/png</para>
          </listitem>
          <listitem>
            <para>image/jp2</para>
          </listitem>
        </itemizedlist>
        <para>The Server should also support the following MIME types for WADO-RS:</para>
        <itemizedlist>
          <listitem>
            <para>image/dicom</para>
          </listitem>
          <listitem>
            <para>image/dicom+jpeg</para>
          </listitem>
          <listitem>
            <para>image/dicom+rle</para>
          </listitem>
          <listitem>
            <para>image/dicom+jpeg-ls</para>
          </listitem>
          <listitem>
            <para>image/dicom+jp2image/dicom+jpx</para>
          </listitem>
        </itemizedlist>
        <para>The Server may also support other MIME types.</para>
      </section>
    </section>
    <section xml:id="sect_7.2" label="7.2" status="2">
      <title>Multi-frame and Video Image Objects</title>
      <section xml:id="sect_7.2.1" label="7.2.1" status="3">
        <title>Objects Included</title>
        <para>In this category are all SOP classes defined in <olink targetdoc="PS3.3" targetptr="PS3.3" xrefstyle="select: labelnumber"/> that are multi-frame or video image objects.</para>
      </section>
      <section xml:id="sect_7.2.2" label="7.2.2" status="3">
        <title>MIME Type Constraints</title>
        <para>The Server shall be able to send a response for the following MIME types:</para>
        <itemizedlist>
          <listitem>
            <para>WADO-URI and WADO-WS</para>
            <itemizedlist>
              <listitem>
                <para>application/dicom</para>
              </listitem>
            </itemizedlist>
          </listitem>
          <listitem>
            <para>WADO-RS</para>
            <itemizedlist>
              <listitem>
                <para>application/dicom</para>
              </listitem>
              <listitem>
                <para>application/octet-stream</para>
              </listitem>
              <listitem>
                <para>application/dicom+xml</para>
              </listitem>
            </itemizedlist>
          </listitem>
        </itemizedlist>
        <para>If the contentType parameter is not present in the WADO-URI or WADO-WS request, the response shall contain a application/dicom MIME type.</para>
        <para>The Server can optionally support the following MIME types for WADO-URI and WADO-WS:</para>
        <itemizedlist>
          <listitem>
            <para>video/mpeg</para>
          </listitem>
          <listitem>
            <para>image/gif</para>
          </listitem>
        </itemizedlist>
        <para>The Server can optionally support the following MIME types for WADO-RS:</para>
        <itemizedlist>
          <listitem>
            <para>image/dicom+jpx</para>
          </listitem>
          <listitem>
            <para>video/mpeg</para>
          </listitem>
          <listitem>
            <para>video/mp4</para>
          </listitem>
        </itemizedlist>
        <para>The Server may also support other MIME types.</para>
      </section>
    </section>
    <section xml:id="sect_7.3" label="7.3" status="2">
      <title>Text Objects</title>
      <section xml:id="sect_7.3.1" label="7.3.1" status="3">
        <title>Objects Included</title>
        <para>In this category are all SOP classes defined in <olink targetdoc="PS3.3" targetptr="PS3.3" xrefstyle="select: labelnumber"/> that include the SR Document Content Module.</para>
        <note>
          <para>This includes all SOP Classes that are SR documents, such as narrative text, structured reports, CAD, measurement reports and key object selection documents.</para>
        </note>
      </section>
      <section xml:id="sect_7.3.2" label="7.3.2" status="3">
        <title>MIME Type Constraints</title>
        <para>The Server shall be able to send a response in each of the following MIME types:</para>
        <itemizedlist>
          <listitem>
            <para>application/dicom</para>
          </listitem>
          <listitem>
            <para>text/plain</para>
          </listitem>
          <listitem>
            <para>text/html</para>
          </listitem>
        </itemizedlist>
        <para>If the contentType parameter is not present in the request, or contains only MIME types that the Server does not support, the response shall contain a text/html MIME type.</para>
        <para>It is recommended that the Server also support the following MIME types:</para>
        <itemizedlist>
          <listitem>
            <para>text/xml</para>
          </listitem>
          <listitem>
            <para>application/pdf</para>
          </listitem>
          <listitem>
            <para>text/rtf</para>
          </listitem>
          <listitem>
            <para>a "CDA" MIME type, in conformance to HL7 CDA R2, e.g., text/xml</para>
          </listitem>
        </itemizedlist>
        <para>The Server may also support other MIME types.</para>
      </section>
    </section>
    <section xml:id="sect_7.4" label="7.4" status="2">
      <title>Other Objects</title>
      <section xml:id="sect_7.4.1" label="7.4.1" status="3">
        <title>Objects Included</title>
        <para>The category shall include all objects of all SOP classes defined in <olink targetdoc="PS3.3" targetptr="PS3.3" xrefstyle="select: labelnumber"/> that are not included in the categories described in the sections above, and that are considered in <olink targetdoc="PS3.3" targetptr="PS3.3" xrefstyle="select: labelnumber"/> as classes of persistent objects.</para>
      </section>
      <section xml:id="sect_7.4.2" label="7.4.2" status="3">
        <title>MIME Type Constraints</title>
        <para>The Server shall be able to send a response in the following MIME type:</para>
        <itemizedlist>
          <listitem>
            <para>application/dicom</para>
          </listitem>
        </itemizedlist>
        <para>The Server may also support other MIME types.</para>
        <para>If the contentType parameter is not present in the request, the response shall contain an application/dicom MIME type.</para>
      </section>
    </section>
  </chapter>
  <chapter xml:id="chapter_8" label="8" status="1">
    <title>Parameters of the Request</title>
    <section xml:id="sect_8.1" label="8.1" status="2">
      <title>Parameters Available for all DICOM Persistent Objects</title>
      <para>Parameters specified in this section are applicable to all supported DICOM SOP Classes.</para>
      <note>
        <para>To identify a DICOM Object, only one UID is required, because any UID is globally unique. However, the standard requires that the UID of the higher levels in the DICOM Information Model are specified (i.e., series and study), in order to support the use of DICOM devices that support only the baseline hierarchical (rather than extended relational) Query/Retrieve model, which requires the Study Instance UID and Series Instance UID to be defined when retrieving an SOP Instance, as defined in <olink targetdoc="PS3.4" targetptr="PS3.4" xrefstyle="select: labelnumber"/>.</para>
      </note>
      <section xml:id="sect_8.1.1" label="8.1.1" status="3">
        <title>Request Type</title>
        <para>Type of request performed. This parameter is REQUIRED for URI based mode.</para>
        <para>The parameter name shall be "requestType".</para>
        <para>The value shall be "WADO".</para>
        <note>
          <para>This parameter allows other types of requests to be introduced in the future, using a similar syntax.</para>
        </note>
      </section>
      <section xml:id="sect_8.1.2" label="8.1.2" status="3">
        <title>Unique Identifier of the Study</title>
        <para>Study Instance UID as defined in <olink targetdoc="PS3.3" targetptr="PS3.3" xrefstyle="select: labelnumber"/>. This parameter is REQUIRED.</para>
        <para>The parameter name shall be "studyUID" for URI based mode, and "StudyRequest" that contains a required "studyInstanceUID" attribute for the WS mode.</para>
        <para>The value shall be encoded as a Unique Identifier (UID) string, as specified in <olink targetdoc="PS3.5" targetptr="PS3.5" xrefstyle="select: labelnumber"/>, except that it shall not be padded to an even length with a NULL character.</para>
      </section>
      <section xml:id="sect_8.1.3" label="8.1.3" status="3">
        <title>Unique Identifier of the Series</title>
        <para>Series Instance UID as defined in the <olink targetdoc="PS3.3" targetptr="PS3.3" xrefstyle="select: labelnumber"/>. This parameter is REQUIRED.</para>
        <para>The parameter name shall be "seriesUID" for URI based mode, and, for the WS mode, one or multiple "SeriesRequest" that is included into the above described "StudyRequest" and that contains a required "seriesInstanceUID" attribute.</para>
        <para>The value shall be encoded as a Unique Identifier (UID) string, as specified in <olink targetdoc="PS3.5" targetptr="PS3.5" xrefstyle="select: labelnumber"/>, except that it shall not be padded to an even length with a NULL character.</para>
      </section>
      <section xml:id="sect_8.1.4" label="8.1.4" status="3">
        <title>Unique Identifier of the Object</title>
        <para>SOP Instance UID as defined in the <olink targetdoc="PS3.3" targetptr="PS3.3" xrefstyle="select: labelnumber"/>. This parameter is REQUIRED.</para>
        <para>The parameter name shall be "objectUID" for URI based mode, and for the WS mode one or multiple "DocumentRequest" that is included into the above described "SeriesRequest" and that include each one:</para>
        <itemizedlist>
          <listitem>
            <para>a required "DocumentUniqueId" that contains the Instance UID,</para>
          </listitem>
          <listitem>
            <para>an optional "RepositoryUniqueId" that contains the UID of the DICOM server, and</para>
          </listitem>
          <listitem>
            <para>an optional "HomeCommunityId" that contains the UID of the "clinical affinity domain".</para>
          </listitem>
        </itemizedlist>
        <para>The value shall be encoded as a unique identifier (UID) string, as specified in <olink targetdoc="PS3.5" targetptr="PS3.5" xrefstyle="select: labelnumber"/>, except that it shall not be padded to an even length with a NULL character.</para>
      </section>
      <section xml:id="sect_8.1.5" label="8.1.5" status="3">
        <title>MIME Type of the Response</title>
        <para>MIME type(s) desired by the Web Client for the response from the Server, as defined in the IETF RFC2616. This parameter is OPTIONAL for URI based mode, it shall be present for the WS mode "Rendered Requester" and shall not be present in the other WS mode transactions.</para>
        <para>The parameter name shall be "contentType" for URI based mode, and, for the WS mode, "ContentTypeList" that contains one or multiple "ContentType".</para>
        <para>In URI based mode, the value shall be a list of MIME types, separated by a "," character, and potentially associated with relative degree of preference, as specified in IETF RFC2616. In WS mode, it contains one or more "ContentType" elements containing each one MIME type.</para>
        <para>In URI based mode, the Web Client shall provide list of content types it supports in the "Accept" field of the GET method. The value of the contentType parameter of the request shall be one of the values specified in that field.</para>
        <note>
          <orderedlist numeration="arabic">
            <listitem>
              <para>Typically the Accept field will be sent by a Web Client as "*/*", which is compatible with any MIME types.</para>
            </listitem>
            <listitem>
              <para>When this parameter is absent, the default content type of the response is dictated by the "MIME type constraints" sub-sections of Section 7 (i.e., 7.1.2, 7.2.2, 7.3.2, 7.4.2).</para>
            </listitem>
          </orderedlist>
        </note>
      </section>
      <section xml:id="sect_8.1.6" label="8.1.6" status="3">
        <title>Charset of the Response</title>
        <para>Character set with which the returned objects are to be encoded, as defined in the IETF RFC2616. This parameter is OPTIONAL for URI based mode, and for the WS mode "Rendered Requester" and shall not be present in the other WS mode transactions.</para>
        <para>The parameter name shall be "charset" for URI based mode, and "CharsetList" containing one or more elements "Charset" for the WS mode.</para>
        <para>For the URI mode, the value shall be a list of character sets, separated by a "," character, and potentially associated with relative degree of preference, as specified in IETF RFC2616.</para>
        <para>In URI based mode, the Web Client may provide a list of character sets it supports in the "Accept-charset" field of the GET method. If this field is present, the value of the charset parameter of the request shall be one of the values specified in it.</para>
        <para>The Web Server may or may not support character set conversion. If character set conversion is supported:</para>
        <itemizedlist>
          <listitem>
            <para>text based DICOM objects retrieved other than as application/dicom MIME type (e.g., text/plain) may be returned in the requested character set (converted if necessary)</para>
          </listitem>
          <listitem>
            <para>DICOM objects retrieved as application/dicom MIME type have all contained strings returned in the requested character set (converted if necessary) and the Specific Character Set (0008,0005) updated (if necessary)</para>
          </listitem>
        </itemizedlist>
        <note>
          <orderedlist numeration="arabic">
            <listitem>
              <para>The IANA Character Set registrations specify names and multiple aliases for most character sets. The standard value for use in WADO is the one marked by IANA as "preferred for MIME." If IANA has not marked one of the aliases as "preferred for MIME", the name used in DICOM shall be the value used for WADO.</para>
            </listitem>
            <listitem>
              <para>The table in Annex D provides an informative mapping of some IANA values to DICOM Specific Character Set Defined Terms.</para>
            </listitem>
          </orderedlist>
        </note>
      </section>
      <section xml:id="sect_8.1.7" label="8.1.7" status="3">
        <title>Anonymize Object</title>
        <para>Removal of all patient identification information from within the DICOM objects, if not already done, as defined in <olink targetdoc="PS3.15" targetptr="PS3.15" xrefstyle="select: labelnumber"/>. This parameter is OPTIONAL. In the URI based mode, it shall only be present if contentType is application/dicom.</para>
        <para>This parameter is Optional</para>
        <para>The parameter name shall be "anonymize" for URI based mode, and "Anonymize" for the WS mode.</para>
        <para>The value shall be "yes".</para>
        <para>The Server may return an error if it either cannot or refuses to anonymize these objects.</para>
        <para>In WS mode, the metadata describing the objects or information extracted from them in the response shall be anonymized if requested.</para>
        <para>The Server shall return a new SOP Instance UID if the content of the object has not already been anonymized.</para>
        <note>
          <orderedlist numeration="arabic">
            <listitem>
              <para>This standard does not introduce any security-related requirements. It is likely that the information contained within DICOM objects identifies the patient. The protocol used (that is HTTP) can be replaced by HTTPs, which is its secure extension, to protect the information in transit. The underlying DICOM implementation decides whether or not to grant access to a particular DICOM object based on whatever security policy or mechanism it has in place. A server is unlikely to fulfill a request from an unknown user (e.g., accessed via the HTTP protocol) unless it is certain that the data requested has no patient identifying information within it and has been approved for public viewing.</para>
            </listitem>
            <listitem>
              <para>The Anonymize object enables, for example, teaching files systems or clinical trial applications to offer an access to original images stored in a PACS, without disclosing the patients identity, and requiring storage of a (de-identified) copy of the original image. Anonymization is the responsibility of the Server. In order to preserve patient confidentiality, the Server likely will refuse to deliver an anonymized SOP instance to an unknown or unauthorized person unless the Server is certain that the SOP instance holds no patient identifying information. This would include "blanking out" any annotation area(s) containing nominative information burned into the pixels or in the overlays.</para>
            </listitem>
          </orderedlist>
        </note>
      </section>
      <section xml:id="sect_8.1.9" label="8.1.9" status="3">
        <title>Retrieve Partial Information From Objects</title>
        <para>Retrieval of additional information from the DICOM objects, using a filtering mechanism based on the XML mapping of DICOM IODs, as described in the Native DICOM Model defined in <olink targetdoc="PS3.19" targetptr="PS3.19" xrefstyle="select: labelnumber"/>. This parameter is defined only for the WS mode "Information Requester" transaction.</para>
        <para>The parameter name shall be "XPath".</para>
      </section>
    </section>
    <section xml:id="sect_8.2" label="8.2" status="2">
      <title>Parameters for DICOM Image Persistent Objects</title>
      <para>These parameters shall only be included when a request is made for a Single Frame Image Objects or Multi-Frame Image or video Objects as defined in <xref linkend="sect_7.2" xrefstyle="select: label"/>.</para>
    </section>
    <section xml:id="sect_8.2.1" label="8.2.1" status="2">
      <title>Annotation On The Object</title>
      <para>Annotation of objects retrieved and displayed as an image. This parameter is OPTIONAL for the URI based mode and the WS mode "Rendered Requester" transaction. It shall not be present if contentType is application/dicom, or is a non-image MIME type (e.g., text/*). When it is not present for image objects, no additional annotation may be burnt in.</para>
      <para>When used in conjunction with a presentation state object, it shall be applied after the presentation on the images. When used in conjunction with the region parameter, it shall be applied after the selection of the region.</para>
      <para>The parameter name shall be "annotation" for URI based mode, and "Annotation" for the WS mode. Its value is a non-empty list of one or more of the following items, separated by a "," character:</para>
      <itemizedlist>
        <listitem>
          <para>"patient", for displaying patient information on the image (e.g., patient name, birth date,…)</para>
        </listitem>
        <listitem>
          <para>"technique", for displaying technique information of the image (e.g., image number, study date, image position,…).</para>
        </listitem>
      </itemizedlist>
      <note>
        <para>The exact nature and presentation of the annotation is determined by the Server. The annotation is burned into the returned image pixels.</para>
      </note>
      <section xml:id="sect_8.2.2" label="8.2.2" status="3">
        <title>Number of Pixel Rows</title>
        <para>The parameter name shall be "rows" for URI based mode, and "Rows" for the WS mode.</para>
        <para>The value shall be expressed as an integer, representing the image height to be returned. It is OPTIONAL for the URI based mode and the WS mode "Rendered Requester" transaction. It shall not be present for other WS mode transactions. It shall not be present if contentType is application/dicom.</para>
        <para>If both "rows" and "columns" are specified, then each shall be interpreted as a maximum, and a size will be chosen for the images within these constraints, maintaining the correct aspect ratio. If the number of rows is absent and the number of columns is present, the number of rows shall be chosen in order to maintain the correct aspect ratio. If both are absent, the images (or selected region) are sent in their original size (or the size of the presentation state applied on the images), resulting as one pixel of screen image for each value in the images data matrix.</para>
        <para>The value shall be encoded as an integer string (IS), as specified in <olink targetdoc="PS3.5" targetptr="PS3.5" xrefstyle="select: labelnumber"/>.</para>
      </section>
      <section xml:id="sect_8.2.3" label="8.2.3" status="3">
        <title>Number of Pixel Columns</title>
        <para>The parameter name shall be "columns" for URI based mode, and "Columns" for the WS mode.</para>
        <para>The value shall be expressed as an integer, representing the image width to be returned. It is OPTIONAL for the URI based mode and the WS mode "Rendered Requester" transaction. It shall not be present if contentType is application/dicom.</para>
        <para>If both "rows" and "columns" are specified, then each shall be interpreted as a maximum, and a size will be chosen for the images within these constraints, maintaining the correct aspect ratio. If the number of columns is absent and the number of rows is present, the number of columns shall be chosen in order to maintain the correct aspect ratio. If both are absent, the images (or selected region) is sent in its original size (or the size of the presentation state applied on the images), resulting as one pixel of screen for one pixel of the images.</para>
        <para>The value shall be encoded as an integer string (IS), as specified in <olink targetdoc="PS3.5" targetptr="PS3.5" xrefstyle="select: labelnumber"/>.</para>
      </section>
      <section xml:id="sect_8.2.4" label="8.2.4" status="3">
        <title>Region of the Image</title>
        <para>This parameter allows selection of a rectangular region of an image matrix to be retrieved. The purpose of this parameter is to allow a user to view a selected area of the image matrix, for example at higher magnification.</para>
        <para>The parameter is OPTIONAL for the URI based mode and the WS mode "Rendered Requester" transaction. It shall not be present for other WS mode transactions.</para>
        <para>The parameter name shall be "region" for URI based mode, and "Region" for the WS mode.</para>
        <para>It shall not be present if contentType is application/dicom.</para>
        <para>The value shall be expressed as a list of four positive decimal strings, separated by the ',' character, representing the region of the source images to be returned. These decimal values shall be values in a normalized coordinate system relative to the size of the original image matrix measured in rows and columns, with values ranging from 0.0 to 1.0, and representing in the following order:</para>
        <itemizedlist>
          <listitem>
            <para>the x position of the top left hand corner of the region to be retrieved, 0.0 corresponding to the first column of the image matrix. In the WS mode, this value is encoded into an XML element "XMin".</para>
          </listitem>
          <listitem>
            <para>the y position of the top left hand corner of the region to be retrieved, 0.0 corresponding to the top row of the image matrix. In the WS mode, this value is encoded into an XML element "YMin".</para>
          </listitem>
          <listitem>
            <para>the x position of the bottom right hand extent of the region, 1.0 corresponding to the last column of the image matrix, 0.0 being forbidden. In the WS mode, this value is encoded into an XML element "XMax".</para>
          </listitem>
          <listitem>
            <para>the y position of the bottom right hand extent of the region, 1.0 corresponding to the last row of the image matrix, 0.0 being forbidden. In the WS mode, this value is encoded into an XML element "YMax".</para>
          </listitem>
        </itemizedlist>
        <note>
          <para>The Server may or may not support this parameter.</para>
        </note>
        <para>If this parameter is supported, an image matrix corresponding to the specified region shall be returned with size corresponding to the specified normalized coordinate values otherwise the complete image matrix shall be returned. If the presentationUID parameter is present, the region shall be selected after the corresponding presentation state has been applied on the images.</para>
      </section>
      <section xml:id="sect_8.2.5" label="8.2.5" status="3">
        <title>Window Center of the Image</title>
        <para>The parameter name shall be "windowCenter" for URI based mode, and "WindowCenter" for the WS mode.</para>
        <para>Controls the luminosity of the images as defined in <olink targetdoc="PS3.3" targetptr="PS3.3" xrefstyle="select: labelnumber"/>. This parameter is OPTIONAL for the URI based mode and the WS mode "Rendered Requester" transaction. It shall not be present for other WS mode transactions. This parameter is REQUIRED if "windowWidth" or "WindowWidth" is present. This parameter shall not be present if there is a presentationUID parameter. It shall not be present if contentType is application/dicom.</para>
        <para>The value shall be encoded as a decimal string (DS), as specified in <olink targetdoc="PS3.5" targetptr="PS3.5" xrefstyle="select: labelnumber"/>.</para>
      </section>
      <section xml:id="sect_8.2.6" label="8.2.6" status="3">
        <title>Window Width of the Image</title>
        <para>The parameter name shall be "windowWidth" for URI based mode, and "WindowWidth" for the WS mode.</para>
        <para>Controls the contrast of the images as defined in <olink targetdoc="PS3.3" targetptr="PS3.3" xrefstyle="select: labelnumber"/>. This parameter is OPTIONAL for the URI based mode and the WS mode "Rendered Requester" transaction. It shall not be present for other WS mode transactions. It is REQUIRED if "windowCenter" or "WindowCenter" is present. This parameter shall not be present if there is a presentationUID parameter. It shall not be present if contentType is application/dicom.</para>
        <para>The value shall be encoded as a decimal string (DS), as specified in <olink targetdoc="PS3.5" targetptr="PS3.5" xrefstyle="select: labelnumber"/>.</para>
      </section>
      <section xml:id="sect_8.2.7" label="8.2.7" status="3">
        <title>Frame Number</title>
        <para>The parameter name shall be "frameNumber" for URI based mode, and "FrameNumber" for the WS mode.</para>
        <para>Specifies that the single frame with that number within a multi-frame image object, as defined in <olink targetdoc="PS3.3" targetptr="PS3.3" xrefstyle="select: labelnumber"/> that shall be returned. It is OPTIONAL and shall be ignored in the case of all objects other than multi-frame objects. It shall not be present if contentType is application/dicom.</para>
        <para>The value shall be encoded as an integer string (IS), as specified in <olink targetdoc="PS3.5" targetptr="PS3.5" xrefstyle="select: labelnumber"/>.</para>
      </section>
      <section xml:id="sect_8.2.8" label="8.2.8" status="3">
        <title>Image Quality</title>
        <para>The parameter name shall be "imageQuality" for URI based mode, and "ImageQuality" for the WS mode. It is OPTIONAL for the URI based mode and the WS mode "DICOM requester" and "Rendered Requester" transactions. It shall not be present if contentType is application/dicom, except if the transferSyntax parameter is present and corresponds to a lossy compression.</para>
        <para>If the requested MIME type is for a lossy compressed image (e.g., image/jpeg), this parameter indicates the required quality of the image to be returned within the range 1 to 100, 100 being the best quality.</para>
        <note>
          <para>Decompression and re-compression may degrade the image quality if the original image was already irreversibly compressed. In case the image has been already lossy compressed using the same format as required (e.g., jpeg), it may be sent as it is without decompressing and re-compressing it.</para>
        </note>
        <para>The value shall be encoded as an integer string (IS), as specified in <olink targetdoc="PS3.5" targetptr="PS3.5" xrefstyle="select: labelnumber"/>.</para>
        <note>
          <para>The specific interpretation of the meaning of this parameter is left to the interpretation of the implementers of the standard.</para>
        </note>
      </section>
      <section xml:id="sect_8.2.9" label="8.2.9" status="3">
        <title>Unique Identifier of the Presentation Object</title>
        <para>The parameter name shall be "presentationUID" for URI based mode, and "PresentationUID" for the WS mode.</para>
        <para>SOP Instance UID of the presentation state storage object to be applied to the images. This parameter is OPTIONAL for the URI based mode and the WS mode "Rendered Requester" transaction. It shall not be present if contentType is application/dicom.</para>
        <para>The value shall be encoded as a unique identifier (UID) string, as specified in <olink targetdoc="PS3.5" targetptr="PS3.5" xrefstyle="select: labelnumber"/>, except that it shall not be padded to an even length with a NULL character.</para>
        <para>If this parameter is combined with region and/or annotation parameter(s), the presentation state shall be applied to the images prior to selecting a region and burning in annotations.</para>
        <para>If the Presentation Size Mode in the presentation state is SCALE TO FIT or TRUE SIZE, then the displayed area specified in the presentation shall be scaled to fit the size specified by the rows and columns parameters if present, otherwise the displayed area selected in the presentation state will be returned without scaling.</para>
        <note>
          <orderedlist numeration="arabic">
            <listitem>
              <para>The intent of the TRUE SIZE mode in the presentation state cannot be satisfied, since the physical size of the pixels displayed by the web browser is unlikely to be known. If the Presentation Size Mode in the presentation state is MAGNIFY, then the displayed area specified in the presentation shall be magnified (scaled) as specified in the presentation state. It will then be cropped to fit the size specified by the rows and columns parameters, if present.</para>
            </listitem>
            <listitem>
              <para>Any Displayed Area relative annotations specified in the presentation state are rendered relative to the Specified Displayed Area within the presentation state, not the size of the returned image.</para>
            </listitem>
          </orderedlist>
        </note>
        <para>Though the output of the presentation state is defined in DICOM to be in P-Values (grayscale values intended for display on a device calibrated to the DICOM Grayscale Standard Display Function <olink targetdoc="PS3.14" targetptr="PS3.14" xrefstyle="select: labelnumber"/>), the grayscale or color space for the images returned by the request is not defined by this standard.</para>
      </section>
      <section xml:id="sect_8.2.10" label="8.2.10" status="3">
        <title>Unique Identifier of the Series Containing The Presentation Object</title>
        <para>The parameter name shall be "presentationSeriesUID" for URI based mode, and "PresentationSeriesUID" for the WS mode.</para>
        <para>Series Instance UID of the series containing the presentation state storage object to be applied on the images. This parameter is REQUIRED and shall only be present if "presentationUID" is present.</para>
        <para>The value shall be encoded as a unique identifier (UID) string, as specified in <olink targetdoc="PS3.5" targetptr="PS3.5" xrefstyle="select: labelnumber"/>, except that it shall not be padded to an even length with a NULL character.</para>
        <note>
          <para>As specified in DICOM, the Presentation State will be in the same study as the images it applies to.</para>
        </note>
      </section>
      <section xml:id="sect_8.2.11" label="8.2.11" status="3">
        <title>Transfer Syntax UID</title>
        <para>The parameter name shall be "transferSyntax" for URI based mode, and "TransferSyntaxUIDList" containing one or more "TransferSyntaxUID" elements for the WS mode.</para>
        <para>The Transfer Syntax to be used within the DICOM image objects, as specified in <olink targetdoc="PS3.6" targetptr="PS3.6" xrefstyle="select: labelnumber"/>. This parameter is OPTIONAL for the URI based mode and the WS mode "DICOM Requester" transaction. It shall not be present if contentType is other than application/dicom.</para>
        <para>By default the DICOM object(s) returned shall be encoded in Explicit VR Little Endian. Neither Implicit VR, nor Big Endian shall be used. The response shall be the Transfer Syntax requested if possible. If it is not possible for the response to be sent using the requested transfer syntax then the Explicit VR Little Endian Uncompressed Transfer Syntax shall be used.</para>
        <note>
          <para>The transfer syntax can be chosen as one of the values of TransferSyntaxUID corresponding to JPIP, in case of which the returned objects will contain the URL of the JPIP session to launch for retrieving the corresponding image.</para>
        </note>
        <para>The value shall be encoded as an unique identifier (UID) string, as specified in <olink targetdoc="PS3.5" targetptr="PS3.5" xrefstyle="select: labelnumber"/>, except that it shall not be padded to an even length with a NULL character.</para>
      </section>
    </section>
  </chapter>
  <chapter xml:id="chapter_A" label="A" status="1">
    <title>URL/URI Transfer Syntax (Informative)</title>
    <para>Access to the content of a data object is enabled by specifying a "link" pointing to a specific DICOM Persistent Object by means of its URL/URI and specifying its DICOM object Instance UID and the transfer syntax to be employed.</para>
    <para>Extension to searching DICOM objects from a Server is out of the scope of the present standard. Differences between "Web Accessing" and "Searching" are mainly:</para>
    <orderedlist numeration="arabic">
      <listitem>
        <para>"Web Accessing" means retrieving an object as a "binary" answer: "I have it, I give it to you" or "I haven't". In fact, the negative answer will be a "Void" object or an error.</para>
      </listitem>
      <listitem>
        <para>"Searching" means querying for objects has a "fuzzy answer": "I have a list of potential candidates to your question - see above the (possible void) list of their reference -".</para>
      </listitem>
    </orderedlist>
    <section xml:id="sect_A.1" label="A.1" status="2">
      <title>General Syntax</title>
      <para>The general syntax of the standard respects the URI recommendation IETF RFC2396. It can be expressed as:</para>
      <para>&lt;scheme&gt;://&lt;authority&gt;&lt;path&gt;?&lt;query&gt;</para>
      <para>It is structured following BNF syntax. The first definition of this syntax is:</para>
      <orderedlist numeration="arabic">
        <listitem>
          <para>URI-reference = [ absoluteURI | relativeURI ] [ "#" fragment ]</para>
        </listitem>
        <listitem>
          <para>absoluteURI = scheme ":" (hier_part | opaque_part)</para>
        </listitem>
        <listitem>
          <para>relativeURI = (net_path | abs_path | rel_path) [ "?" query ]</para>
        </listitem>
        <listitem>
          <para>hier_part = (net_path | abs_path) [ "?" query ]</para>
        </listitem>
      </orderedlist>
      <para>The present standard aims only to define the term query, and not the other components of the URL/URI that are defining the path way from the Web Client System to the Web Enabled DICOM System, independent of the DICOM Persistent Object itself. However it is anticipated that, if present, scheme value is HTTP, in order to be compatible with web browsers.</para>
      <para>This definition of the term query shall respect fully the BNF syntax exposed in the IETF RFC2396. Within a query component, the characters ";", "/", "?", ":", "@", "&amp;", "=", "+", ",", and "$" are reserved. It is only a restriction of it for the unique purpose of retrieving DICOM Persistent Objects through Web Access to DICOM Persistent Objects.</para>
      <note>
        <para>Management of the HTTP returns different codes (e.g., "404 Not found") as specified in IETF RFC2616.</para>
      </note>
      <para>Control names and values are escaped. Space characters are replaced by "+", and then reserved characters are escaped as described in IETF RFC2396. Non-alphanumeric characters are replaced by "%HH", a percent sign and two hexadecimal digits representing the ASCII code of the character. Line breaks are represented as "CR LF" pairs (i.e., "%0D%0A").</para>
      <para>The control names/values are listed in the order they appear in the document. The name is separated from the value by "=" and name/value pairs are separated from each other by "&amp;".</para>
    </section>
    <section xml:id="sect_A.2" label="A.2" status="2">
      <title>Syntax of the &lt;query&gt; component</title>
      <para>The BNF syntax restriction of parameters for the Web Access to DICOM Persistent Objects service is the following:</para>
      <orderedlist numeration="arabic">
        <listitem>
          <para>query = parameter ["&amp;" parameter]</para>
        </listitem>
        <listitem>
          <para>parameter = name "=" value</para>
        </listitem>
        <listitem>
          <para>name = nchars</para>
        </listitem>
        <listitem>
          <para>value = nchars</para>
        </listitem>
        <listitem>
          <para>nchars = *nchar</para>
        </listitem>
        <listitem>
          <para>nchar = unreserved | escaped</para>
        </listitem>
      </orderedlist>
      <para>where unreserved and escaped are defined in IETF RFC2396.</para>
    </section>
  </chapter>
  <chapter xml:id="chapter_B" label="B" status="1">
    <title>Examples (Informative)</title>
    <section xml:id="sect_B.1" label="B.1" status="2">
      <title>Retrieving a Simple DICOM Image in JPEG</title>
      <programlisting><![CDATA[
http://www.hospital-stmarco/radiology/wado.php?requestType=WADO
  &studyUID=1.2.250.1.59.40211.12345678.678910
  &seriesUID=1.2.250.1.59.40211.789001276.14556172.67789
  &objectUID=1.2.250.1.59.40211.2678810.87991027.899772.2
]]></programlisting>
    </section>
    <section xml:id="sect_B.2" label="B.2" status="2">
      <title>Retrieving a DICOM SR in HTML</title>
      <programlisting><![CDATA[
http://server234/script678.asp?requestType=WADO
  &studyUID=1.2.250.1.59.40211.12345678.678910
  &seriesUID=1.2.250.1.59.40211.789001276.14556172.67789
  &objectUID=1.2.250.1.59.40211.2678810.87991027.899772.2
  &charset=UTF-8
]]></programlisting>
    </section>
    <section xml:id="sect_B.3" label="B.3" status="2">
      <title>Retrieving a Region of A DICOM Image</title>
      <para>Retrieving a region of a DICOM image, converted if possible in JPEG2000, with annotations burned into the image containing the patient name and technical information, and mapped into a defined image size:</para>
      <programlisting><![CDATA[
https://aspradio/imageaccess.js?requestType=WADO
  &studyUID=1.2.250.1.59.40211.12345678.678910
  &seriesUID=1.2.250.1.59.40211.789001276.14556172.67789
  &objectUID=1.2.250.1.59.40211.2678810.87991027.899772.2
  &contentType=image%2Fjp2;level=1,image%2Fjpeg;q=0.5
  &annotation=patient,technique
  &columns=400
  &rows=300
  &region=0.3,0.4,0.5,0.5
  &windowCenter=-1000
  &windowWidth=2500
]]></programlisting>
    </section>
    <section xml:id="sect_B.4" label="B.4" status="2">
      <title>Retrieving As A DICOM MIME Type</title>
      <para>Retrieving a DICOM image object using the baseline 8-bit lossy JPEG transfer syntax, and de-identified:</para>
      <programlisting><![CDATA[
http://www.medical-webservice.st/RetrieveDocument?requestType=WADO
  &studyUID=1.2.250.1.59.40211.12345678.678910
  &seriesUID=1.2.250.1.59.40211.789001276.14556172.67789
  &objectUID=1.2.250.1.59.40211.2678810.87991027.899772.2
  &contentType=application%2Fdicom
  &anonymize=yes
  &transferSyntax=1.2.840.10008.1.2.4.50
]]></programlisting>
    </section>
  </chapter>
  <chapter xml:id="chapter_C" label="C" status="1">
    <title>Applications (Informative)</title>
    <para>There are multiple applications, in which DICOM and "web-based" environments are interacting. "Web-based" means information and communication systems that are using Internet related technologies (Web, e-mail…). The basic feature supported by this standard is a mechanism for the "Web-based" system to retrieve a DICOM persistent object from the "DICOM-based" system.</para>
    <para>Typical applications are:</para>
    <orderedlist numeration="lowerroman">
      <listitem>
        <para>Referencing an image or a report from an electronic patient record (EPR)</para>
      </listitem>
      <listitem>
        <para>Including references to images in an e-mail</para>
      </listitem>
      <listitem>
        <para>Providing access by outside referring doctors to a hospital web server that contains references to reports, images and waveforms</para>
      </listitem>
      <listitem>
        <para>Providing access to anonymized DICOM reports, images and waveforms via a web server, for teaching purposes and for clinical trials.</para>
      </listitem>
    </orderedlist>
    <para>To retrieve DICOM persistent objects using "WADO", the "web-based" system must "know" the UIDs (Study, Series, SOP Instance) of the objects it needs to retrieve. These may be obtained through different methods (reception of a standardized message containing a document containing the reference to the DICOM objects, query of other systems…) that are beyond the scope of this standard.</para>
  </chapter>
  <chapter xml:id="chapter_D" label="D" status="1">
    <title>IANA Mapping (Informative)</title>
    <para>The following table provides an informative mapping of some IANA values to DICOM Specific Character Set Defined Terms:</para>
    <table rules="all" frame="box" xml:id="table_D-1" label="D-1">
      <caption>IANA Mapping</caption>
      <thead>
        <tr valign="top">
          <th align="center" colspan="1" rowspan="1">
            <para>IANA</para>
          </th>
          <th align="center" colspan="1" rowspan="1">
            <para>DICOM</para>
          </th>
          <th align="center" colspan="1" rowspan="1">
            <para>Character Set</para>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr valign="top">
          <td align="left" colspan="1" rowspan="1">
            <para>ISO-8859-1</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>ISO_IR 100</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>Latin alphabet #1</para>
          </td>
        </tr>
        <tr valign="top">
          <td align="left" colspan="1" rowspan="1">
            <para>ISO-8859-2</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>ISO_IR 101</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>Latin alphabet #2</para>
          </td>
        </tr>
        <tr valign="top">
          <td align="left" colspan="1" rowspan="1">
            <para>ISO-8859-3</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>ISO_IR 109</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>Latin alphabet #3</para>
          </td>
        </tr>
        <tr valign="top">
          <td align="left" colspan="1" rowspan="1">
            <para>ISO-8859-4</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>ISO_IR 110</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>Latin alphabet #4</para>
          </td>
        </tr>
        <tr valign="top">
          <td align="left" colspan="1" rowspan="1">
            <para>ISO-8859-5</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>ISO_IR 144</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>Cyrillic</para>
          </td>
        </tr>
        <tr valign="top">
          <td align="left" colspan="1" rowspan="1">
            <para>ISO-8859-6</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>ISO_IR 127</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>Arabic</para>
          </td>
        </tr>
        <tr valign="top">
          <td align="left" colspan="1" rowspan="1">
            <para>ISO-8859-7</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>ISO_IR 126</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>Greek</para>
          </td>
        </tr>
        <tr valign="top">
          <td align="left" colspan="1" rowspan="1">
            <para>ISO-8859-8</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>ISO_IR 138</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>Hebrew</para>
          </td>
        </tr>
        <tr valign="top">
          <td align="left" colspan="1" rowspan="1">
            <para>ISO-8859-9</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>ISO_IR 148</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>Latin alphabet #5</para>
          </td>
        </tr>
        <tr valign="top">
          <td align="left" colspan="1" rowspan="1">
            <para>TIS-620</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>ISO_IR 166</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>Thai</para>
          </td>
        </tr>
        <tr valign="top">
          <td align="left" colspan="1" rowspan="1">
            <para>ISO-2022-JP</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>ISO 2022 IR 87</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>Japanese</para>
          </td>
        </tr>
        <tr valign="top">
          <td align="left" colspan="1" rowspan="1">
            <para>ISO-2022-KR</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>ISO 2022 IR 149</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>Korean</para>
          </td>
        </tr>
        <tr valign="top">
          <td align="left" colspan="1" rowspan="1">
            <para>ISO-2022-CN</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>ISO 2022 IR 58</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>Chinese</para>
          </td>
        </tr>
        <tr valign="top">
          <td align="left" colspan="1" rowspan="1">
            <para>GB18030</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>GB18030</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>Chinese</para>
          </td>
        </tr>
        <tr valign="top">
          <td align="left" colspan="1" rowspan="1">
            <para>GBK</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>GBK</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>Chinese</para>
          </td>
        </tr>
        <tr valign="top">
          <td align="left" colspan="1" rowspan="1">
            <para>UTF-8</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>ISO_IR 192</para>
          </td>
          <td align="left" colspan="1" rowspan="1">
            <para>Unicode</para>
          </td>
        </tr>
      </tbody>
    </table>
  </chapter>
  <chapter xml:id="chapter_E" label="E" status="1">
    <title>WADO WS Schemas and Examples</title>
    <section xml:id="sect_E.1" label="E.1" status="2">
      <title>WADO WS XSD Schema (Informative)</title>
      <para>The following XSD schema can be used for the WADO WS implementation:</para>
      <programlisting><![CDATA[
<?xml version="1.0" encoding="utf-8"?>
<xs:schema xmlns="urn:ihe:rad:xdsi-b:2009"
xmlns:xs="http://www.w3.org/2001/XMLSchema"
targetNamespace="urn:ihe:rad:xdsi-b:2009" elementFormDefault="qualified"
attributeFormDefault="unqualified"
xmlns:tns="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0">
  <xs:import namespace="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0" />
  <xs:import namespace="urn:ihe:iti:xds-b:2007" />
  <xs:simpleType name="LongName">
    <xs:restriction base="xs:string">
      <xs:maxLength value="256" />
    </xs:restriction>
  </xs:simpleType>
  <xs:complexType name="RetrieveDocumentSetRequestType">
    <xs:sequence>
      <xs:element name="DocumentRequest" maxOccurs="unbounded">
        <xs:complexType>
          <xs:sequence>
            <xs:element name="HomeCommunityId" type="LongName" minOccurs="0">
              <xs:annotation>
                <xs:documentation>This corresponds to the home attribute of the
                Identifiable class in regrep RIM (regrep-rim-3.0-os.pdf, page
                20)</xs:documentation>
              </xs:annotation>
            </xs:element>
            <xs:element name="RepositoryUniqueId" type="LongName"
            minOccurs="0">
              <xs:annotation>
                <xs:documentation>This is the
                XDSDocumentEntry.repositoryUniqueId attribute in the XDS
                metadata</xs:documentation>
              </xs:annotation>
            </xs:element>
            <xs:element name="DocumentUniqueId" type="LongName">
              <xs:annotation>
                <xs:documentation>This is the XDSDocumentEntry.uniqueId
                attribute in the XDS metadata</xs:documentation>
              </xs:annotation>
            </xs:element>
          </xs:sequence>
        </xs:complexType>
      </xs:element>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="RegistryErrorType">
    <xs:simpleContent>
      <xs:extension base="xs:string">
        <xs:attribute name="codeContext" type="xs:string" use="required" />
        <xs:attribute name="errorCode" type="xs:string" use="required" />
        <xs:attribute default="urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Error"
        name="severity" type="xs:anyURI" />
        <xs:attribute name="location" type="xs:string" use="optional" />
      </xs:extension>
    </xs:simpleContent>
  </xs:complexType>
  <xs:complexType name="RegistryErrorListType">
    <xs:annotation>
      <xs:documentation xml:lang="en">The RegistryErrorList is derived from the
      ErrorList element from the ebXML Message Service
      Specification</xs:documentation>
    </xs:annotation>
    <xs:sequence>
      <xs:element maxOccurs="unbounded" name="RegistryError"
      type="RegistryErrorType" />
    </xs:sequence>
    <xs:attribute name="highestSeverity" type="xs:anyURI" use="optional" />
  </xs:complexType>
  <xs:complexType name="RegistryResponseType">
    <xs:annotation>
      <xs:documentation xml:lang="en">Base type for all ebXML Registry
      responses</xs:documentation>
    </xs:annotation>
    <xs:sequence>
      <!-- every response may be extended using Slots. -->
      <xs:element minOccurs="0" type="RegistryErrorListType"
      name="RegistryErrorList" />
    </xs:sequence>
    <xs:attribute name="status" type="xs:anyURI" use="required" />
    <!-- id is the request if for the request for which this is a response -->
    <xs:attribute name="requestId" type="xs:anyURI" use="optional" />
  </xs:complexType>
  <xs:element name="RetrieveDocumentSetRequest"
  type="RetrieveDocumentSetRequestType" />
  <xs:complexType name="RetrieveDocumentSetResponseType">
    <xs:sequence>
      <xs:element name="RegistryResponse" type="RegistryResponseType" />
      <xs:sequence minOccurs="0">
        <xs:element maxOccurs="unbounded" name="DocumentResponse">
          <xs:complexType>
            <xs:sequence>
              <xs:element minOccurs="0" name="HomeCommunityId" type="LongName">
                <xs:annotation>
                  <xs:documentation>This corresponds to the home attribute of
                  the Identifiable class in regrep RIM (regrep-rim-3.0-os.pdf,
                  page 20)</xs:documentation>
                </xs:annotation>
              </xs:element>
              <xs:element name="RepositoryUniqueId" type="LongName">
                <xs:annotation>
                  <xs:documentation>This is the
                  XDSDocumentEntry.repositoryUniqueId attribute in the XDS
                  metadata</xs:documentation>
                </xs:annotation>
              </xs:element>
              <xs:element name="DocumentUniqueId" type="LongName">
                <xs:annotation>
                  <xs:documentation>This is the XDSDocumentEntry.uniqueId
                  attribute in the XDS metadata</xs:documentation>
                </xs:annotation>
              </xs:element>
              <xs:element minOccurs="0" name="Document"
              type="xs:base64Binary" />
            </xs:sequence>
          </xs:complexType>
        </xs:element>
      </xs:sequence>
    </xs:sequence>
  </xs:complexType>
  <xs:element name="RetrieveDocumentSetResponse"
  type="RetrieveDocumentSetResponseType" />
  <xs:complexType name="RetrieveRenderedImagingDocumentSetRequestType">
    <xs:sequence>
      <xs:element maxOccurs="unbounded" name="StudyRequest">
        <xs:complexType>
          <xs:sequence>
            <xs:element maxOccurs="unbounded" name="SeriesRequest">
              <xs:complexType>
                <xs:sequence>
                  <xs:element maxOccurs="unbounded"
                  name="RenderedDocumentRequest">
                    <xs:complexType>
                      <xs:sequence>
                        <xs:element name="HomeCommunityId" type="LongName"
                        minOccurs="0">
                          <xs:annotation>
                            <xs:documentation>This corresponds to the home
                            attribute of the Identifiable class in regrep RIM
                            (regrep-rim-3.0-os.pdf, page 20)</xs:documentation>
                          </xs:annotation>
                        </xs:element>
                        <xs:element name="RepositoryUniqueId" type="LongName"
                        minOccurs="0">
                          <xs:annotation>
                            <xs:documentation>This is the
                            XDSDocumentEntry.repositoryUniqueId attribute in
                            the XDS metadata</xs:documentation>
                          </xs:annotation>
                        </xs:element>
                        <xs:element name="DocumentUniqueId" type="LongName">
                          <xs:annotation>
                            <xs:documentation>This is the
                            XDSDocumentEntry.uniqueId attribute in the XDS
                            metadata</xs:documentation>
                          </xs:annotation>
                        </xs:element>
                        <xs:element minOccurs="0" name="Annotation"
                        type="xs:string" />
                        <xs:element minOccurs="0" name="Rows"
                        type="xs:string" />
                        <xs:element minOccurs="0" name="Columns"
                        type="xs:string" />
                        <xs:element minOccurs="0" name="Region"
                        type="xs:string" />
                        <xs:element minOccurs="0" name="WindowWidth"
                        type="xs:string" />
                        <xs:element minOccurs="0" name="WindowCenter"
                        type="xs:string" />
                        <xs:element minOccurs="0" name="ImageQuality"
                        type="xs:string" />
                        <xs:element minOccurs="0" name="PresentationSeriesUID"
                        type="xs:string" />
                        <xs:element minOccurs="0" name="Anonymize"
                        type="xs:string" />
                        <xs:element minOccurs="0" name="FrameNumber"
                        type="xs:string" />
                        <xs:element minOccurs="1" name="ContentTypeList"
                        type="xs:string" maxOccurs="unbounded" />
                        <xs:element minOccurs="1" name="CharsetList"
                        type="xs:string" maxOccurs="unbounded" />
                      </xs:sequence>
                    </xs:complexType>
                  </xs:element>
                </xs:sequence>
              </xs:complexType>
            </xs:element>
          </xs:sequence>
        </xs:complexType>
      </xs:element>
    </xs:sequence>
  </xs:complexType>
  <xs:element name="RetrieveRenderedImagingDocumentSetRequest"
  type="RetrieveRenderedImagingDocumentSetRequestType" />
  <xs:complexType name="RetrieveRenderedImagingDocumentSetResponseType">
    <xs:sequence>
      <xs:element name="RegistryResponse" type="RegistryResponseType" />
      <xs:element maxOccurs="unbounded" name="RenderedDocumentSetResponse"
      minOccurs="0">
        <xs:complexType>
          <xs:sequence>
            <xs:element name="HomeCommunityId" type="LongName" minOccurs="0">
              <xs:annotation>
                <xs:documentation>This corresponds to the home attribute of the
                Identifiable class in regrep RIM (regrep-rim-3.0-os.pdf, page
                20)</xs:documentation>
              </xs:annotation>
            </xs:element>
            <xs:element name="RepositoryUniqueId" type="LongName"
            minOccurs="1">
              <xs:annotation>
                <xs:documentation>This is the
                XDSDocumentEntry.repositoryUniqueId attribute in the XDS
                metadata</xs:documentation>
              </xs:annotation>
            </xs:element>
            <xs:element name="SourceDocumentUniqueId" type="LongName">
              <xs:annotation>
                <xs:documentation>This is the XDSDocumentEntry.uniqueId
                attribute in the XDS metadata</xs:documentation>
              </xs:annotation>
            </xs:element>
            <xs:element minOccurs="1" name="Annotation" type="xs:string" />
            <xs:element minOccurs="1" name="Rows" type="xs:string" />
            <xs:element minOccurs="1" name="Columns" type="xs:string" />
            <xs:element minOccurs="1" name="Region" type="xs:string" />
            <xs:element name="WindowWidth" type="xs:string" />
            <xs:element minOccurs="1" name="WindowCenter" type="xs:string" />
            <xs:element minOccurs="1" name="ImageQuality" type="xs:string" />
            <xs:element minOccurs="1" name="PresentationSeriesUID"
            type="xs:string" />
            <xs:element minOccurs="0" name="Anonymize" type="xs:string" />
            <xs:element minOccurs="0" name="FrameNumber" type="xs:string" />
            <xs:element minOccurs="1" name="mimeType" type="xs:string"
            maxOccurs="1" />
            <xs:element minOccurs="1" name="Document" type="xs:base64Binary" />
          </xs:sequence>
        </xs:complexType>
      </xs:element>
    </xs:sequence>
  </xs:complexType>
  <xs:element name="RetrieveRenderedImagingDocumentSetResponse"
  type="RetrieveRenderedImagingDocumentSetResponseType" />
  <xs:complexType name="RetrieveImagingDocumentSetInformationRequestType">
    <xs:sequence>
      <xs:element maxOccurs="unbounded" name="StudyRequest">
        <xs:complexType>
          <xs:sequence>
            <xs:element maxOccurs="unbounded" name="SeriesRequest">
              <xs:complexType>
                <xs:sequence>
                  <xs:element maxOccurs="unbounded"
                  name="DocumentInformationRequest">
                    <xs:complexType>
                      <xs:sequence>
                        <xs:element name="HomeCommunityId" type="LongName"
                        minOccurs="0">
                          <xs:annotation>
                            <xs:documentation>This corresponds to the home
                            attribute of the Identifiable class in regrep RIM
                            (regrep-rim-3.0-os.pdf, page 20)</xs:documentation>
                          </xs:annotation>
                        </xs:element>
                        <xs:element name="RepositoryUniqueId" type="LongName"
                        minOccurs="1">
                          <xs:annotation>
                            <xs:documentation>This is the
                            XDSDocumentEntry.repositoryUniqueId attribute in
                            the XDS metadata</xs:documentation>
                          </xs:annotation>
                        </xs:element>
                        <xs:element name="DocumentUniqueId" type="LongName">
                          <xs:annotation>
                            <xs:documentation>This is the
                            XDSDocumentEntry.uniqueId attribute in the XDS
                            metadata</xs:documentation>
                          </xs:annotation>
                        </xs:element>
                        <xs:element minOccurs="0" name="Anonymize"
                        type="xs:string" />
                        <xs:element minOccurs="1" name="XPath" type="xs:string"
                        maxOccurs="1" />
                      </xs:sequence>
                    </xs:complexType>
                  </xs:element>
                </xs:sequence>
              </xs:complexType>
            </xs:element>
          </xs:sequence>
        </xs:complexType>
      </xs:element>
    </xs:sequence>
  </xs:complexType>
  <xs:element name="RetrieveImagingDocumentSetInformationRequest"
  type="RetrieveImagingDocumentSetInformationRequestType" />
  <xs:complexType name="RetrieveImagingDocumentSetInformationResponseType">
    <xs:sequence>
      <xs:element name="RegistryResponse" type="RegistryResponseType" />
      <xs:element maxOccurs="unbounded" name="DocumentInformationResponse"
      minOccurs="0">
        <xs:complexType>
          <xs:sequence>
            <xs:element name="HomeCommunityId" type="LongName" minOccurs="0">
              <xs:annotation>
                <xs:documentation>This corresponds to the home attribute of the
                Identifiable class in regrep RIM (regrep-rim-3.0-os.pdf, page
                20)</xs:documentation>
              </xs:annotation>
            </xs:element>
            <xs:element name="RepositoryUniqueId" type="LongName"
            minOccurs="1">
              <xs:annotation>
                <xs:documentation>This is the
                XDSDocumentEntry.repositoryUniqueId attribute in the XDS
                metadata</xs:documentation>
              </xs:annotation>
            </xs:element>
            <xs:element name="DocumentUniqueId" type="LongName">
              <xs:annotation>
                <xs:documentation>This is the XDSDocumentEntry.uniqueId
                attribute in the XDS metadata</xs:documentation>
              </xs:annotation>
            </xs:element>
            <xs:element minOccurs="0" name="FrameNumber" type="xs:string" />
            <xs:element minOccurs="1" name="XPathResponseList">
              <xs:complexType>
                <xs:sequence>
                  <xs:element maxOccurs="unbounded" name="XPathResponse"
                  type="xs:string" />
                </xs:sequence>
              </xs:complexType>
            </xs:element>
          </xs:sequence>
        </xs:complexType>
      </xs:element>
    </xs:sequence>
  </xs:complexType>
  <xs:element name="RetrieveImagingDocumentSetInformationResponse"
  type="RetrieveImagingDocumentSetInformationResponseType" />
</xs:schema>
]]></programlisting>
    </section>
    <section xml:id="sect_E.2" label="E.2" status="2">
      <title>WADO WS Request Example (Informative)</title>
      <programlisting><![CDATA[
POST /tf6/services/xdsrepositoryb HTTP/1.1
Content-Type: multipart/related; boundary=MIMEBoundaryurn_uuid_DCD262C64C22DB97351256303951323;
   type="application/xop+xml"; start="<0.urn:uuid:DCD262C64C22DB97351256303951324@apache.org>";
   start-info="application/soap+xml";
   action="urn:dicom:ws:wado:2011:RetrieveRenderedImagingDocumentSet"
User-Agent: Axis2
Host: localhost:5000

--MIMEBoundaryurn_uuid_DCD262C64C22DB97351256303951323
Content-Type: application/xop+xml; charset=UTF-8; type="application/soap+xml"
Content-Transfer-Encoding: binary
Content-ID: <0.urn:uuid:DCD262C64C22DB97351256303951324@apache.org>
<s:Envelope 
    xmlns:s="http://www.w3.org/2003/05/soap-envelope" 
    xmlns:a="http://www.w3.org/2005/08/addressing">
  <s:Header>
    <a:Action s:mustUnderstand="1">
       urn:dicom:ws:wado:2011:RetrieveRenderedImagingDocumentSet</a:Action>
    <a:MessageID>urn:uuid:0fbfdced-6c01-4d09-a110-2201afedaa02</a:MessageID>
    <a:ReplyTo s:mustUnderstand="1">
      <a:Address>http://www.w3.org/2005/08/addressing/anonymous</a:Address>
    </a:ReplyTo>
    <a:To >http://localhost:2647/XdsService/DocSource.svc</a:To>
  </s:Header>
  <s:Body>
    <RetrieveImagingDocumentSetRequest xmlns:iherad="urn:ihe:rad:xdsi-b:2009"
                                       xmlns:ihe="urn:ihe:iti:xds-b:2007">
      <StudyRequest studyInstanceUID="1.3.6.1.4...101">
          <SeriesRequest seriesInstanceUID="1.3.6.1.4...201">
              <ihe:DocumentRequest>
                  <ihe:RepositoryUniqueId>1.3.6.1.4...1000</ihe:RepositoryUniqueId>
                  <ihe:DocumentUniqueId>1.3.6.1.4...2300</ihe:DocumentUniqueId>
                  <Rows>300</Rows>
                  <Columns>300</Columns>
                  <ContentTypeList>
                    <ContentType>image/jpeg</ContentType>
                  </ContentTypeList>
              </ihe:DocumentRequest>
              <ihe:DocumentRequest>
  <ihe:RepositoryUniqueId>1.3.6.1.4...1000</ihe:RepositoryUniqueId>
                  <ihe:DocumentUniqueId>1.3.6.1.4...2301</ihe:DocumentUniqueId>
                  <Rows>300</Rows>
                  <Columns>300</Columns>
                  <ContentTypeList>
                    <ContentType>image/jpeg</ContentType>
                  </ContentTypeList>
              </ihe:DocumentRequest>
          </SeriesRequest>
      </StudyRequest>
    </RetrieveRenderedImagingDocumentSetRequest>
  </s:Body>
</s:Envelope> 

--MIMEBoundaryurn_uuid_DCD262C64C22DB97351256303951323—
]]></programlisting>
    </section>
    <section xml:id="sect_E.3" label="E.3" status="2">
      <title>WADO WS Response Example</title>
      <para>Example of the response corresponding to the above request:</para>
      <programlisting><![CDATA[
HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
Content-Type: multipart/related; boundary=MIMEBoundaryurn_uuid_F862C3E04D9E35266C1256303956115;
      type="application/xop+xml"; start="0.urn:uuid:F862C3E04D9E35266C1256303956116@apache.org";
      start-info="application/soap+xml"; action="urn:ihe:iti:2007:RetrieveDocumentSetResponse"
Date: Fri, 23 Oct 2009 13:19:11 GMT

--MIMEBoundaryurn_uuid_F862C3E04D9E35266C1256303956115
Content-Type: application/xop+xml; charset=UTF-8; type="application/soap+xml"
Content-Transfer-Encoding: binary
Content-ID: <0.urn:uuid:F862C3E04D9E35266C1256303956116@apache.org>

<s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope"
            xmlns:a="http://www.w3.org/2005/08/addressing">
  <s:Header>
    <a:Action s:mustUnderstand="1">
      urn:ihe:iti:2007:RetrieveRenderedImagingDocumentSetResponse</a:Action>
    <a:RelatesTo>urn:uuid:0fbfdced-6c01-4d09-a110-2201afedaa02</a:RelatesTo>
  </s:Header>
  <s:Body>
    <RetrieveDocumentSetResponse 
        xmlns="urn:ihe:iti:xds-b:2007" 
        xmlns:lcm="urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0" 
        xmlns:query="urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0" 
        xmlns:rim="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" 
        xmlns:rs="urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0">
      <rs:RegistryResponse status="urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success"/>
      <DocumentResponse>
        <ihe:RepositoryUniqueId>1.3.6.1.4...1000</ihe:RepositoryUniqueId>
        <SourceDocumentUniqueId>1.3.6.1.4...2300</SourceDocumentUniqueId>
        <Annotation>patient</Annotation>
        <Rows>300</Rows>
        <Columns>300</Columns>
         <Region>
          <Xmin>0.0</Xmin>
          <Ymin>0.0</Ymin>
          <Xmax>1.0</Xmax>
          <Ymax>1.0<Ymax>
        </Region>
        <WindowCenter>2000</WindowCenter>
        <WindowWidth>4096</WindowWidth>
        <ImageQuality>30</ImageQuality>
        <mimeType>image/jpeg</mimeType>
        <Document>
<xop:Include href="cid:1.urn:uuid:F862C3E04D9E35266C1256303956117@apache.org"
xmlns:xop="http://www.w3.org/2004/08/xop/include"/>
        </Document>
      </DocumentResponse>
      <DocumentResponse>
        <RepositoryUniqueId>1.3.6.1.4...1000</RepositoryUniqueId>
        <DocumentUniqueId>1.3.6.1.4...2301</DocumentUniqueId>
        <Annotation>patient</Annotation>
        <Rows>300</Rows>
        <Columns>250</Columns>
         <Region>
          <Xmin>0.0</Xmin>
          <Ymin>0.0</Ymin>
          <Xmax>1.0</Xmax>
          <Ymax>1.0<Ymax>
        </Region>
        <WindowCenter>2000</WindowCenter>
        <WindowWidth>4096</WindowWidth>
        <ImageQuality>30</ImageQuality>
        <mimeType>image/jpeg</mimeType>
        <Document>
<xop:Include href="cid:2.urn:uuid:F862C3E04D9E35266C1256303956117@apache.org"
xmlns:xop="http://www.w3.org/2004/08/xop/include"/>
        </Document>
      </DocumentResponse>
    </RetrieveDocumentSetResponse>
  </s:Body>
</s:Envelope> 
 

--MIMEBoundaryurn_uuid_F862C3E04D9E35266C1256303956115
Content-Type: application/octet-stream
Content-Transfer-Encoding: binary
Content-ID: <1.urn:uuid:F862C3E04D9E35266C1256303956117@apache.org>

This is the binary JPEG payload for the first image.

--MIMEBoundaryurn_uuid_F862C3E04D9E35266C1256303956115
Content-Type: application/octet-stream
Content-Transfer-Encoding: binary
Content-ID: <2.urn:uuid:F862C3E04D9E35266C1256303956117@apache.org>

This is the binary JPEG payload for the second image.

--MIMEBoundaryurn_uuid_F862C3E04D9E35266C1256303956115—
]]></programlisting>
    </section>
  </chapter>
  <chapter xml:id="chapter_F" label="F" status="1">
    <title>DICOM JSON Model</title>
    <section xml:id="sect_F.1" label="F.1" status="2">
      <title>Introduction to JavaScript Object Notation (JSON)</title>
      <para>JSON is a text-based open standard, derived from JavaScript, for representing data structures and associated arrays. It is language-independent, and primarily used for serializing and transmitting lightweight structured data over a network connection. It is described in detail by the Internet Engineering Task Force (IETF) in RFC 4627, available at <link xl:href="http://www.ietf.org/rfc/rfc4627.txt"/>.</para>
      <para>The DICOM JSON Model complements the XML-based Native DICOM Model, by providing a lightweight representation of data returned by DICOM web services. While this representation can be used to encode any type of DICOM Data Set it is expected to be used by client applications, especially mobile clients, such as described in the QIDO-RS use cases (see <olink targetdoc="PS3.17" targetptr="chapter_HHH" xrefstyle="select: docname label"/>).</para>
    </section>
    <section xml:id="sect_F.2" label="F.2" status="2">
      <title>DICOM JSON Model</title>
      <para>The DICOM JSON Model follows the Native DICOM Model for XML very closely, so that systems can take advantage of both formats without much retooling. The Media Type for DICOM JSON is application/json. The default character repertoire shall be UTF-8 / ISO_IR 192.</para>
      <section xml:id="sect_F.2.1" label="F.2.1" status="3">
        <title>Multiple Results Structure</title>
        <para>Multiple results returned in JSON are organized as a single top-level array of JSON objects. This differs from the Native DICOM Model, which returns multiple results as a multi-part collection of singular XML documents.</para>
        <section xml:id="sect_F.2.1.1" label="F.2.1.1" status="4">
          <title>Examples</title>
          <section xml:id="sect_F.2.1.1.1" label="F.2.1.1.1" status="5">
            <title>Native DICOM Model</title>
            <programlisting><![CDATA[
<?xml version="1.0" encoding="UTF-8" xml:space="preserve" ?>
<NativeDicomModel>
  <DicomAttribute tag="0020000D" vr="UI" keyword="StudyInstanceUID">
    <Value number="1">1.2.392.200036.9116.2.2.2.1762893313.1029997326.945873</Value>
  </DicomAttribute>
</NativeDicomModel>
…
<?xml version="1.0" encoding="UTF-8" xml:space="preserve" ?>
<NativeDicomModel>
  <DicomAttribute tag="0020000D" vr="UI" keyword="StudyInstanceUID">
    <Value number="1">1.2.444.200036.9116.2.2.2.1762893313.1029997326.945876</Value>
  </DicomAttribute>
</NativeDicomModel>
]]></programlisting>
          </section>
          <section xml:id="sect_F.2.1.1.2" label="F.2.1.1.2" status="5">
            <title>DICOM JSON Model</title>
            <programlisting><![CDATA[
[
  {
     "0020000D": {
      "vr": "UI",
      "Value": [ "1.2.392.200036.9116.2.2.2.1762893313.1029997326.945873" ]
    }
  }
  {
    "0020000D" : {
      "vr": "UI",
      "Value": [ "1.2.392.200036.9116.2.2.2.2162893313.1029997326.945876" ]
    }
  }
]
]]></programlisting>
          </section>
        </section>
      </section>
      <section xml:id="sect_F.2.2" label="F.2.2" status="3">
        <title>DICOM JSON Model Object Structure</title>
        <para>The DICOM JSON Model object is a representation of a DICOM Data Set.</para>
        <para>The internal structure of the DICOM JSON Model object is a sequence of objects representing attributes within the DICOM Data Set.</para>
        <para>Attribute objects within a DICOM JSON Model object must be ordered by their property name in ascending order.</para>
        <para>Group Length (gggg,0000) attributes shall not be included in a DICOM JSON Model object.</para>
        <para>The name of each attribute object is:</para>
        <itemizedlist>
          <listitem>
            <para>The eight character uppercase hexadecimal representation of a DICOM Tag</para>
          </listitem>
        </itemizedlist>
        <para>Each attribute object contains the following named child objects:</para>
        <itemizedlist>
          <listitem>
            <para>vr: A string encoding the DICOM Value Representation. The mapping between DICOM Value Representations and JSON Value Representations is described in <xref linkend="sect_F.2.3" xrefstyle="select: label"/>.</para>
          </listitem>
          <listitem>
            <para>At most one of:</para>
            <itemizedlist>
              <listitem>
                <para>Value: An array containing one of:</para>
                <itemizedlist>
                  <listitem>
                    <para>The Value Field elements of a DICOM attribute with a VR other than PN, SQ, OB, OD, OF, OW, or UN (described in <xref linkend="sect_F.2.4" xrefstyle="select: label"/>)</para>
                    <para>The encoding of empty Value Field elements is described in <xref linkend="sect_F.2.5" xrefstyle="select: label"/></para>
                  </listitem>
                  <listitem>
                    <para>The Value Field elements of a DICOM attribute with a VR of PN. The non-empty name components of each element are encoded as a JSON strings with the following names:</para>
                    <itemizedlist>
                      <listitem>
                        <para>Alphabetic</para>
                      </listitem>
                      <listitem>
                        <para>Ideographic</para>
                      </listitem>
                      <listitem>
                        <para>Phonetic</para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                  <listitem>
                    <para>JSON DICOM Model objects corresponding to the sequence items of an attribute with a VR of SQ</para>
                    <para>Empty sequence items are represented by empty objects</para>
                  </listitem>
                </itemizedlist>
              </listitem>
              <listitem>
                <para>BulkDataURI: A string encoding the WADO-RS URL of a bulk data item describing the Value Field of an enclosing Attribute with a VR of FL, FD, IS, LT, OB, OD, OF, OW, SL, SS, ST, UL, UN, US, or UT (described in <xref linkend="sect_F.2.6" xrefstyle="select: label"/>)</para>
              </listitem>
              <listitem>
                <para>InlineBinary: A base64 string encoding the Value Field of an enclosing Attribute with a VR of OB, OD, OF, OW, or UN (described in <xref linkend="sect_F.2.7" xrefstyle="select: label"/>)</para>
              </listitem>
            </itemizedlist>
          </listitem>
        </itemizedlist>
        <note>
          <orderedlist numeration="arabic">
            <listitem>
              <para>For Private Data Elements, the group and element numbers will follow the rules specified in <olink targetdoc="PS3.5" targetptr="sect_7.8.1" xrefstyle="select: docname label"/></para>
            </listitem>
            <listitem>
              <para>The person name representation is more closely aligned with the DICOM Data Element representation than the DICOM <olink targetdoc="PS3.19" targetptr="PS3.19" xrefstyle="select: labelnumber"/> XML representation.</para>
            </listitem>
          </orderedlist>
        </note>
      </section>
      <section xml:id="sect_F.2.3" label="F.2.3" status="3">
        <title>DICOM JSON Value Representation</title>
        <para>The value representation (VR) is included in each DICOM JSON Model attribute object and named "vr". For example:</para>
        <programlisting><![CDATA[
"vr": "CS"
]]></programlisting>
        <para>All DICOM Value Representations are mapped to specified JSON Data Types (see <xref linkend="table_F.2.3-1" xrefstyle="select: label"/>). The JSON encodings shall conform to the Definition, Character Repertoire (if applicable) and Length of Value specified for that Value Representation (see <olink targetdoc="PS3.5" targetptr="sect_6.2" xrefstyle="select: docname label quotedtitle"/>) with the following exceptions:</para>
        <itemizedlist>
          <listitem>
            <para>Attributes with a Value Representation of AT shall be restricted to eight character uppercase hexadecimal representation of a DICOM Tag</para>
          </listitem>
        </itemizedlist>
        <table rules="all" frame="box" xml:id="table_F.2.3-1" label="F.2.3-1">
          <caption>DICOM VR to JSON Data Type Mapping</caption>
          <thead>
            <tr valign="top">
              <th align="center" colspan="1" rowspan="1">
                <para>
                  <emphasis role="bold">VR Name</emphasis>
                </para>
              </th>
              <th align="center" colspan="1" rowspan="1">
                <para>
                  <emphasis role="bold">Type</emphasis>
                </para>
              </th>
              <th align="center" colspan="1" rowspan="1">
                <para>
                  <emphasis role="bold">JSON Data Type</emphasis>
                </para>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>AE</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Application Entity</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">String</emphasis>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>AS</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Age String</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">String</emphasis>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>AT</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Attribute Tag</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">String</emphasis>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>CS</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Code String</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">String</emphasis>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>DA</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Date</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">String</emphasis>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>DS</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Decimal</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">Number</emphasis>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>DT</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Date Time</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">String</emphasis>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>FL</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Floating Point Single</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">Number</emphasis>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>FD</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Floating Point Double</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">Number</emphasis>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>IS</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Integer String</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">Number</emphasis>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>LO</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Long String</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">String</emphasis>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>LT</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Long Text</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">String</emphasis>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>OB</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Other Byte String</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para><emphasis role="italic">Base64</emphasis> encoded
        <emphasis role="italic">string</emphasis></para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>OD</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Other Double String</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para><emphasis role="italic">Base64</emphasis> encoded
        <emphasis role="italic">string</emphasis></para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>OF</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Other Float String</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para><emphasis role="italic">Base64</emphasis> encoded
        <emphasis role="italic">string</emphasis></para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>OW</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Other Word String</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para><emphasis role="italic">Base64</emphasis> encoded
        <emphasis role="italic">string</emphasis></para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>PN</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Person Name</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para><emphasis role="italic">Object</emphasis> containing Person Name component groups as
        <emphasis role="italic">strings (see <xref linkend="sect_F.2.2" xrefstyle="select: label"/>)</emphasis></para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>SH</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Short String</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">String</emphasis>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>SL</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Signed Long</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">Number</emphasis>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>SQ</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Sequence</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para><emphasis role="italic">Array</emphasis> containing DICOM JSON Objects</para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>SS</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Signed Short</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">Number</emphasis>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>ST</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Short Text</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">String</emphasis>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>TM</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Time</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">String</emphasis>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>UI</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>UID</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">String</emphasis>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>UL</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Unsigned Long</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">Number</emphasis>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>UN</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Unknown</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para><emphasis role="italic">Base64</emphasis> encoded
        <emphasis role="italic">string</emphasis></para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>US</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Unsigned Short</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">Number</emphasis>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="center" colspan="1" rowspan="1">
                <para>UT</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>Unlimited Text</para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="italic">String</emphasis>
                </para>
              </td>
            </tr>
          </tbody>
        </table>
        <para>Although data, such as dates, are represented in the DICOM JSON model as strings, it is expected that they will be treated in the same manner as the original attribute as defined by <olink targetdoc="PS3.6" targetptr="chapter_6" xrefstyle="select: docname label"/>.</para>
      </section>
      <section xml:id="sect_F.2.4" label="F.2.4" status="3">
        <title>DICOM JSON Value Multiplicity</title>
        <para>The value or values of a given DICOM attribute are given in the "Value" array. The value multiplicity (VM) is not contained in the DICOM JSON object.</para>
        <para>For example:</para>
        <programlisting><![CDATA[
"Value": [ "bar", "foo" ]
]]></programlisting>
        <para>or:</para>
        <programlisting><![CDATA[
"Value": [ "bar" ]
]]></programlisting>
      </section>
      <section xml:id="sect_F.2.5" label="F.2.5" status="3">
        <title>DICOM JSON Model Null Values</title>
        <para>If an attribute is present in DICOM but empty (i.e., Value Length is 0), it shall be preserved in the DICOM JSON attribute object containing no "Value", "BulkDataURI" or "InlineBinary".</para>
        <para>If a multi-valued attribute has one or more empty values these are represented as "null" array elements. For example:</para>
        <programlisting><![CDATA[
"Value": [ "bar", null, "foo" ]
]]></programlisting>
        <para>If a sequence contains empty items these are represented as empty JSON object in the array.</para>
        <programlisting><![CDATA[
"Value": [ { … }, { }, { … } ]
]]></programlisting>
      </section>
      <section xml:id="sect_F.2.6" label="F.2.6" status="3">
        <title>BulkDataURI</title>
        <para>If an attribute contains a "BulkDataURI"
          <emphasis role="italic">,</emphasis> this contains the URI of a bulk data element as defined in <olink targetdoc="PS3.19" targetptr="table_A.1.5-2" xrefstyle="select: docname label"/>.</para>
      </section>
      <section xml:id="sect_F.2.7" label="F.2.7" status="3">
        <title>InlineBinary</title>
        <para>If an attribute contains an "InlineBinary", this contains the base64 encoding of the enclosing attribute's Value Field.</para>
        <para>There is a single InlineBinary value representing the entire Value Field, and not one per Value in the case where the Value Multiplicity is greater than one. E.g., a LUT with 4096 16 bit entries that may be encoded in DICOM with a Value Representation of OW, with a VL of 8192 and a VM of 1, or a US VR with a VL of 8192 and a VM of 4096 would both be represented as a single InlineBinary string.</para>
        <para>All rules (e.g., byte ordering and swapping) in DICOM <olink targetdoc="PS3.5" targetptr="PS3.5" xrefstyle="select: labelnumber"/> apply.</para>
        <note>
          <para>Implementers should in particular pay attention the <olink targetdoc="PS3.5" targetptr="PS3.5" xrefstyle="select: labelnumber"/> rules regarding the value representations of OD, OF and OW.</para>
        </note>
      </section>
    </section>
    <section xml:id="sect_F.3" label="F.3" status="2">
      <title>Transformation with other DICOM Formats</title>
      <section xml:id="sect_F.3.1" label="F.3.1" status="3">
        <title>Native DICOM Model XML</title>
        <para>The transformation between the Native DICOM Model XML and the DICOM JSON model cannot be done through the use of generic XML - JSON converters.</para>
        <para>The mapping between the two formats is as follows (see also <xref linkend="table_F.3.1-1" xrefstyle="select: label"/>):</para>
        <itemizedlist>
          <listitem>
            <para>The XML "NativeDicomModel" element maps to the DICOM JSON Model Object</para>
          </listitem>
          <listitem>
            <para>Each "DicomAttribute" element maps to an attribute object within the DICOM JSON model object</para>
            <itemizedlist>
              <listitem>
                <para>The "tag" attribute maps to the JSON object name</para>
                <itemizedlist>
                  <listitem>
                    <para>The Native DICOM Model XML allows for duplicate Tag values and the DICOM JSON model does not. To resolve this, private attribute Tag values must be remapped according to the conflict avoidance rules specified in <olink targetdoc="PS3.5" targetptr="sect_7.8.1" xrefstyle="select: docname label quotedtitle"/>.</para>
                  </listitem>
                </itemizedlist>
              </listitem>
              <listitem>
                <para>The "vr" attribute maps to the "vr" child string</para>
              </listitem>
            </itemizedlist>
          </listitem>
          <listitem>
            <para>"Value" elements map to members of the "Value" child array</para>
            <itemizedlist>
              <listitem>
                <para>A "Value" element with the attribute "number=n" maps to "Value[n-1]"</para>
              </listitem>
              <listitem>
                <para>Empty "Value" elements are represented by "null" entries in the "Value" array</para>
              </listitem>
            </itemizedlist>
          </listitem>
          <listitem>
            <para>"PersonName" elements map to objects within the "Value" array. For a "PersonName" element with the attribute "number=n":</para>
            <itemizedlist>
              <listitem>
                <para>The "Alphabetic" element maps to "Value[<emphasis role="bold"><emphasis role="italic">n-1</emphasis></emphasis>].Alphabetic"</para>
              </listitem>
              <listitem>
                <para>The "Ideographic" element maps to "PersonName[<emphasis role="bold"><emphasis role="italic">n</emphasis></emphasis>].Ideographic"</para>
              </listitem>
              <listitem>
                <para>The "Phonetic" element maps to "PersonName[<emphasis role="bold"><emphasis role="italic">n</emphasis></emphasis>].Phonetic"</para>
              </listitem>
            </itemizedlist>
            <para>- "Item" elements map to members of the "Value" child array</para>
            <itemizedlist>
              <listitem>
                <para>An "Item" element with the attribute "number=n" maps to "Value[n-1]"</para>
              </listitem>
              <listitem>
                <para>Empty "Item" elements are represented by empty JSON property entries in the "Value" array</para>
              </listitem>
            </itemizedlist>
          </listitem>
          <listitem>
            <para>The "uri" attribute of the "BulkData" element maps to the "BulkDataURI" string</para>
          </listitem>
          <listitem>
            <para>The "InlineBinary" element maps to the "InlineBinary" string</para>
          </listitem>
        </itemizedlist>
        <table rules="all" frame="box" xml:id="table_F.3.1-1" label="F.3.1-1">
          <caption>XML to JSON Mapping</caption>
          <thead>
            <tr valign="top">
              <th align="center" colspan="1" rowspan="1">
                <para>DICOM <olink targetdoc="PS3.19" targetptr="PS3.19" xrefstyle="select: labelnumber"/> XML</para>
              </th>
              <th align="center" colspan="1" rowspan="1">
                <para>DICOM JSON Model</para>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <computeroutput>&lt;NativeDicomModel&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;DicomAttribute tag=</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggee01</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>… /&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;DicomAttribute tag=</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggee02</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>… /&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>…</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;/NativeDicomModel&gt;</computeroutput>
                </para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <computeroutput>{</computeroutput>
                </para>
                <para>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggee01</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>: { … },</computeroutput>
                </para>
                <para>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggee02</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>: { … },</computeroutput>
                </para>
                <para>
                  <computeroutput>…</computeroutput>
                </para>
                <para>
                  <computeroutput>}</computeroutput>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <computeroutput>&lt;DicomAttribute</computeroutput>
                </para>
                <para>
                  <computeroutput>tag=</computeroutput>
                  <emphasis role="bold">
                    <computeroutput>ggggeeee</computeroutput>
                  </emphasis>
                </para>
                <para>
                  <computeroutput>vr=</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>VR</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;Value number="1"&gt;</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>Value</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>&lt;/Value&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;/DicomAttribute&gt;</computeroutput>
                </para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggeeee</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>: {</computeroutput>
                </para>
                <para>
                  <computeroutput>"vr":</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>VR</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>,</computeroutput>
                </para>
                <para>
                  <computeroutput>"Value": [</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>Value</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>]</computeroutput>
                </para>
                <para>
                  <computeroutput>}</computeroutput>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <computeroutput>&lt;DicomAttribute tag=</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggeeee</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>… &gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;Value number="1"&gt;</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>Value1</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>&lt;/Value&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;Value number="2"&gt;</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>Value2</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>&lt;/Value&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>…</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;/DicomAttribute&gt;</computeroutput>
                </para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggeeee</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>: {</computeroutput>
                </para>
                <para>
                  <computeroutput>…</computeroutput>
                </para>
                <para>
                  <computeroutput>"Value": [</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>Value1</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>,</computeroutput>
                </para>
                <para>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>Value2</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>, …</computeroutput>
                </para>
                <para>
                  <computeroutput>]</computeroutput>
                </para>
                <para>
                  <computeroutput>}</computeroutput>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <computeroutput>&lt;DicomAttribute tag=</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggeeee</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>… &gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;/DicomAttribute&gt;</computeroutput>
                </para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggeeee</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>: {</computeroutput>
                </para>
                <para>
                  <computeroutput>…</computeroutput>
                </para>
                <para>
                  <computeroutput>}</computeroutput>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <computeroutput>&lt;DicomAttribute tag=</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggeeee</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>vr="PN" … &gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;PersonName number="1"&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;Alphabetic&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;FamilyName&gt;</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>SB1</computeroutput>
                    </emphasis>
                  </emphasis>
                </para>
                <para>
                  <computeroutput>&lt;/FamilyName&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;GivenName&gt;</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>SB2</computeroutput>
                    </emphasis>
                  </emphasis>
                </para>
                <para>
                  <computeroutput>&lt;/GivenName&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;MiddleName&gt;</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>SB3</computeroutput>
                    </emphasis>
                  </emphasis>
                </para>
                <para>
                  <computeroutput>&lt;/MiddleName&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;NamePrefix&gt;</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>SB4</computeroutput>
                    </emphasis>
                  </emphasis>
                </para>
                <para>
                  <computeroutput>&lt;/NamePrefix&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;NameSuffix&gt;</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>SB5</computeroutput>
                    </emphasis>
                  </emphasis>
                </para>
                <para>
                  <computeroutput>&lt;/NameSuffix&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;/Alphabetic&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;Ideographic&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;FamilyName&gt;</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ID1</computeroutput>
                    </emphasis>
                  </emphasis>
                </para>
                <para>
                  <computeroutput>&lt;/FamilyName&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>…</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;/Ideographic&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;Phonetic&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;FamilyName&gt;</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>PH1</computeroutput>
                    </emphasis>
                  </emphasis>
                </para>
                <para>
                  <computeroutput>&lt;/FamilyName&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>…</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;/Phonetic&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;/PersonName&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;PersonName number="2"&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;Alphabetic&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;FamilyName&gt;</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>SB6</computeroutput>
                    </emphasis>
                  </emphasis>
                </para>
                <para>
                  <computeroutput>&lt;/FamilyName&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;/Alphabetic&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;/PersonName&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;/DicomAttribute&gt;</computeroutput>
                </para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggeeee</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>: {</computeroutput>
                </para>
                <para>
                  <computeroutput>…</computeroutput>
                </para>
                <para>
                  <computeroutput>"vr": "PN",</computeroutput>
                </para>
                <para>
                  <computeroutput>"Value": [</computeroutput>
                </para>
                <para>
                  <computeroutput>{</computeroutput>
                </para>
                <para>
                  <emphasis role="bold">
                    <computeroutput>"</computeroutput>
                  </emphasis>
                  <computeroutput>Alphabetic</computeroutput>
                  <emphasis role="bold">
                    <computeroutput>"</computeroutput>
                  </emphasis>
                  <computeroutput>:</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>"SB1^SB2^SB3^SB4^SB5",</computeroutput>
                    </emphasis>
                  </emphasis>
                </para>
                <para>
                  <computeroutput>"Ideographic":</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>"ID1^ID2^ID3^ID4^ID5"</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>,</computeroutput>
                </para>
                <para>
                  <computeroutput>"Phonetic":</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>"PH1^PH2^PH3^PH4^PH5"</computeroutput>
                    </emphasis>
                  </emphasis>
                </para>
                <para>
                  <computeroutput>},</computeroutput>
                </para>
                <para>
                  <computeroutput>{</computeroutput>
                </para>
                <para>
                  <computeroutput>"Alphabetic":</computeroutput>
                </para>
                <para>
                  <computeroutput>"</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>SB6</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>"</computeroutput>
                </para>
                <para>
                  <computeroutput>}</computeroutput>
                </para>
                <para>
                  <computeroutput>]</computeroutput>
                </para>
                <para>
                  <computeroutput>}</computeroutput>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <computeroutput>&lt;DicomAttribute tag=</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggeeee</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>vr="SQ" … &gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;Item number="1"&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;DicomAttribute tag=</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggee01</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>… /&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;DicomAttribute tag=</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggee02</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>… /&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>…</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;/Item&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;Item number="2"&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;DicomAttribute tag=</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggee01</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>… /&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;DicomAttribute tag=</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggee02</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>… /&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>…</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;/Item&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;Item number="3"&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;/Item&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>…</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;/DicomAttribute&gt;</computeroutput>
                </para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggeeee</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>: {</computeroutput>
                </para>
                <para>
                  <computeroutput>…</computeroutput>
                </para>
                <para>
                  <computeroutput>"vr": "SQ",</computeroutput>
                </para>
                <para>
                  <computeroutput>"Value":</computeroutput>
                </para>
                <para>
                  <computeroutput>[</computeroutput>
                </para>
                <para>
                  <computeroutput>{</computeroutput>
                </para>
                <para>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggee01</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>: { … },</computeroutput>
                </para>
                <para>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggee02</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>: { … },</computeroutput>
                </para>
                <para>
                  <computeroutput>…</computeroutput>
                </para>
                <para>
                  <computeroutput>}</computeroutput>
                </para>
                <para>
                  <computeroutput>{</computeroutput>
                </para>
                <para>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggee01</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>: { … },</computeroutput>
                </para>
                <para>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggee02</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>: { … },</computeroutput>
                </para>
                <para>
                  <computeroutput>…</computeroutput>
                </para>
                <para>
                  <computeroutput>}</computeroutput>
                </para>
                <para>
                  <computeroutput>{ }</computeroutput>
                </para>
                <para>
                  <computeroutput>…</computeroutput>
                </para>
                <para>
                  <computeroutput>]</computeroutput>
                </para>
                <para>
                  <computeroutput>}</computeroutput>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <computeroutput>&lt;DicomAttribute tag=</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggeeee</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>… &gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;BulkData URI=</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>BulkDataURI</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;/DicomAttribute&gt;</computeroutput>
                </para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggeeee</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>: {</computeroutput>
                </para>
                <para>
                  <computeroutput>…</computeroutput>
                </para>
                <para>
                  <computeroutput>"BulkDataURI":</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>BulkDataURI</computeroutput>
                    </emphasis>
                  </emphasis>
                </para>
                <para>
                  <computeroutput>}</computeroutput>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <computeroutput>&lt;DicomAttribute tag=</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggeeee</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>… &gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;InlineBinary&gt;</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>Base64String</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>&lt;/InlineBinary&gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;/DicomAttribute&gt;</computeroutput>
                </para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggeeee</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>: {</computeroutput>
                </para>
                <para>
                  <computeroutput>…</computeroutput>
                </para>
                <para>
                  <computeroutput>"InlineBinary": "</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>Base64String"</computeroutput>
                    </emphasis>
                  </emphasis>
                </para>
                <para>
                  <computeroutput>}</computeroutput>
                </para>
              </td>
            </tr>
            <tr valign="top">
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <computeroutput>&lt;DicomAttribute tag=</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>gggg00ee</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>PrivateCreator=</computeroutput>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>PrivateCreator</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>… &gt;</computeroutput>
                </para>
                <para>
                  <computeroutput>…</computeroutput>
                </para>
                <para>
                  <computeroutput>&lt;/DicomAttribute&gt;</computeroutput>
                </para>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <para>
                  <emphasis role="bold">
                    <emphasis role="italic">
                      <computeroutput>ggggXXee</computeroutput>
                    </emphasis>
                  </emphasis>
                  <computeroutput>: {</computeroutput>
                </para>
                <para>
                  <computeroutput>…</computeroutput>
                </para>
                <para>
                  <computeroutput>}</computeroutput>
                </para>
              </td>
            </tr>
          </tbody>
        </table>
      </section>
    </section>
    <section xml:id="sect_F.4" label="F.4" status="2">
      <title>DICOM JSON Model Example</title>
      <programlisting><![CDATA[
// The following example is a QIDO-RS SearchForStudies response consisting 
// of two matching studies, corresponding to the example QIDO-RS request:
// GET http://qido.nema.org/studies?PatientID=12345&includefield=all&limit=2
[
    {   // Result 1
        "00080005": {
            "vr": "CS",
            "Value": [ "ISO_IR192" ]
        },
        "00080020": {
            "vr": "DT",
            "Value": [ "20130409" ]
        },
        "00080030": {
            "vr": "TM",
            "Value": [ "131600.0000" ]
        },
        "00080050": {
            "vr": "SH",
            "Value": [ "11235813" ]
        },
        "00080056": {
            "vr": "CS",
            "Value": [ "ONLINE" ]
        },
        "00080061": {
            "vr": "CS",
            "Value": [
                "CT",
                "PET"
            ]
        },
        "00080090": {
            "vr": "PN",
            "Value": [
              {
                "Alphabetic": "^Bob^^Dr."
              }
            ]
        },
        "00081190": {
            "vr": "UT",
            "Value": [ "http://wado.nema.org/studies/
            1.2.392.200036.9116.2.2.2.1762893313.1029997326.945873" ]
        },
        "00090010": {
            "vr": "LO",
            "Value": [ "Vendor A" ]
        },
        "00091002": {
            "vr": "UN",
            "Value": [ "z0x9c8v7" ]
        },
        "00100010": {
            "vr": "PN",
            "Value": [
              {
                "Alphabetic": "Wang^XiaoDong",
                "Ideographic": "王^小東"
              }
            ]
        },
        "00100020": {
            "vr": "LO",
            "Value": [ "12345" ]
        },
        "00100021": {
            "vr": "LO",
            "Value": [ "Hospital A" ]
        },
        "00100030": {
            "vr": "DT",
            "Value": [ "19670701" ]
        },
        "00100040": {
            "vr": "CS",
            "Value": [ "M" ]
        },
        "00101002": {
            "vr": "SQ",
            "Value": [
                {
                    "00100020": {
                        "vr": "LO",
                        "Value": [ "54321" ]
                    },
                    "00100021": {
                        "vr": "LO",
                        "Value": [ "Hospital B" ]
                    }
                },
                {
                    "00100020": {
                        "vr": "LO",
                        "Value": [ "24680" ]
                    },
                    "00100021": {
                        "vr": "LO",
                        "Value": [ "Hospital C" ]
                    }
                }
            ]
        },
        "0020000D": {
            "vr": "UI",
            "Value": [ "1.2.392.200036.9116.2.2.2.1762893313.1029997326.945873" ]
        },
        "00200010": {
            "vr": "SH",
            "Value": [ "11235813" ]
        },
        "00201206": {
            "vr": "IS",
            "Value": [ 4 ]
        },
        "00201208": {
            "vr": "IS",
            "Value": [ 942 ]
        }
    },
    {   // Result 2
        "00080005": {
            "vr": "CS",
            "Value": [ "ISO_IR192" ]
        },
        "00080020": {
            "vr": "DT",
            "Value": [ "20130309" ]
        },
        "00080030": {
            "vr": "TM",
            "Value": [ "111900.0000" ]
        },
        "00080050": {
            "vr": "SH",
            "Value": [ "11235821" ]
        },
        "00080056": {
            "vr": "CS",
            "Value": [ "ONLINE" ]
        },
        "00080061": {
            "vr": "CS",
            "Value": [
                "CT",
                "PET"
            ]
        },
        "00080090": {
            "vr": "PN",
            "Value": [
              {
                "Alphabetic": "^Bob^^Dr." 
              }
            ]
        },
        "00081190": {
            "vr": "UT",
            "Value": [ "http://wado.nema.org/studies/
            1.2.392.200036.9116.2.2.2.2162893313.1029997326.945876" ]
        },
        "00090010": {
            "vr": "LO",
            "Value": [ "Vendor A" ]
        },
        "00091002": {
            "vr": "UN",
            "Value": [ "z0x9c8v7" ]
        },
        "00100010": {
            "vr": "PN",
            "Value": [
              {
                "Alphabetic": "Wang^XiaoDong",
                "Ideographic": "王^小東" 
              }
            ]
        },
        "00100020": {
            "vr": "LO",
            "Value": [ "12345" ]
        },
        "00100021": {
            "vr": "LO",
            "Value": [ "Hospital A" ]
        },
        "00100030": {
            "vr": "DT",
            "Value": [ "19670701" ]
        },
        "00100040": {
            "vr": "CS",
            "Value": [ "M" ]
        },
        "00101002": {
            "vr": "SQ",
            "Value": [
                {
                    "00100020": {
                        "vr": "LO",
                        "Value": [ "54321" ]
                    },
                    "00100021": {
                        "vr": "LO",
                        "Value": [ "Hospital B" ]
                    }
                },
                {
                    "00100020": {
                        "vr": "LO",
                        "Value": [ "24680" ]
                    },
                    "00100021": {
                        "vr": "LO",
                        "Value": [ "Hospital C" ]
                    }
                }
            ]
        },
        "0020000D": {
            "vr": "UI",
            "Value": [ "1.2.392.200036.9116.2.2.2.2162893313.1029997326.945876" ]
        },
        "00200010": {
            "vr": "SH",
            "Value": [ "11235821" ]
        },
        "00201206": {
            "vr": "IS",
            "Value": [ 5 ]
        },
        "00201208": {
            "vr": "IS",
            "Value": [ 1123 ]
        }
    }
]
]]></programlisting>
    </section>
    <section xml:id="sect_F.5" label="F.5" status="2">
      <title>References</title>
      <para>IETF RFC 4627 <link xl:href="http://www.ietf.org/rfc/rfc4627.txt"/> (Normative JSON definition)</para>
      <para>JSON. <link xl:href="http://www.json.org/"/> (Informative)</para>
      <para>Wikipedia, definition of JSON. <link xl:href="http://en.wikipedia.org/wiki/JSON"/> (Informative)</para>
      <para>JSON in FHIR. <link xl:href="http://www.hl7.org/implement/standards/fhir/formats.htm#json"/> (Informative)</para>
    </section>
  </chapter>
</book>
